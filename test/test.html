<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=100, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="keywords" content="rub.js">
    <title>Rub.js</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
      html, body, #app {
        height: 100%;
      }

      #container {
        margin: 0 auto;
        height: 2000px;
      }

      #content {
        width: 640px;
        height: 360px;
        touch-action: none;
        user-select: none;
      }

      .tracking-area {
        width: 100%;
        height: 100%;
        background-color: red;
      }

      .test-zone {
        width: 100%;
        height: 100%;
        background-color: grey;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="content">
        <div id="" class="tracking-area">
          <div class="test-zone" data-zone-id="test" data-zone-type="single"></div>
        </div>
      </div>
      <button id="fullscreen">go full screen</button>
      <button id="start">start tracker</button>
      <button id="stop">stop tracker</button>
      <button id="disabled">disable recording</button>
      <button id="destroy">destroy tracker</button>
      <button id="resize">resize tracker</button>
    </div>
    <script src="rub.js"></script>
    <script>
      const content = document.getElementById('content');
      const button = document.getElementById('fullscreen');
      button.addEventListener('click', () => {
        content.requestFullscreen();
      }, false);

      const tracker = new Rub(content);
      tracker.addLoopCallback((frames) => {
        const recorder = tracker.getRecorder();



        /*const velos = recorder.getVelocity();
        const [velocity] = velos.get('live');
        velocity > 0 && console.log(frames, 'frames', Math.floor(velocity), 'speed');*/
        const updated = recorder.isUpdated();
        const blockData = recorder.getRecentBlockData(frames, 10);
        const velocity = blockData.get('live');
        const [lastValue] = velocity.slice(-2);
        console.log(frames, lastValue, updated);
        //console.log(velocity);
      });


      const startButton = document.getElementById('start');
      startButton.addEventListener('click', () => {
        tracker.startLoop();

        /*setTimeout(() => {
          tracker.stopLoop();
        }, 500);*/
      }, false);

      const stopButton = document.getElementById('stop');
      stopButton.addEventListener('click', () => {
        tracker.stopLoop();
        console.log('stopped');
        //tracker.clearLoop();
      }, false);

      const disableButton = document.getElementById('disabled');
      disableButton.addEventListener('click', () => {
        const recorder = tracker.getRecorder();
        console.log(recorder.isRecordable());
        recorder.enableRecording(false);
      }, false);

      const destroyButton = document.getElementById('destroy');
      destroyButton.addEventListener('click', () => {
        tracker.destroy();
      }, false);

      const resizeButton = document.getElementById('resize');
      resizeButton.addEventListener('click', () => {
        tracker.setDuration(1);
      }, false);
    </script>
  </body>
</html>
