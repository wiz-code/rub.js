{"version":3,"sources":["webpack://Rub/webpack/universalModuleDefinition","webpack://Rub/webpack/bootstrap","webpack://Rub/./node_modules/javascript-state-machine/state-machine.js","webpack://Rub/./src/dataset.ts","webpack://Rub/./src/event-type.ts","webpack://Rub/./src/index.ts","webpack://Rub/./src/mouse-handler.ts","webpack://Rub/./src/pointer-handler.ts","webpack://Rub/./src/recorder.ts","webpack://Rub/./src/target.ts","webpack://Rub/./src/touch-handler.ts","webpack://Rub/./src/tracker.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","StateMachine","VERSION","Result","SUCCEEDED","NOTRANSITION","CANCELLED","PENDING","Error","INVALID_TRANSITION","PENDING_TRANSITION","INVALID_CALLBACK","WILDCARD","ASYNC","cfg","target","initial","state","terminal","fsm","events","callbacks","map","transitions","add","e","from","Array","isArray","length","push","to","event","buildEvent","current","is","indexOf","this","can","transition","undefined","cannot","concat","isFinished","error","args","msg","states","keys","sort","defer","doCallback","func","apply","beforeAnyEvent","afterAnyEvent","leaveAnyState","enterAnyState","changeState","beforeThisEvent","afterThisEvent","leaveThisState","enterThisState","beforeEvent","afterEvent","leaveState","specific","general","enterState","slice","arguments","cancel","leave","pointer","media","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave","Click","DoubleClick","ContextMenu","TouchStart","TouchEnd","TouchMove","TouchCancel","abs","max","id","container","callback","bounds","Map","inputId","outputId","loopCallbacks","offset","t0","x0","y0","boundsContainer","querySelector","els","children","el","identifier","dataset","boundsType","targetEls","childElementCount","Handler","navigator","maxTouchPoints","msMaxTouchPoints","set","recorder","currentBoundsType","addListeners","addLoopCallback","output","getFrames","requestAnimationFrame","input","ctime","velocity","targetIndex","isAttached","count","getEventTrackCount","track","getEventTrack","x","y","dt","dx","dy","getVelocity","getActiveTargetIndex","update","getId","startLoop","stopLoop","suspend","cancelAnimationFrame","clearLoop","resetBoundsType","getCurrentBoundsType","setBoundsType","removeEventHandler","setEventHandler","setMediaCallback","assign","clearLoopCallback","removeListeners","clearEventTracks","resetFrames","documentElement","document","start","MouseEvent","performance","now","rect","getBoundingClientRect","clientX","left","clientY","top","coords","addTrack","move","end","activate","index","findTargetIndex","targets","inactivate","listener","attached","addEventListener","removeEventListener","isActive","initialize","predicate","result","getTrack","clearTracks","round","frames","started","elapsedTime","lastTime","targetNum","blockSize","record","createRecord","shiftedFrames","live","playback","external","template","fill","liveTracker","currentFrames","setTrack","tracker","writeFrames","getElapsedTime","setFrames","shift","clearRecord","getRecordCount","getVelocities","shifted","subarray","getRecord","size","setRecord","tracks","addData","data","getData","setData","setShiftedFrames","TouchEvent","touch","changedTouches","cx","cy","trect","width","height","floor","Float32Array","Uint8Array","Uint16Array","buffer","position","Tracker"],"mappings":";CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAa,IAAID,IAEjBD,EAAU,IAAIC,IARhB,CASGK,QAAQ,WACX,O,YCTE,IAAIC,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUP,QAGnC,IAAIC,EAASI,EAAiBE,GAAY,CACzCC,EAAGD,EACHE,GAAG,EACHT,QAAS,IAUV,OANAU,EAAQH,GAAUI,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASM,GAG/DL,EAAOQ,GAAI,EAGJR,EAAOD,QA0Df,OArDAM,EAAoBM,EAAIF,EAGxBJ,EAAoBO,EAAIR,EAGxBC,EAAoBQ,EAAI,SAASd,EAASe,EAAMC,GAC3CV,EAAoBW,EAAEjB,EAASe,IAClCG,OAAOC,eAAenB,EAASe,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEV,EAAoBgB,EAAI,SAAStB,GACX,oBAAXuB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAenB,EAASuB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAenB,EAAS,aAAc,CAAEyB,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBQ,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAShC,GAChC,IAAIe,EAASf,GAAUA,EAAO2B,WAC7B,WAAwB,OAAO3B,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAK,EAAoBQ,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRV,EAAoBW,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG7B,EAAoBgC,EAAI,GAIjBhC,EAAoBA,EAAoBiC,EAAI,kB,6ECzEpD,IAEKC,IAAe,CAIjBC,QAAS,QAITC,OAAQ,CACNC,UAAc,EACdC,aAAc,EACdC,UAAc,EACdC,QAAc,GAGhBC,MAAO,CACLC,mBAAoB,IACpBC,mBAAoB,IACpBC,iBAAoB,KAGtBC,SAAU,IACVC,MAAO,QAIPtB,OAAQ,SAASuB,EAAKC,GAEpB,IAAIC,EAAsC,iBAAfF,EAAIE,QAAuB,CAAEC,MAAOH,EAAIE,SAAYF,EAAIE,QAC/EE,EAAeJ,EAAII,UAAYJ,EAAW,MAC1CK,EAAeJ,GAAUD,EAAIC,QAAW,GACxCK,EAAeN,EAAIM,QAAU,GAC7BC,EAAeP,EAAIO,WAAa,GAChCC,EAAe,GACfC,EAAe,GAEfC,EAAM,SAASC,GACjB,IAAIC,EAAOC,MAAMC,QAAQH,EAAEC,MAAQD,EAAEC,KAAQD,EAAEC,KAAO,CAACD,EAAEC,MAAQ,CAACzB,EAAaW,UAC/EU,EAAIG,EAAEjD,MAAQ8C,EAAIG,EAAEjD,OAAS,GAC7B,IAAK,IAAIkB,EAAI,EAAIA,EAAIgC,EAAKG,OAASnC,IACjC6B,EAAYG,EAAKhC,IAAM6B,EAAYG,EAAKhC,KAAO,GAC/C6B,EAAYG,EAAKhC,IAAIoC,KAAKL,EAAEjD,MAE5B8C,EAAIG,EAAEjD,MAAMkD,EAAKhC,IAAM+B,EAAEM,IAAML,EAAKhC,GAElC+B,EAAEM,KACJR,EAAYE,EAAEM,IAAMR,EAAYE,EAAEM,KAAO,KAGzCf,IACFA,EAAQgB,MAAQhB,EAAQgB,OAAS,UACjCR,EAAI,CAAEhD,KAAMwC,EAAQgB,MAAON,KAAM,OAAQK,GAAIf,EAAQC,SAGvD,IAAI,IAAIvB,EAAI,EAAIA,EAAI0B,EAAOS,OAASnC,IAClC8B,EAAIJ,EAAO1B,IAEb,IAAI,IAAIlB,KAAQ8C,EACVA,EAAIxB,eAAetB,KACrB2C,EAAI3C,GAAQyB,EAAagC,WAAWzD,EAAM8C,EAAI9C,KAGlD,IAAI,IAAIA,KAAQ6C,EACVA,EAAUvB,eAAetB,KAC3B2C,EAAI3C,GAAQ6C,EAAU7C,IAe1B,OAZA2C,EAAIe,QAAc,OAClBf,EAAIgB,GAAc,SAASlB,GAAS,OAAOU,MAAMC,QAAQX,GAAUA,EAAMmB,QAAQC,KAAKH,UAAY,EAAMG,KAAKH,UAAYjB,GACzHE,EAAImB,IAAc,SAASN,GAAS,OAAQK,KAAKE,iBAA8BC,IAAflB,EAAIU,KAA0BV,EAAIU,GAAOlC,eAAeuC,KAAKH,UAAYZ,EAAIU,GAAOlC,eAAeG,EAAaW,YAChLO,EAAIsB,OAAc,SAAST,GAAS,OAAQK,KAAKC,IAAIN,IACrDb,EAAII,YAAc,WAAkB,OAAQA,EAAYc,KAAKH,UAAY,IAAIQ,OAAOnB,EAAYtB,EAAaW,WAAa,KAC1HO,EAAIwB,WAAc,WAAkB,OAAON,KAAKF,GAAGjB,IACnDC,EAAIyB,MAAc9B,EAAI8B,OAAS,SAASpE,EAAMkD,EAAMK,EAAIc,EAAMD,EAAOE,EAAKrB,GAAK,MAAMA,GAAKqB,GAC1F3B,EAAI4B,OAAc,WAAa,OAAOpE,OAAOqE,KAAKzB,GAAa0B,QAE3DjC,IAAYA,EAAQkC,OACtB/B,EAAIH,EAAQgB,SAEPb,GAMTgC,WAAY,SAAShC,EAAKiC,EAAM5E,EAAMkD,EAAMK,EAAIc,GAC9C,GAAIO,EACF,IACE,OAAOA,EAAKC,MAAMlC,EAAK,CAAC3C,EAAMkD,EAAMK,GAAIW,OAAOG,IAEjD,MAAMpB,GACJ,OAAON,EAAIyB,MAAMpE,EAAMkD,EAAMK,EAAIc,EAAM5C,EAAaO,MAAMG,iBAAkB,+DAAgEc,KAKlJ6B,eAAiB,SAASnC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAmB,cAAyB3C,EAAMkD,EAAMK,EAAIc,IACvJU,cAAiB,SAASpC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAkB,cAAKA,EAAa,QAAQ3C,EAAMkD,EAAMK,EAAIc,IACvJW,cAAiB,SAASrC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAkB,aAA0B3C,EAAMkD,EAAMK,EAAIc,IACvJY,cAAiB,SAAStC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAkB,cAAKA,EAAa,QAAQ3C,EAAMkD,EAAMK,EAAIc,IACvJa,YAAiB,SAASvC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAmB,cAAyB3C,EAAMkD,EAAMK,EAAIc,IAEvJc,gBAAiB,SAASxC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAI,WAAa3C,GAA2BA,EAAMkD,EAAMK,EAAIc,IACvJe,eAAiB,SAASzC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAI,UAAa3C,IAAS2C,EAAI,KAAO3C,GAAOA,EAAMkD,EAAMK,EAAIc,IACvJgB,eAAiB,SAAS1C,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAI,UAAaO,GAA2BlD,EAAMkD,EAAMK,EAAIc,IACvJiB,eAAiB,SAAS3C,EAAK3C,EAAMkD,EAAMK,EAAIc,GAAQ,OAAO5C,EAAakD,WAAWhC,EAAKA,EAAI,UAAaY,IAASZ,EAAI,KAAOY,GAAOvD,EAAMkD,EAAMK,EAAIc,IAEvJkB,YAAa,SAAS5C,EAAK3C,EAAMkD,EAAMK,EAAIc,GACzC,IAAK,IAAU5C,EAAa0D,gBAAgBxC,EAAK3C,EAAMkD,EAAMK,EAAIc,KAC5D,IAAU5C,EAAaqD,eAAgBnC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAC/D,OAAO,GAGXmB,WAAY,SAAS7C,EAAK3C,EAAMkD,EAAMK,EAAIc,GACxC5C,EAAa2D,eAAezC,EAAK3C,EAAMkD,EAAMK,EAAIc,GACjD5C,EAAasD,cAAepC,EAAK3C,EAAMkD,EAAMK,EAAIc,IAGnDoB,WAAY,SAAS9C,EAAK3C,EAAMkD,EAAMK,EAAIc,GACxC,IAAIqB,EAAWjE,EAAa4D,eAAe1C,EAAK3C,EAAMkD,EAAMK,EAAIc,GAC5DsB,EAAWlE,EAAauD,cAAerC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAChE,OAAK,IAAUqB,IAAc,IAAUC,IAE7BlE,EAAaY,QAAUqD,GAAcjE,EAAaY,QAAUsD,EAC7DlE,EAAaY,WADjB,IAIPuD,WAAY,SAASjD,EAAK3C,EAAMkD,EAAMK,EAAIc,GACxC5C,EAAa6D,eAAe3C,EAAK3C,EAAMkD,EAAMK,EAAIc,GACjD5C,EAAawD,cAAetC,EAAK3C,EAAMkD,EAAMK,EAAIc,IAKnDZ,WAAY,SAASzD,EAAM8C,GACzB,OAAO,WAEL,IAAII,EAAQW,KAAKH,QACbH,EAAQT,EAAII,KAAUJ,EAAIrB,EAAaW,WAAaX,EAAaW,SAAWU,EAAIrB,EAAaW,UAAYc,IAASA,EAClHmB,EAAQlB,MAAM9B,UAAUwE,MAAMjG,KAAKkG,WAEvC,GAAIjC,KAAKE,WACP,OAAOF,KAAKO,MAAMpE,EAAMkD,EAAMK,EAAIc,EAAM5C,EAAaO,MAAME,mBAAoB,SAAWlC,EAAO,+DAEnG,GAAI6D,KAAKI,OAAOjE,GACd,OAAO6D,KAAKO,MAAMpE,EAAMkD,EAAMK,EAAIc,EAAM5C,EAAaO,MAAMC,mBAAoB,SAAWjC,EAAO,mCAAqC6D,KAAKH,SAE7I,IAAI,IAAUjC,EAAa8D,YAAY1B,KAAM7D,EAAMkD,EAAMK,EAAIc,GAC3D,OAAO5C,EAAaE,OAAOG,UAE7B,GAAIoB,IAASK,EAEX,OADA9B,EAAa+D,WAAW3B,KAAM7D,EAAMkD,EAAMK,EAAIc,GACvC5C,EAAaE,OAAOE,aAI7B,IAAIc,EAAMkB,KACVA,KAAKE,WAAa,WAMhB,OALApB,EAAIoB,WAAa,KACjBpB,EAAIe,QAAUH,EACd9B,EAAamE,WAAYjD,EAAK3C,EAAMkD,EAAMK,EAAIc,GAC9C5C,EAAayD,YAAYvC,EAAK3C,EAAMkD,EAAMK,EAAIc,GAC9C5C,EAAa+D,WAAY7C,EAAK3C,EAAMkD,EAAMK,EAAIc,GACvC5C,EAAaE,OAAOC,WAE7BiC,KAAKE,WAAWgC,OAAS,WACvBpD,EAAIoB,WAAa,KACjBtC,EAAa+D,WAAW7C,EAAK3C,EAAMkD,EAAMK,EAAIc,IAG/C,IAAI2B,EAAQvE,EAAagE,WAAW5B,KAAM7D,EAAMkD,EAAMK,EAAIc,GAC1D,OAAI,IAAU2B,GACZnC,KAAKE,WAAa,KACXtC,EAAaE,OAAOG,WAEpBL,EAAaY,QAAU2D,EACvBvE,EAAaE,OAAOI,QAGvB8B,KAAKE,WACAF,KAAKE,kBADd,KAe+B7E,EAAOD,UAC1CA,EAAUC,EAAOD,QAAUwC,GAE7BxC,EAAQwC,aAAeA,G,gDC5M3B,OAmCe,UAnCU,CACvBwE,QAAS,CACPzD,QAAS,UACTI,OAAQ,CACN,CAAE5C,KAAM,aAAckD,KAAM,UAAWK,GAAI,UAC3C,CAAEvD,KAAM,QAASkD,KAAM,SAAUK,GAAI,WACrC,CAAEvD,KAAM,MAAOkD,KAAM,UAAWK,GAAI,YAIxChB,OAAQ,CACNC,QAAS,UACTI,OAAQ,CACN,CAAE5C,KAAM,aAAckD,KAAM,UAAWK,GAAI,YAC3C,CAAEvD,KAAM,WAAYkD,KAAM,WAAYK,GAAI,UAC1C,CAAEvD,KAAM,aAAckD,KAAM,SAAUK,GAAI,cAI9C2C,MAAO,CACL1D,QAAS,UACTI,OAAQ,CACN,CAAE5C,KAAM,aAAckD,KAAM,UAAWK,GAAI,eAC3C,CAAEvD,KAAM,QAASkD,KAAM,cAAeK,GAAI,UAC1C,CAAEvD,KAAM,QAASkD,KAAM,CAAC,SAAU,SAAUK,GAAI,eAChD,CAAEvD,KAAM,QAASkD,KAAM,SAAUK,GAAI,WACrC,CAAEvD,KAAM,OAAQkD,KAAM,UAAWK,GAAI,UACrC,CAAEvD,KAAM,QAASkD,KAAM,UAAWK,GAAI,WACtC,CAAEvD,KAAM,SAAUkD,KAAM,UAAWK,GAAI,WACvC,CAAEvD,KAAM,OAAQkD,KAAM,UAAWK,GAAI,UACrC,CAAEvD,KAAM,QAASkD,KAAM,IAAKK,GAAI,a,mDClCtC,sCAwBA,OAvBkB,EAAA4C,UAAY,YAEZ,EAAAC,QAAU,UAEV,EAAAC,UAAY,YAEZ,EAAAC,WAAa,aAEb,EAAAC,WAAa,aAEb,EAAAC,MAAQ,QAER,EAAAC,YAAc,WAEd,EAAAC,YAAc,cAEd,EAAAC,WAAa,aAEb,EAAAC,SAAW,WAEX,EAAAC,UAAY,YAEZ,EAAAC,YAAc,cAChC,EAxBA,GAAqB,a,8CCArB,wLAsBQC,EAAA,KAAAA,IAAKC,EAAA,KAAAA,IAiBb,IAAIC,EAAK,EAOT,iBA+BE,WACUC,EACRC,GAFF,WACU,KAAAD,YA7BF,KAAAE,OAAkC,IAAIC,IAItC,KAAAC,QAAU,EAEV,KAAAC,SAAW,EAEX,KAAAC,cAAgC,GAMhC,KAAAC,OAAS,EAET,KAAAC,GAAK,EAEL,KAAAC,GAAK,EAEL,KAAAC,GAAK,EAYX/D,KAAKoD,GAvCPA,GAAM,EA8CJ,IALA,IAAMY,EAAkBhE,KAAKqD,UAAUY,cACrC,cAEIC,EAAM5E,MAAMD,KAAK2E,EAAgBG,UAE9BvI,EAAI,EAAGC,EAAIqI,EAAI1E,OAAQ5D,EAAIC,EAAGD,GAAK,EAAG,CAC7C,IAAMwI,EAAKF,EAAItI,GACTyI,EAAaD,EAAGE,QAAQC,WAE9B,GAAkB,MAAdF,EACF,MAAM,IAAIlG,MAAM,qCAGlB,IAAMqG,EACJJ,EAAGK,kBAAoB,EAAInF,MAAMD,KAAK+E,EAAGD,UAAY,CAACC,GAElDM,EAzER,iBAAkBlJ,QAClBmJ,UAAUC,eAAiB,GAC3BD,UAAUE,iBAAmB,EAuEwB,UAAf,UAEpC7E,KAAKuD,OAAOuB,IAAIT,EAAY,CAC1BU,SAAU,IAAI,UAASP,GACvB7E,MAAO,IAAI+E,EAAQF,KAIhB,IAAArH,EAAA,kCACDoG,EAASvD,KAAKuD,OAAO9G,IAAIU,GAC/B6C,KAAKgF,kBAAoB7H,EACzB6C,KAAK+E,SAAWxB,EAAOwB,SACvB/E,KAAKL,MAAQ4D,EAAO5D,MACpBK,KAAKL,MAAMsF,aAAajF,KAAKqD,WAE7BrD,KAAKqC,MAAQ,SAAW,UAAQA,OAEhB,MAAZiB,GACFtD,KAAKkF,gBAAgB5B,GAGvBtD,KAAKmF,OAAS,WACZ,GAAI,EAAKxB,cAAcnE,OAAS,EAG9B,IAFA,IAAM,EAAS,EAAKuF,SAASK,YAEpBxJ,EAAI,EAAGC,EAAI,EAAK8H,cAAcnE,OAAQ5D,EAAIC,EAAGD,GAAK,EACzD,EAAK+H,cAAc/H,GAAG,GAI1B,EAAK8H,SAAW2B,sBAAsB,EAAKF,SAG7CnF,KAAKsF,MAAQ,SAACC,GACZ,IAAIC,EAAW,EACXC,GAAe,EAEnB,GAAI,EAAK9F,MAAM+F,aAAc,CAC3B,IAAMC,EAAQ,EAAKhG,MAAMiG,qBACzB,GAAID,EAAQ,EAAK/B,OAAQ,CACvB,IAAMiC,EAAQ,EAAKlG,MAAMmG,gBACnB,gBAAChJ,EAAA,KAAGiJ,EAAA,KAAGC,EAAA,KAEb,GAAI,EAAKnC,GAAK,EAAG,CACf,IAAMoC,EAAKnJ,EAAI,EAAK+G,GACdqC,EAAKH,EAAI,EAAKjC,GACdqC,EAAKH,EAAI,EAAKjC,GAEhBkC,EA/HK,IAgIPT,EApHd,SAAqBS,EAAYC,EAAYC,GAC3C,OAAIF,EAAK,EACA9C,EAAID,EAAIgD,EAAKD,GAAK/C,EAAIiD,EAAKF,IAE7B,EAgHgBG,CAAYH,EAAIC,EAAIC,IAInC,EAAKtC,GAAK/G,EACV,EAAKgH,GAAKiC,EACV,EAAKhC,GAAKiC,EAEV,EAAKpC,OAAS+B,EAGhBF,EAAc,EAAK9F,MAAM0G,uBAG3B,EAAKtB,SAASuB,OAAOf,EAAOC,EAAUC,GAEtC,EAAKhC,QAAU4B,sBAAsB,EAAKC,QAuFhD,OAnFS,YAAAiB,MAAP,WACE,OAAOvG,KAAKoD,IAIP,YAAAoD,UAAP,WACExG,KAAKyD,QAAU4B,sBAAsBrF,KAAKsF,OAC1CtF,KAAK0D,SAAW2B,sBAAsBrF,KAAKmF,SAItC,YAAAsB,SAAP,WACEzG,KAAK+E,SAAS2B,UAEdC,qBAAqB3G,KAAKyD,SAC1BkD,qBAAqB3G,KAAK0D,WAIrB,YAAAkD,UAAP,WACE5G,KAAK6D,GAAK,EACV7D,KAAK8D,GAAK,EACV9D,KAAK+D,GAAK,EACV/D,KAAK4D,OAAS,EAEd5D,KAAK6G,mBAGA,YAAAC,qBAAP,WACE,OAAO9G,KAAKgF,mBAGP,YAAA+B,cAAP,SAAqB5J,GACnB,IAAMoG,EAASvD,KAAKuD,OAAO9G,IAAIU,GAE/B,GAAc,MAAVoG,EACF,MAAM,IAAIpF,MAAM,8BAGlB6B,KAAKgF,kBAAoB7H,EAEzB6C,KAAK6G,kBACL7G,KAAKgH,qBAELhH,KAAK+E,SAAWxB,EAAOwB,SACvB/E,KAAKL,MAAQ4D,EAAO5D,MACpBK,KAAKiH,mBAGA,YAAAC,iBAAP,SAAwB5D,GACtBhH,OAAO6K,OAAOnH,KAAKqC,MAAOiB,IAGrB,YAAA4B,gBAAP,SAAuB5B,GACrB,GAAKhE,MAAMC,QAAQ+D,GAGjB,IAAK,IAAI1H,EAAI,EAAGC,EAAIyH,EAAS9D,OAAQ5D,EAAIC,EAAGD,GAAK,EAC/CoE,KAAK2D,cAAclE,KAAK6D,EAAS1H,GAAGwB,KAAK4C,YAH3CA,KAAK2D,cAAclE,KAAK6D,EAASlG,KAAK4C,QAQnC,YAAAoH,kBAAP,WACEpH,KAAK2D,cAAcnE,OAAS,GAGtB,YAAAyH,gBAAR,WACOjH,KAAKL,MAAM+F,cACd1F,KAAKL,MAAMsF,aAAajF,KAAKqD,YAIzB,YAAA2D,mBAAR,WACMhH,KAAKL,MAAM+F,cACb1F,KAAKL,MAAM0H,gBAAgBrH,KAAKqD,YAI5B,YAAAwD,gBAAR,WACE7G,KAAKL,MAAM2H,mBACXtH,KAAK+E,SAASwC,eAElB,EA7MA,G,+bC1CQC,EAAAC,SAAAD,gBAER,SAASE,EAEP9I,EACAe,GAEA,GAAMA,aAAiBgI,YAID,WAAlB/I,EAAMiB,QAAV,CAIAjB,EAAM8I,QAEN,IAAM5K,EAAI8K,YAAYC,MAEhBC,EAAgBN,EAAgBO,wBAChChC,EAAIpG,EAAMqI,QAAUF,EAAKG,KACzBjC,EAAIrG,EAAMuI,QAAUJ,EAAKK,IAE/BnI,KAAKoI,OAAOC,SAAS,CAACvL,EAAGiJ,EAAGC,KAG9B,SAASsC,EAEP1J,EACAe,GAEA,GAAMA,aAAiBgI,YAID,YAAlB/I,EAAMiB,QAAV,CAIA,IAAM/C,EAAI8K,YAAYC,MAEhBC,EAAgBN,EAAgBO,wBAChChC,EAAIpG,EAAMqI,QAAUF,EAAKG,KACzBjC,EAAIrG,EAAMuI,QAAUJ,EAAKK,IAE/BnI,KAAKoI,OAAOC,SAAS,CAACvL,EAAGiJ,EAAGC,KAG9B,SAASuC,EAEP3J,EACAe,GAEA,GAAMA,aAAiBgI,YAID,YAAlB/I,EAAMiB,QAAV,CAIA,IAAM/C,EAAI8K,YAAYC,MAEhBC,EAAgBN,EAAgBO,wBAChChC,EAAIpG,EAAMqI,QAAUF,EAAKG,KACzBjC,EAAIrG,EAAMuI,QAAUJ,EAAKK,IAE/BnI,KAAKoI,OAAOC,SAAS,CAACvL,EAAGiJ,EAAGC,IAE5BpH,EAAM2J,OAGR,SAASC,EAA6B7I,GACpC,IAAM8I,EAAQzI,KAAK0I,iBACjB,SAAC5L,GAAgC,OAAAA,EAAEsH,KAAQzE,EAAMjB,UAE7CA,EAASsB,KAAK2I,QAAQF,GAEd,MAAV/J,GAIyB,aAAzBA,EAAOE,MAAMiB,SAIjBnB,EAAOE,MAAM4J,WAGf,SAASI,EAA+BjJ,GACtC,IAAM8I,EAAQzI,KAAK0I,iBACjB,SAAC5L,GAAgC,OAAAA,EAAEsH,KAAQzE,EAAMjB,UAE7CA,EAASsB,KAAK2I,QAAQF,GAEd,MAAV/J,GAIyB,WAAzBA,EAAOE,MAAMiB,SAIjBnB,EAAOE,MAAMgK,aAGf,kBACE,WAAmB1E,GAAnB,MACE,YAAMA,IAAI,K,OAEV,EAAK2E,SAAW,CACdnB,MAAOA,EAAMtK,KAAK,EAAM,EAAKwB,OAC7B2J,IAAKA,EAAInL,KAAK,EAAM,EAAKwB,OACzB0J,KAAMA,EAAKlL,KAAK,EAAM,EAAKwB,OAC3B4J,SAAUA,EAASpL,KAAK,GACxBwL,WAAYA,EAAWxL,KAAK,I,EAyDlC,OAlE0C,OAajC,YAAA6H,aAAP,SAAoBb,GAClB,GAAqB,MAAjBpE,KAAK6I,SAAT,CAIA7I,KAAK8I,UAAW,EAEhB1E,EAAG2E,iBAAiB,UAAUzG,UAAWtC,KAAK6I,SAASnB,OAAO,GAC9DtD,EAAG2E,iBAAiB,UAAUvG,UAAWxC,KAAK6I,SAASP,MAAM,GAC7DlE,EAAG2E,iBAAiB,UAAUxG,QAASvC,KAAK6I,SAASN,KAAK,GAE1D,IAAK,IAAI3M,EAAI,EAAGC,EAAImE,KAAK2I,QAAQnJ,OAAQ5D,EAAIC,EAAGD,GAAK,EAAG,CACtD,IAAM8C,EAASsB,KAAK2I,QAAQ/M,GAE5B8C,EAAO0F,GAAG2E,iBACR,UAAUtG,WACVzC,KAAK6I,SAASL,UACd,GAEF9J,EAAO0F,GAAG2E,iBACR,UAAUrG,WACV1C,KAAK6I,SAASD,YACd,MAKC,YAAAvB,gBAAP,SAAuBjD,GACrB,GAAqB,MAAjBpE,KAAK6I,SAAT,CAIA7I,KAAK8I,UAAW,EAEhB1E,EAAG4E,oBAAoB,UAAU1G,UAAWtC,KAAK6I,SAASnB,OAAO,GACjEtD,EAAG4E,oBAAoB,UAAUxG,UAAWxC,KAAK6I,SAASP,MAAM,GAChElE,EAAG4E,oBAAoB,UAAUzG,QAASvC,KAAK6I,SAASN,KAAK,GAE7D,IAAK,IAAI3M,EAAI,EAAGC,EAAImE,KAAK2I,QAAQnJ,OAAQ5D,EAAIC,EAAGD,GAAK,EAAG,CACtD,IAAM8C,EAASsB,KAAK2I,QAAQ/M,GAE5B8C,EAAO0F,GAAG4E,oBACR,UAAUvG,WACVzC,KAAK6I,SAASL,UACd,GAEF9J,EAAO0F,GAAG4E,oBACR,UAAUtG,WACV1C,KAAK6I,SAASD,YACd,MAIR,EAlEA,CAA0C,W,qEC9G1C,kJAeMK,EAAW,SAACvK,GAAqC,OAAAA,EAAOuK,YAE9D,aAWE,WAAmB/E,GAFT,KAAA4E,UAAW,EAGnB9I,KAAK2I,QAAUzE,EAAIjF,KAAI,SAACmF,GACtB,IAAM1F,EAAS,IAAI,UAAO0F,GAE1B,OADA1F,EAAOE,MAAMsK,aACNxK,KAGTsB,KAAKpB,MAAQ,eAAa1B,OAAO,UAAQkF,SACzCpC,KAAKpB,MAAMsK,aAEXlJ,KAAKoI,OAAS,IAAI,UAzBH,IADA,GA2BfpI,KAAK6I,SAAW,GA6CpB,OA1CY,YAAAH,gBAAV,SACES,GAIA,IAFA,IAAIC,GAAU,EAELxN,EAAI,EAAGC,EAAImE,KAAK2I,QAAQnJ,OAAQ5D,EAAIC,EAAGD,GAAK,EAAG,CAGtD,GAAIuN,EAFMnJ,KAAK2I,QAAQ/M,IAEL,CAChBwN,EAASxN,EACT,OAIJ,OAAOwN,GAGF,YAAA/C,qBAAP,WAGE,OAFoBrG,KAAK0I,gBAAgBO,IAKpC,YAAArD,mBAAP,WACE,OAAO5F,KAAKoI,OAAOzC,OAGd,YAAAG,cAAP,WACE,OAAO9F,KAAKoI,OAAOiB,YAGd,YAAA/B,iBAAP,WACE,OAAOtH,KAAKoI,OAAOkB,eAGd,YAAA5D,WAAP,WACE,OAAO1F,KAAK8I,UAMhB,EAnEA,GAqEe,a,iDCtFf,mCAOQS,EAAA,KAAAA,MAER,aAmBE,WAAmBrF,GAdX,KAAAsF,OAAS,EAET,KAAAC,SAAU,EAEV,KAAAC,YAAc,EAEd,KAAAC,SAAW,EASjB,IAAMC,EAAY1F,EAAI1E,OAEtBQ,KAAK6J,UAAYD,EAAY,EAE7B5J,KAAK8J,OAAS,IAAItG,IAAI,CACpB,CAAC,OAAQxD,KAAK+J,gBACd,CAAC,WAAY/J,KAAK+J,gBAClB,CAAC,WAAY/J,KAAK+J,kBAGpB/J,KAAKgK,cAAgB,CACnBC,KAAM,EACNC,SAAU,EACVC,SAAU,GAGZnK,KAAKoK,SAAW9K,MAAMsK,EAAY,GAAGS,KAAK,GAgH9C,OA7GS,YAAA/D,OAAP,SAAcf,EAAeC,EAAkBC,GAC7C,IAAMI,EAAQ7F,KAAKoK,SAASpI,MAAM,GAC5BsI,EAActK,KAAK8J,OAAOrN,IAAI,QAEpC,GAAKuD,KAAKyJ,QAMH,CACLzJ,KAAK0J,aAAenE,EAAQvF,KAAK2J,SACjC3J,KAAK2J,SAAWpE,EAEhB,IAAMgF,EAAgBhB,EAAMvJ,KAAK0J,aAzDrB,IADN,KA4DFa,EAAgBvK,KAAKwJ,SACvBxJ,KAAKwJ,OAASe,EACd1E,EAAM,GAAK7F,KAAKwJ,OAEZ/D,GAAe,IACjBI,EAAMJ,EAAc,GAAKD,GAG3B8E,EAAYE,SAAS3E,EAAO7F,KAAKwJ,cAnBnCxJ,KAAKyJ,SAAU,EACfzJ,KAAK2J,SAAWpE,EAEhBM,EAAM,GAAK7F,KAAKwJ,OAChBc,EAAYE,SAAS3E,EAAO7F,KAAKwJ,SAoB7B,YAAAO,aAAR,WACE,IAAMU,EAAU,IAAI,UA3EL,MA2EyBzK,KAAK6J,WAE7C,OADAY,EAAQC,cACDD,GAGF,YAAAE,eAAP,WACE,OAAO3K,KAAK0J,aAGP,YAAAtE,UAAP,WACE,OAAOpF,KAAKwJ,QAGP,YAAAoB,UAAP,SAAiBpB,GACf,IAAM3D,EAAQ7F,KAAKoK,SAASpI,MAAM,GAClC6D,EAAM,GAAK2D,EACVxJ,KAAK8J,OAAOrN,IAAI,QAAoB+N,SAAS3E,EAAO2D,GAErD,IACMqB,GADOrB,EAASxJ,KAAKwJ,SA3Fb,IADN,IA8FRxJ,KAAK0J,aAAemB,EACpB7K,KAAKwJ,OAASA,GAGT,YAAA9C,QAAP,WACE1G,KAAKyJ,SAAU,GAGV,YAAAlC,YAAP,WACEvH,KAAKwJ,OAAS,EACdxJ,KAAKyJ,SAAU,EACfzJ,KAAK2J,SAAW,EAChB3J,KAAK0J,YAAc,GAGd,YAAAoB,YAAP,SAAmB/N,QAAA,IAAAA,MAAA,QAChBiD,KAAK8J,OAAOrN,IAAIM,GAAkB2N,eAG9B,YAAAK,eAAP,SAAsBhO,GACpB,YADoB,IAAAA,MAAA,QACZiD,KAAK8J,OAAOrN,IAAIM,GAAkB4I,OAGrC,YAAAqF,cAAP,SAAqBpH,EAAa7G,QAAb,IAAA6G,OAAU,QAAG,IAAA7G,MAAA,QAChC,IAAMkO,EAAUrH,EAAS5D,KAAKgK,cAAcjN,GACtC8I,EAAS7F,KAAK8J,OAAOrN,IAAIM,GAAkBsM,SAAS4B,GAE1D,OADmB3L,MAAMD,KAAKwG,EAAMqF,SAAS,KAIxC,YAAAC,UAAP,SAAiBpO,QAAA,IAAAA,MAAA,QACf,IAAM0N,EAAUzK,KAAK8J,OAAOrN,IAAIM,GAChC,OAAO0N,EAAQpB,SAAS,EAAGoB,EAAQW,OAG9B,YAAAC,UAAP,SAAiBC,EAAsBvO,QAAA,IAAAA,MAAA,QACpCiD,KAAK8J,OAAOrN,IAAIM,GAAkByN,SAASc,IAGvC,YAAAC,QAAP,SAAeC,GACZxL,KAAK8J,OAAOrN,IAAI,QAAoB4L,SAASmD,IAGzC,YAAAC,QAAP,SACE7H,EACA+B,EACA5I,QAFA,IAAA6G,OAAU,QACV,IAAA+B,MAAA,QACA,IAAA5I,MAAA,QAEA,IAAMkO,EAAUrH,EAAS5D,KAAKgK,cAAcjN,GAC5C,OAAQiD,KAAK8J,OAAOrN,IAAIM,GAAkBsM,SAAS4B,EAAStF,IAGvD,YAAA+F,QAAP,SAAe7F,EAAiBjC,EAAY7G,QAAZ,IAAA6G,MAAA,QAAY,IAAA7G,MAAA,QACzCiD,KAAK8J,OAAOrN,IAAIM,GAAkByN,SAAS3E,EAAOjC,IAG9C,YAAA+H,iBAAP,SAAwBnC,EAAgBzM,QAAA,IAAAA,MAAA,QACtCiD,KAAKgK,cAAcjN,GAAQyM,GAE/B,EApJA,G,4DCTA,mGAIA,aAGE,WAA0BpF,GAAA,KAAAA,KACxBpE,KAAKpB,MAAQ,eAAa1B,OAAO,UAAQwB,QAM7C,OAHS,YAAAuK,SAAP,WACE,MAA8B,WAAvBjJ,KAAKpB,MAAMiB,SAEtB,EAVA,G,+bCAQ2H,EAAAC,SAAAD,gBAER,SAASE,EAEP9I,EACAe,GAEA,GAAMA,aAAiBiM,YAID,WAAlBhN,EAAMiB,QAAV,CAIAjB,EAAM8I,QAEN,IAAM5K,EAAI8K,YAAYC,MAEhBC,EAAgBN,EAAgBO,wBAChC8D,EAAevM,MAAMD,KAAKM,EAAMmM,gBAAgB,GAChD/F,EAAI8F,EAAM7D,QAAUF,EAAKG,KACzBjC,EAAI6F,EAAM3D,QAAUJ,EAAKK,IAE/BnI,KAAKoI,OAAOC,SAAS,CAACvL,EAAGiJ,EAAGC,KAG9B,SAASsC,EAEP1J,EACAe,GAEA,GAAMA,aAAiBiM,YAID,YAAlBhN,EAAMiB,QAAV,CAaA,IATA,IAAM/C,EAAI8K,YAAYC,MAEhBC,EAAgBN,EAAgBO,wBAChC8D,EAAevM,MAAMD,KAAKM,EAAMmM,gBAAgB,GAChDC,EAAKF,EAAM7D,QACXgE,EAAKH,EAAM3D,QACXnC,EAAIgG,EAAKjE,EAAKG,KACdjC,EAAIgG,EAAKlE,EAAKK,IAEXvM,EAAI,EAAGC,EAAImE,KAAK2I,QAAQnJ,OAAQ5D,EAAIC,EAAGD,GAAK,EAAG,CACtD,IAAM8C,EAASsB,KAAK2I,QAAQ/M,GACtBqQ,EAAiBvN,EAAO0F,GAAG2D,wBAG/BgE,GAAME,EAAMhE,MACZ8D,GAAME,EAAMhE,KAAOgE,EAAMC,OACzBF,GAAMC,EAAM9D,KACZ6D,GAAMC,EAAM9D,IAAM8D,EAAME,OAGK,WAAzBzN,EAAOE,MAAMiB,SACfnB,EAAOE,MAAM4J,WAEmB,aAAzB9J,EAAOE,MAAMiB,SACtBnB,EAAOE,MAAMgK,aAIjB5I,KAAKoI,OAAOC,SAAS,CAACvL,EAAGiJ,EAAGC,KAG9B,SAASuC,EAEP3J,EACAe,GAEA,GAAMA,aAAiBiM,YAID,YAAlBhN,EAAMiB,QAAV,CAIA,IAAM/C,EAAI8K,YAAYC,MAEhBC,EAAgBN,EAAgBO,wBAChC8D,EAAevM,MAAMD,KAAKM,EAAMmM,gBAAgB,GAChD/F,EAAI8F,EAAM7D,QAAUF,EAAKG,KACzBjC,EAAI6F,EAAM3D,QAAUJ,EAAKK,IAE/BnI,KAAKoI,OAAOC,SAAS,CAACvL,EAAGiJ,EAAGC,IAE5BpH,EAAM2J,OAGR,kBACE,WAAmBrE,GAAnB,MACE,YAAMA,IAAI,K,OAEV,EAAK2E,SAAW,CACdnB,MAAOA,EAAMtK,KAAK,EAAM,EAAKwB,OAC7B0J,KAAMA,EAAKlL,KAAK,EAAM,EAAKwB,OAC3B2J,IAAKA,EAAInL,KAAK,EAAM,EAAKwB,Q,EAmC/B,OA1C0C,OAWjC,YAAAqG,aAAP,SAAoBb,GACG,MAAjBpE,KAAK6I,WAIL7I,KAAK8I,WAGT9I,KAAK8I,UAAW,EAEhB1E,EAAG2E,iBAAiB,UAAUjG,WAAY9C,KAAK6I,SAASnB,OAAO,GAC/DtD,EAAG2E,iBAAiB,UAAU/F,UAAWhD,KAAK6I,SAASP,MAAM,GAC7DlE,EAAG2E,iBAAiB,UAAUhG,SAAU/C,KAAK6I,SAASN,KAAK,GAC3DnE,EAAG2E,iBAAiB,UAAU9F,YAAajD,KAAK6I,SAASN,KAAK,MAGzD,YAAAlB,gBAAP,SAAuBjD,GACA,MAAjBpE,KAAK6I,UAIJ7I,KAAK8I,WAGV9I,KAAK8I,UAAW,EAEhB1E,EAAG4E,oBAAoB,UAAUlG,WAAY9C,KAAK6I,SAASnB,OAAO,GAClEtD,EAAG4E,oBAAoB,UAAUhG,UAAWhD,KAAK6I,SAASP,MAAM,GAChElE,EAAG4E,oBAAoB,UAAUjG,SAAU/C,KAAK6I,SAASN,KAAK,GAC9DnE,EAAG4E,oBAAoB,UAAU/F,YAAajD,KAAK6I,SAASN,KAAK,KAErE,EA1CA,CAA0C,W,6DClGlC,WAAA6D,EAAA,KAAAA,MASR,iBAOE,WAAmB5M,EAAgBqK,GAFzB,KAAAtB,IAAM,EAGdvI,KAAK6J,UAAYA,EAEjB,IACE7J,KAAKsL,OAAS,IAAIe,aAAa7M,EAASQ,KAAK6J,WAC7C,MAAOzK,GACP,MAAM,IAAIjB,MAAM,0BAGlB,IAtBE,IAAImO,WAAW,IAAIC,YAAY,CAAC,MAASC,QAAQ,GAuBjD,MAAM,IAAIrO,MAAM,iCAmEtB,OA/DE,sBAAI,oBAAK,C,IAAT,WACE,OAAOiO,EAAMpM,KAAKuI,IAAMvI,KAAK6J,Y,gCAG/B,sBAAI,mBAAI,C,IAAR,WACE,OAAOuC,EAAMpM,KAAKsL,OAAO9L,OAASQ,KAAK6J,Y,gCAGlC,YAAAW,SAAP,SAAgB3E,EAAgCjC,GAC9C,QAD8C,IAAAA,MAAA,GAC1CiC,EAAMrG,OAASQ,KAAK6J,WAAc,EACpC,MAAM,IAAI1L,MAAM,0BAGlB,IAAMsO,EAAW7I,EAAS5D,KAAK6J,UAC/B7J,KAAKsL,OAAOxG,IAAIe,EAAO4G,GAEnBA,EAAW5G,EAAMrG,QAAUQ,KAAKuI,MAClCvI,KAAKuI,IAAMkE,EAAW5G,EAAMrG,SAKzB,YAAA6I,SAAP,SAAgBxC,GACd,GAAIA,EAAMrG,OAASQ,KAAK6J,WAAc,EACpC,MAAM,IAAI1L,MAAM,0BAGlB6B,KAAKsL,OAAOxG,IAAIe,EAAO7F,KAAKuI,KAC5BvI,KAAKuI,KAAO1C,EAAMrG,QAIb,YAAA6J,SAAP,SAAgBzF,EAAa+B,QAAb,IAAA/B,OAAU,QAAG,IAAA+B,MAAA,GAC3B,IAAM8G,EACJ7I,EAAS,GACJ5D,KAAK2F,MAAQ/B,GAAU5D,KAAK6J,UAC7BjG,EAAS5D,KAAK6J,UAEdtB,EAAMkE,EAAW9G,EAAQ3F,KAAK6J,UAGpC,OAFc7J,KAAKsL,OAAOJ,SAASuB,EAAUlE,IAKxC,YAAAe,YAAP,WACEtJ,KAAKuI,IAAM,EACXvI,KAAKsL,OAAOjB,KAAK,IAGZ,YAAAK,YAAP,WACE1K,KAAKsJ,cAEL,IAAK,IAAI1N,EAAI,EAAGC,EAAImE,KAAKsL,OAAO9L,OAAQmG,EAAQ,EAAG/J,EAAIC,EAAGD,GAAK,EACzDA,EAAIoE,KAAK6J,WAAc,IACzB7J,KAAKsL,OAAOxG,IAAI,CAACa,GAAQ/J,GACzB+J,GAAS,IAKD,EAAAzI,OAAd,SAAqBsC,EAAgBqK,GACnC,OAAO,IAAI6C,EAAQlN,EAAQqK,IAE/B,EApFA,G","file":"rub.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Rub\"] = factory();\n\telse\n\t\troot[\"Rub\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","/*\n\n  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine\n\n  Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors\n  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE\n\n*/\n\n(function () {\n\n  var StateMachine = {\n\n    //---------------------------------------------------------------------------\n\n    VERSION: \"2.4.0\",\n\n    //---------------------------------------------------------------------------\n\n    Result: {\n      SUCCEEDED:    1, // the event transitioned successfully from one state to another\n      NOTRANSITION: 2, // the event was successfull but no state transition was necessary\n      CANCELLED:    3, // the event was cancelled by the caller in a beforeEvent callback\n      PENDING:      4  // the event is asynchronous and the caller is in control of when the transition occurs\n    },\n\n    Error: {\n      INVALID_TRANSITION: 100, // caller tried to fire an event that was innapropriate in the current state\n      PENDING_TRANSITION: 200, // caller tried to fire an event while an async transition was still pending\n      INVALID_CALLBACK:   300 // caller provided callback function threw an exception\n    },\n\n    WILDCARD: '*',\n    ASYNC: 'async',\n\n    //---------------------------------------------------------------------------\n\n    create: function(cfg, target) {\n\n      var initial      = (typeof cfg.initial == 'string') ? { state: cfg.initial } : cfg.initial; // allow for a simple string, or an object with { state: 'foo', event: 'setup', defer: true|false }\n      var terminal     = cfg.terminal || cfg['final'];\n      var fsm          = target || cfg.target  || {};\n      var events       = cfg.events || [];\n      var callbacks    = cfg.callbacks || {};\n      var map          = {}; // track state transitions allowed for an event { event: { from: [ to ] } }\n      var transitions  = {}; // track events allowed from a state            { state: [ event ] }\n\n      var add = function(e) {\n        var from = Array.isArray(e.from) ? e.from : (e.from ? [e.from] : [StateMachine.WILDCARD]); // allow 'wildcard' transition if 'from' is not specified\n        map[e.name] = map[e.name] || {};\n        for (var n = 0 ; n < from.length ; n++) {\n          transitions[from[n]] = transitions[from[n]] || [];\n          transitions[from[n]].push(e.name);\n\n          map[e.name][from[n]] = e.to || from[n]; // allow no-op transition if 'to' is not specified\n        }\n        if (e.to)\n          transitions[e.to] = transitions[e.to] || [];\n      };\n\n      if (initial) {\n        initial.event = initial.event || 'startup';\n        add({ name: initial.event, from: 'none', to: initial.state });\n      }\n\n      for(var n = 0 ; n < events.length ; n++)\n        add(events[n]);\n\n      for(var name in map) {\n        if (map.hasOwnProperty(name))\n          fsm[name] = StateMachine.buildEvent(name, map[name]);\n      }\n\n      for(var name in callbacks) {\n        if (callbacks.hasOwnProperty(name))\n          fsm[name] = callbacks[name]\n      }\n\n      fsm.current     = 'none';\n      fsm.is          = function(state) { return Array.isArray(state) ? (state.indexOf(this.current) >= 0) : (this.current === state); };\n      fsm.can         = function(event) { return !this.transition && (map[event] !== undefined) && (map[event].hasOwnProperty(this.current) || map[event].hasOwnProperty(StateMachine.WILDCARD)); }\n      fsm.cannot      = function(event) { return !this.can(event); };\n      fsm.transitions = function()      { return (transitions[this.current] || []).concat(transitions[StateMachine.WILDCARD] || []); };\n      fsm.isFinished  = function()      { return this.is(terminal); };\n      fsm.error       = cfg.error || function(name, from, to, args, error, msg, e) { throw e || msg; }; // default behavior when something unexpected happens is to throw an exception, but caller can override this behavior if desired (see github issue #3 and #17)\n      fsm.states      = function() { return Object.keys(transitions).sort() };\n\n      if (initial && !initial.defer)\n        fsm[initial.event]();\n\n      return fsm;\n\n    },\n\n    //===========================================================================\n\n    doCallback: function(fsm, func, name, from, to, args) {\n      if (func) {\n        try {\n          return func.apply(fsm, [name, from, to].concat(args));\n        }\n        catch(e) {\n          return fsm.error(name, from, to, args, StateMachine.Error.INVALID_CALLBACK, \"an exception occurred in a caller-provided callback function\", e);\n        }\n      }\n    },\n\n    beforeAnyEvent:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onbeforeevent'],                       name, from, to, args); },\n    afterAnyEvent:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onafterevent'] || fsm['onevent'],      name, from, to, args); },\n    leaveAnyState:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onleavestate'],                        name, from, to, args); },\n    enterAnyState:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onenterstate'] || fsm['onstate'],      name, from, to, args); },\n    changeState:     function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onchangestate'],                       name, from, to, args); },\n\n    beforeThisEvent: function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onbefore' + name],                     name, from, to, args); },\n    afterThisEvent:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onafter'  + name] || fsm['on' + name], name, from, to, args); },\n    leaveThisState:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onleave'  + from],                     name, from, to, args); },\n    enterThisState:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onenter'  + to]   || fsm['on' + to],   name, from, to, args); },\n\n    beforeEvent: function(fsm, name, from, to, args) {\n      if ((false === StateMachine.beforeThisEvent(fsm, name, from, to, args)) ||\n          (false === StateMachine.beforeAnyEvent( fsm, name, from, to, args)))\n        return false;\n    },\n\n    afterEvent: function(fsm, name, from, to, args) {\n      StateMachine.afterThisEvent(fsm, name, from, to, args);\n      StateMachine.afterAnyEvent( fsm, name, from, to, args);\n    },\n\n    leaveState: function(fsm, name, from, to, args) {\n      var specific = StateMachine.leaveThisState(fsm, name, from, to, args),\n          general  = StateMachine.leaveAnyState( fsm, name, from, to, args);\n      if ((false === specific) || (false === general))\n        return false;\n      else if ((StateMachine.ASYNC === specific) || (StateMachine.ASYNC === general))\n        return StateMachine.ASYNC;\n    },\n\n    enterState: function(fsm, name, from, to, args) {\n      StateMachine.enterThisState(fsm, name, from, to, args);\n      StateMachine.enterAnyState( fsm, name, from, to, args);\n    },\n\n    //===========================================================================\n\n    buildEvent: function(name, map) {\n      return function() {\n\n        var from  = this.current;\n        var to    = map[from] || (map[StateMachine.WILDCARD] != StateMachine.WILDCARD ? map[StateMachine.WILDCARD] : from) || from;\n        var args  = Array.prototype.slice.call(arguments); // turn arguments into pure array\n\n        if (this.transition)\n          return this.error(name, from, to, args, StateMachine.Error.PENDING_TRANSITION, \"event \" + name + \" inappropriate because previous transition did not complete\");\n\n        if (this.cannot(name))\n          return this.error(name, from, to, args, StateMachine.Error.INVALID_TRANSITION, \"event \" + name + \" inappropriate in current state \" + this.current);\n\n        if (false === StateMachine.beforeEvent(this, name, from, to, args))\n          return StateMachine.Result.CANCELLED;\n\n        if (from === to) {\n          StateMachine.afterEvent(this, name, from, to, args);\n          return StateMachine.Result.NOTRANSITION;\n        }\n\n        // prepare a transition method for use EITHER lower down, or by caller if they want an async transition (indicated by an ASYNC return value from leaveState)\n        var fsm = this;\n        this.transition = function() {\n          fsm.transition = null; // this method should only ever be called once\n          fsm.current = to;\n          StateMachine.enterState( fsm, name, from, to, args);\n          StateMachine.changeState(fsm, name, from, to, args);\n          StateMachine.afterEvent( fsm, name, from, to, args);\n          return StateMachine.Result.SUCCEEDED;\n        };\n        this.transition.cancel = function() { // provide a way for caller to cancel async transition if desired (issue #22)\n          fsm.transition = null;\n          StateMachine.afterEvent(fsm, name, from, to, args);\n        }\n\n        var leave = StateMachine.leaveState(this, name, from, to, args);\n        if (false === leave) {\n          this.transition = null;\n          return StateMachine.Result.CANCELLED;\n        }\n        else if (StateMachine.ASYNC === leave) {\n          return StateMachine.Result.PENDING;\n        }\n        else {\n          if (this.transition) // need to check in case user manually called transition() but forgot to return StateMachine.ASYNC\n            return this.transition();\n        }\n\n      };\n    }\n\n  }; // StateMachine\n\n  //===========================================================================\n\n  //======\n  // NODE\n  //======\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = StateMachine;\n    }\n    exports.StateMachine = StateMachine;\n  }\n  //============\n  // AMD/REQUIRE\n  //============\n  else if (typeof define === 'function' && define.amd) {\n    define(function(require) { return StateMachine; });\n  }\n  //========\n  // BROWSER\n  //========\n  else if (typeof window !== 'undefined') {\n    window.StateMachine = StateMachine;\n  }\n  //===========\n  // WEB WORKER\n  //===========\n  else if (typeof self !== 'undefined') {\n    self.StateMachine = StateMachine;\n  }\n\n}());\n","interface Dataset {\n  [index: string]: StateMachine.StateMachineConfig;\n}\n\nconst dataset: Dataset = {\n  pointer: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'idling' },\n      { name: 'start', from: 'idling', to: 'running' },\n      { name: 'end', from: 'running', to: 'idling' },\n    ],\n  },\n\n  target: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'inactive' },\n      { name: 'activate', from: 'inactive', to: 'active' },\n      { name: 'inactivate', from: 'active', to: 'inactive' },\n    ],\n  },\n\n  media: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'initialized' },\n      { name: 'ready', from: 'initialized', to: 'idling' },\n      { name: 'reset', from: ['idling', 'error'], to: 'initialized' },\n      { name: 'start', from: 'idling', to: 'running' },\n      { name: 'stop', from: 'running', to: 'idling' },\n      { name: 'pause', from: 'running', to: 'pending' },\n      { name: 'resume', from: 'pending', to: 'running' },\n      { name: 'quit', from: 'pending', to: 'idling' },\n      { name: 'abort', from: '*', to: 'error' },\n    ],\n  },\n};\n\nexport default dataset;\n","export default class EventType {\n  static readonly MouseDown = 'mousedown';\n\n  static readonly MouseUp = 'mouseup';\n\n  static readonly MouseMove = 'mousemove';\n\n  static readonly MouseEnter = 'mouseenter';\n\n  static readonly MouseLeave = 'mouseleave';\n\n  static readonly Click = 'click';\n\n  static readonly DoubleClick = 'dblclick';\n\n  static readonly ContextMenu = 'contextmenu';\n\n  static readonly TouchStart = 'touchstart';\n\n  static readonly TouchEnd = 'touchend';\n\n  static readonly TouchMove = 'touchmove';\n\n  static readonly TouchCancel = 'touchcancel';\n}\n","import * as JSM from 'javascript-state-machine';\nimport MouseHandler from './mouse-handler.ts';\nimport TouchHandler from './touch-handler.ts';\nimport Recorder from './recorder.ts';\nimport dataset from './dataset.ts';\nimport {\n  MediaStateMachine,\n  MediaStateCallback,\n  BoundsType,\n  Bounds,\n  LoopCallback,\n  RecorderInterface,\n  PointerHandlerInterface,\n  RubInterface,\n} from './interface.ts';\n\ninterface Loop {\n  (ctime: number): void;\n}\n\nconst MIN_INTERVAL = 4;\nconst BOUNDS_ID = 'rb-bounds';\nconst { abs, max } = Math;\n\nfunction isTouchEnabled(): boolean {\n  return (\n    'ontouchstart' in window ||\n    navigator.maxTouchPoints > 0 ||\n    navigator.msMaxTouchPoints > 0\n  );\n}\n\nfunction getVelocity(dt: number, dx: number, dy: number): number {\n  if (dt > 0) {\n    return max(abs(dx / dt), abs(dy / dt));\n  }\n  return 0;\n}\n\nlet id = 0;\n\nfunction genId(): number {\n  id += 1;\n  return id;\n}\n\nexport default class Rub implements RubInterface {\n  private id: number;\n\n  private bounds: Map<BoundsType, Bounds> = new Map();\n\n  private currentBoundsType: BoundsType;\n\n  private inputId = 0;\n\n  private outputId = 0;\n\n  private loopCallbacks: LoopCallback[] = [];\n\n  private input: Loop;\n\n  private output: Loop;\n\n  private offset = 0;\n\n  private t0 = 0;\n\n  private x0 = 0;\n\n  private y0 = 0;\n\n  public event: PointerHandlerInterface;\n\n  public recorder: RecorderInterface;\n\n  public media: MediaStateMachine;\n\n  public constructor(\n    private container: HTMLDivElement,\n    callback?: LoopCallback | LoopCallback[]\n  ) {\n    this.id = genId();\n\n    const boundsContainer = this.container.querySelector(\n      `.${BOUNDS_ID}`\n    ) as HTMLDivElement;\n    const els = Array.from(boundsContainer.children) as HTMLDivElement[];\n\n    for (let i = 0, l = els.length; i < l; i += 1) {\n      const el = els[i];\n      const identifier = el.dataset.boundsType as BoundsType;\n\n      if (identifier == null) {\n        throw new Error('cannot find identified class name');\n      }\n\n      const targetEls =\n        el.childElementCount > 0 ? Array.from(el.children) : [el];\n\n      const Handler = !isTouchEnabled() ? MouseHandler : TouchHandler;\n\n      this.bounds.set(identifier, {\n        recorder: new Recorder(targetEls as HTMLDivElement[]),\n        event: new Handler(targetEls as HTMLDivElement[]),\n      });\n    }\n\n    const [key] = Array.from(this.bounds.keys());\n    const bounds = this.bounds.get(key) as Bounds;\n    this.currentBoundsType = key;\n    this.recorder = bounds.recorder;\n    this.event = bounds.event;\n    this.event.addListeners(this.container);\n\n    this.media = JSM.create(dataset.media) as MediaStateMachine;\n\n    if (callback != null) {\n      this.addLoopCallback(callback);\n    }\n\n    this.output = (): void => {\n      if (this.loopCallbacks.length > 0) {\n        const frames = this.recorder.getFrames();\n\n        for (let i = 0, l = this.loopCallbacks.length; i < l; i += 1) {\n          this.loopCallbacks[i](frames);\n        }\n      }\n\n      this.outputId = requestAnimationFrame(this.output);\n    };\n\n    this.input = (ctime: number): void => {\n      let velocity = 0;\n      let targetIndex = -1;\n\n      if (this.event.isAttached()) {\n        const count = this.event.getEventTrackCount();\n        if (count > this.offset) {\n          const track = this.event.getEventTrack();\n          const [t, x, y] = Array.from(track);\n\n          if (this.t0 > 0) {\n            const dt = t - this.t0;\n            const dx = x - this.x0;\n            const dy = y - this.y0;\n\n            if (dt > MIN_INTERVAL) {\n              velocity = getVelocity(dt, dx, dy);\n            }\n          }\n\n          this.t0 = t;\n          this.x0 = x;\n          this.y0 = y;\n\n          this.offset = count;\n        }\n\n        targetIndex = this.event.getActiveTargetIndex();\n      }\n\n      this.recorder.update(ctime, velocity, targetIndex);\n\n      this.inputId = requestAnimationFrame(this.input);\n    };\n  }\n\n  public getId(): number {\n    return this.id;\n  }\n\n  /* ポインターイベントの速度計測とその出力を開始または再開する。 */\n  public startLoop(): void {\n    this.inputId = requestAnimationFrame(this.input);\n    this.outputId = requestAnimationFrame(this.output);\n  }\n\n  /* レコーディングを一時停止する。経過時間は停止した時点のまま */\n  public stopLoop(): void {\n    this.recorder.suspend();\n\n    cancelAnimationFrame(this.inputId);\n    cancelAnimationFrame(this.outputId);\n  }\n\n  /* レコーディングの状態を初期に戻す */\n  public clearLoop(): void {\n    this.t0 = 0;\n    this.x0 = 0;\n    this.y0 = 0;\n    this.offset = 0;\n\n    this.resetBoundsType();\n  }\n\n  public getCurrentBoundsType(): BoundsType {\n    return this.currentBoundsType;\n  }\n\n  public setBoundsType(key: BoundsType): void {\n    const bounds = this.bounds.get(key);\n\n    if (bounds == null) {\n      throw new Error('this is assigned undefined');\n    }\n\n    this.currentBoundsType = key;\n\n    this.resetBoundsType();\n    this.removeEventHandler();\n\n    this.recorder = bounds.recorder;\n    this.event = bounds.event;\n    this.setEventHandler();\n  }\n\n  public setMediaCallback(callback: MediaStateCallback): void {\n    Object.assign(this.media, callback);\n  }\n\n  public addLoopCallback(callback: LoopCallback | LoopCallback[]): void {\n    if (!Array.isArray(callback)) {\n      this.loopCallbacks.push(callback.bind(this));\n    } else {\n      for (let i = 0, l = callback.length; i < l; i += 1) {\n        this.loopCallbacks.push(callback[i].bind(this));\n      }\n    }\n  }\n\n  public clearLoopCallback(): void {\n    this.loopCallbacks.length = 0;\n  }\n\n  private setEventHandler(): void {\n    if (!this.event.isAttached()) {\n      this.event.addListeners(this.container);\n    }\n  }\n\n  private removeEventHandler(): void {\n    if (this.event.isAttached()) {\n      this.event.removeListeners(this.container);\n    }\n  }\n\n  private resetBoundsType(): void {\n    this.event.clearEventTracks();\n    this.recorder.resetFrames();\n  }\n}\n","import PointerHandler from './pointer-handler.ts';\nimport { TargetInterface, PointerStateMachine } from './interface.ts';\nimport EventType from './event-type.ts';\n\nconst { documentElement } = document;\n\nfunction start(\n  this: MouseHandler,\n  state: PointerStateMachine,\n  event: MouseEvent | TouchEvent\n): void {\n  if (!(event instanceof MouseEvent)) {\n    return;\n  }\n\n  if (state.current !== 'idling') {\n    return;\n  }\n\n  state.start();\n\n  const t = performance.now();\n\n  const rect: DOMRect = documentElement.getBoundingClientRect();\n  const x = event.clientX - rect.left;\n  const y = event.clientY - rect.top;\n\n  this.coords.addTrack([t, x, y]);\n}\n\nfunction move(\n  this: MouseHandler,\n  state: PointerStateMachine,\n  event: MouseEvent | TouchEvent\n): void {\n  if (!(event instanceof MouseEvent)) {\n    return;\n  }\n\n  if (state.current !== 'running') {\n    return;\n  }\n\n  const t = performance.now();\n\n  const rect: DOMRect = documentElement.getBoundingClientRect();\n  const x = event.clientX - rect.left;\n  const y = event.clientY - rect.top;\n\n  this.coords.addTrack([t, x, y]);\n}\n\nfunction end(\n  this: MouseHandler,\n  state: PointerStateMachine,\n  event: MouseEvent | TouchEvent\n): void {\n  if (!(event instanceof MouseEvent)) {\n    return;\n  }\n\n  if (state.current !== 'running') {\n    return;\n  }\n\n  const t = performance.now();\n\n  const rect: DOMRect = documentElement.getBoundingClientRect();\n  const x = event.clientX - rect.left;\n  const y = event.clientY - rect.top;\n\n  this.coords.addTrack([t, x, y]);\n\n  state.end();\n}\n\nfunction activate(this: MouseHandler, event: MouseEvent | TouchEvent): void {\n  const index = this.findTargetIndex(\n    (t: TargetInterface): boolean => t.el === (event.target as HTMLDivElement)\n  );\n  const target = this.targets[index];\n\n  if (target == null) {\n    return;\n  }\n\n  if (target.state.current !== 'inactive') {\n    return;\n  }\n\n  target.state.activate();\n}\n\nfunction inactivate(this: MouseHandler, event: MouseEvent | TouchEvent): void {\n  const index = this.findTargetIndex(\n    (t: TargetInterface): boolean => t.el === (event.target as HTMLDivElement)\n  );\n  const target = this.targets[index];\n\n  if (target == null) {\n    return;\n  }\n\n  if (target.state.current !== 'active') {\n    return;\n  }\n\n  target.state.inactivate();\n}\n\nexport default class MouseHandler extends PointerHandler {\n  public constructor(els: HTMLDivElement[]) {\n    super(els);\n\n    this.listener = {\n      start: start.bind(this, this.state),\n      end: end.bind(this, this.state),\n      move: move.bind(this, this.state),\n      activate: activate.bind(this),\n      inactivate: inactivate.bind(this),\n    };\n  }\n\n  public addListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    this.attached = true;\n\n    el.addEventListener(EventType.MouseDown, this.listener.start, false);\n    el.addEventListener(EventType.MouseMove, this.listener.move, false);\n    el.addEventListener(EventType.MouseUp, this.listener.end, false);\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n\n      target.el.addEventListener(\n        EventType.MouseEnter,\n        this.listener.activate,\n        false\n      );\n      target.el.addEventListener(\n        EventType.MouseLeave,\n        this.listener.inactivate,\n        false\n      );\n    }\n  }\n\n  public removeListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    this.attached = false;\n\n    el.removeEventListener(EventType.MouseDown, this.listener.start, false);\n    el.removeEventListener(EventType.MouseMove, this.listener.move, false);\n    el.removeEventListener(EventType.MouseUp, this.listener.end, false);\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n\n      target.el.removeEventListener(\n        EventType.MouseEnter,\n        this.listener.activate,\n        false\n      );\n      target.el.removeEventListener(\n        EventType.MouseLeave,\n        this.listener.inactivate,\n        false\n      );\n    }\n  }\n}\n","import { StateMachine } from 'javascript-state-machine';\nimport {\n  PointerHandlerInterface,\n  PointerStateMachine,\n  ListenerInterface,\n  TargetInterface,\n  TrackerInterface,\n} from './interface.ts';\nimport Target from './target.ts';\nimport Tracker from './tracker.ts';\nimport dataset from './dataset.ts';\n\nconst BLOCK_SIZE = 3; // [t, x, y]\nconst TRACK_SIZE = 900000; // (bytes)\n\nconst isActive = (target: TargetInterface): boolean => target.isActive();\n\nabstract class PointerHandler implements PointerHandlerInterface {\n  protected state: PointerStateMachine;\n\n  protected listener: ListenerInterface;\n\n  protected targets: TargetInterface[];\n\n  protected coords: TrackerInterface;\n\n  protected attached = false;\n\n  public constructor(els: HTMLDivElement[]) {\n    this.targets = els.map((el) => {\n      const target = new Target(el);\n      target.state.initialize();\n      return target;\n    });\n\n    this.state = StateMachine.create(dataset.pointer) as PointerStateMachine;\n    this.state.initialize();\n\n    this.coords = new Tracker(TRACK_SIZE, BLOCK_SIZE);\n    this.listener = {};\n  }\n\n  protected findTargetIndex(\n    predicate: (target: TargetInterface) => boolean\n  ): number {\n    let result = -1;\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const t = this.targets[i];\n\n      if (predicate(t)) {\n        result = i;\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  public getActiveTargetIndex(): number {\n    const targetIndex = this.findTargetIndex(isActive);\n\n    return targetIndex;\n  }\n\n  public getEventTrackCount(): number {\n    return this.coords.count;\n  }\n\n  public getEventTrack(): Float32Array {\n    return this.coords.getTrack();\n  }\n\n  public clearEventTracks(): void {\n    return this.coords.clearTracks();\n  }\n\n  public isAttached(): boolean {\n    return this.attached;\n  }\n\n  public abstract addListeners(el: HTMLDivElement): void;\n\n  public abstract removeListeners(el: HTMLDivElement): void;\n}\n\nexport default PointerHandler;\n","import Tracker from './tracker.ts';\nimport { RecordMode, Record, RecorderInterface } from './interface.ts';\n\nconst TRACK_SIZE = 216000;\nconst FPS = 60;\nconst PER_FRAME = 1000 / FPS;\n\nconst { round } = Math;\n\nexport default class Recorder implements RecorderInterface {\n  public record: Record;\n\n  private blockSize: number;\n\n  private frames = 0;\n\n  private started = false;\n\n  private elapsedTime = 0;\n\n  private lastTime = 0;\n\n  private template: number[];\n\n  private shiftedFrames: {\n    [P in RecordMode]: number;\n  };\n\n  public constructor(els: HTMLDivElement[]) {\n    const targetNum = els.length;\n\n    this.blockSize = targetNum + 1;\n\n    this.record = new Map([\n      ['live', this.createRecord()],\n      ['playback', this.createRecord()],\n      ['external', this.createRecord()],\n    ]);\n\n    this.shiftedFrames = {\n      live: 0,\n      playback: 0,\n      external: 0,\n    };\n\n    this.template = Array(targetNum + 1).fill(0);\n  }\n\n  public update(ctime: number, velocity: number, targetIndex: number): void {\n    const track = this.template.slice(0);\n    const liveTracker = this.record.get('live') as Tracker;\n\n    if (!this.started) {\n      this.started = true;\n      this.lastTime = ctime;\n\n      track[0] = this.frames;\n      liveTracker.setTrack(track, this.frames);\n    } else {\n      this.elapsedTime += ctime - this.lastTime;\n      this.lastTime = ctime;\n\n      const currentFrames = round(this.elapsedTime / PER_FRAME);\n\n      if (currentFrames > this.frames) {\n        this.frames = currentFrames;\n        track[0] = this.frames;\n\n        if (targetIndex > -1) {\n          track[targetIndex + 1] = velocity;\n        }\n\n        liveTracker.setTrack(track, this.frames);\n      }\n    }\n  }\n\n  private createRecord(): Tracker {\n    const tracker = new Tracker(TRACK_SIZE, this.blockSize);\n    tracker.writeFrames();\n    return tracker;\n  }\n\n  public getElapsedTime(): number {\n    return this.elapsedTime;\n  }\n\n  public getFrames(): number {\n    return this.frames;\n  }\n\n  public setFrames(frames: number): void {\n    const track = this.template.slice(0);\n    track[0] = frames;\n    (this.record.get('live') as Tracker).setTrack(track, frames);\n\n    const diff = frames - this.frames;\n    const shift = diff * PER_FRAME;\n    this.elapsedTime += shift;\n    this.frames = frames;\n  }\n\n  public suspend(): void {\n    this.started = false;\n  }\n\n  public resetFrames(): void {\n    this.frames = 0;\n    this.started = false;\n    this.lastTime = 0;\n    this.elapsedTime = 0;\n  }\n\n  public clearRecord(mode: RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).writeFrames();\n  }\n\n  public getRecordCount(mode: RecordMode = 'live'): number {\n    return (this.record.get(mode) as Tracker).count;\n  }\n\n  public getVelocities(offset = -1, mode: RecordMode = 'live'): number[] {\n    const shifted = offset + this.shiftedFrames[mode];\n    const track = (this.record.get(mode) as Tracker).getTrack(shifted);\n    const velocities = Array.from(track.subarray(1));\n    return velocities;\n  }\n\n  public getRecord(mode: RecordMode = 'live'): Float32Array {\n    const tracker = this.record.get(mode) as Tracker;\n    return tracker.getTrack(0, tracker.size);\n  }\n\n  public setRecord(tracks: Float32Array, mode: RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).setTrack(tracks);\n  }\n\n  public addData(data: number[]): void {\n    (this.record.get('live') as Tracker).addTrack(data);\n  }\n\n  public getData(\n    offset = -1,\n    count = 1,\n    mode: RecordMode = 'live'\n  ): Float32Array {\n    const shifted = offset + this.shiftedFrames[mode];\n    return (this.record.get(mode) as Tracker).getTrack(shifted, count);\n  }\n\n  public setData(track: number[], offset = 0, mode: RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).setTrack(track, offset);\n  }\n\n  public setShiftedFrames(frames: number, mode: RecordMode = 'live'): void {\n    this.shiftedFrames[mode] = frames;\n  }\n}\n","import { StateMachine } from 'javascript-state-machine';\nimport { TargetInterface, TargetStateMachine } from './interface.ts';\nimport dataset from './dataset.ts';\n\nexport default class Target implements TargetInterface {\n  public state: TargetStateMachine;\n\n  public constructor(public el: HTMLDivElement) {\n    this.state = StateMachine.create(dataset.target) as TargetStateMachine;\n  }\n\n  public isActive(): boolean {\n    return this.state.current === 'active';\n  }\n}\n","import PointerHandler from './pointer-handler.ts';\nimport { PointerStateMachine } from './interface.ts';\nimport EventType from './event-type.ts';\n\nconst { documentElement } = document;\n\nfunction start(\n  this: TouchHandler,\n  state: PointerStateMachine,\n  event: MouseEvent | TouchEvent\n): void {\n  if (!(event instanceof TouchEvent)) {\n    return;\n  }\n\n  if (state.current !== 'idling') {\n    return;\n  }\n\n  state.start();\n\n  const t = performance.now();\n\n  const rect: DOMRect = documentElement.getBoundingClientRect();\n  const touch: Touch = Array.from(event.changedTouches)[0];\n  const x = touch.clientX - rect.left;\n  const y = touch.clientY - rect.top;\n\n  this.coords.addTrack([t, x, y]);\n}\n\nfunction move(\n  this: TouchHandler,\n  state: PointerStateMachine,\n  event: MouseEvent | TouchEvent\n): void {\n  if (!(event instanceof TouchEvent)) {\n    return;\n  }\n\n  if (state.current !== 'running') {\n    return;\n  }\n\n  const t = performance.now();\n\n  const rect: DOMRect = documentElement.getBoundingClientRect();\n  const touch: Touch = Array.from(event.changedTouches)[0];\n  const cx = touch.clientX;\n  const cy = touch.clientY;\n  const x = cx - rect.left;\n  const y = cy - rect.top;\n\n  for (let i = 0, l = this.targets.length; i < l; i += 1) {\n    const target = this.targets[i];\n    const trect: DOMRect = target.el.getBoundingClientRect();\n\n    const isActive =\n      cx >= trect.left &&\n      cx <= trect.left + trect.width &&\n      cy >= trect.top &&\n      cy <= trect.top + trect.height;\n\n    if (isActive) {\n      if (target.state.current !== 'active') {\n        target.state.activate();\n      }\n    } else if (target.state.current !== 'inactive') {\n      target.state.inactivate();\n    }\n  }\n\n  this.coords.addTrack([t, x, y]);\n}\n\nfunction end(\n  this: TouchHandler,\n  state: PointerStateMachine,\n  event: MouseEvent | TouchEvent\n): void {\n  if (!(event instanceof TouchEvent)) {\n    return;\n  }\n\n  if (state.current !== 'running') {\n    return;\n  }\n\n  const t = performance.now();\n\n  const rect: DOMRect = documentElement.getBoundingClientRect();\n  const touch: Touch = Array.from(event.changedTouches)[0];\n  const x = touch.clientX - rect.left;\n  const y = touch.clientY - rect.top;\n\n  this.coords.addTrack([t, x, y]);\n\n  state.end();\n}\n\nexport default class TouchHandler extends PointerHandler {\n  public constructor(els: HTMLDivElement[]) {\n    super(els);\n\n    this.listener = {\n      start: start.bind(this, this.state),\n      move: move.bind(this, this.state),\n      end: end.bind(this, this.state),\n    };\n  }\n\n  public addListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    if (this.attached) {\n      return;\n    }\n    this.attached = true;\n\n    el.addEventListener(EventType.TouchStart, this.listener.start, false);\n    el.addEventListener(EventType.TouchMove, this.listener.move, false);\n    el.addEventListener(EventType.TouchEnd, this.listener.end, false);\n    el.addEventListener(EventType.TouchCancel, this.listener.end, false);\n  }\n\n  public removeListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    if (!this.attached) {\n      return;\n    }\n    this.attached = false;\n\n    el.removeEventListener(EventType.TouchStart, this.listener.start, false);\n    el.removeEventListener(EventType.TouchMove, this.listener.move, false);\n    el.removeEventListener(EventType.TouchEnd, this.listener.end, false);\n    el.removeEventListener(EventType.TouchCancel, this.listener.end, false);\n  }\n}\n","import { TrackerInterface } from './interface.ts';\n\nconst { floor } = Math;\n\nfunction SystemGetExecutedInLittleEndian(): boolean {\n  if (new Uint8Array(new Uint16Array([0x00ff]).buffer)[0]) {\n    return true;\n  }\n  return false;\n}\n\nexport default class Tracker implements TrackerInterface {\n  public readonly blockSize: number;\n\n  protected tracks: Float32Array;\n\n  protected end = 0;\n\n  public constructor(length: number, blockSize: number) {\n    this.blockSize = blockSize;\n\n    try {\n      this.tracks = new Float32Array(length * this.blockSize);\n    } catch (e) {\n      throw new Error('cannot allocate memory');\n    }\n\n    if (!SystemGetExecutedInLittleEndian()) {\n      throw new Error('required little endian system');\n    }\n  }\n\n  get count(): number {\n    return floor(this.end / this.blockSize);\n  }\n\n  get size(): number {\n    return floor(this.tracks.length / this.blockSize);\n  }\n\n  public setTrack(track: number[] | Float32Array, offset = 0): void {\n    if (track.length % this.blockSize !== 0) {\n      throw new Error('Track size not matched');\n    }\n\n    const position = offset * this.blockSize;\n    this.tracks.set(track, position);\n\n    if (position + track.length >= this.end) {\n      this.end = position + track.length;\n    }\n  }\n\n  /* addTrack(), getLastTrack()はRecorderクラスでの使用を想定 */\n  public addTrack(track: number[]): void {\n    if (track.length % this.blockSize !== 0) {\n      throw new Error('Track size not matched');\n    }\n\n    this.tracks.set(track, this.end);\n    this.end += track.length;\n  }\n\n  /* 任意の場所からトラックデータを取得する。引数に何も指定しない場合、最後のブロックを取得する */\n  public getTrack(offset = -1, count = 1): Float32Array {\n    const position =\n      offset < 0\n        ? (this.count + offset) * this.blockSize\n        : offset * this.blockSize;\n\n    const end = position + count * this.blockSize;\n    const track = this.tracks.subarray(position, end);\n\n    return track;\n  }\n\n  public clearTracks(): void {\n    this.end = 0;\n    this.tracks.fill(0);\n  }\n\n  public writeFrames(): void {\n    this.clearTracks();\n\n    for (let i = 0, l = this.tracks.length, count = 0; i < l; i += 1) {\n      if (i % this.blockSize === 0) {\n        this.tracks.set([count], i);\n        count += 1;\n      }\n    }\n  }\n\n  public static create(length: number, blockSize: number): Tracker {\n    return new Tracker(length, blockSize);\n  }\n}\n"],"sourceRoot":""}