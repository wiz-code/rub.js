{"version":3,"sources":["webpack://Rub/webpack/universalModuleDefinition","webpack://Rub/./node_modules/javascript-state-machine/state-machine.js","webpack://Rub/./src/index.ts","webpack://Rub/./src/modules/dataset.ts","webpack://Rub/./src/modules/event-type.ts","webpack://Rub/./src/modules/mouse-handler.ts","webpack://Rub/./src/modules/pointer-handler.ts","webpack://Rub/./src/modules/recorder.ts","webpack://Rub/./src/modules/target.ts","webpack://Rub/./src/modules/touch-handler.ts","webpack://Rub/./src/modules/tracker.ts","webpack://Rub/webpack/bootstrap","webpack://Rub/webpack/startup","webpack://Rub/webpack/runtime/compat get default export","webpack://Rub/webpack/runtime/define property getters","webpack://Rub/webpack/runtime/hasOwnProperty shorthand","webpack://Rub/webpack/runtime/make namespace object"],"names":["root","factory","exports","module","define","amd","self","StateMachine","VERSION","Result","SUCCEEDED","NOTRANSITION","CANCELLED","PENDING","Error","INVALID_TRANSITION","PENDING_TRANSITION","INVALID_CALLBACK","WILDCARD","ASYNC","create","cfg","target","initial","state","terminal","fsm","events","callbacks","map","transitions","add","e","from","Array","isArray","name","n","length","push","to","event","hasOwnProperty","buildEvent","current","is","indexOf","this","can","transition","undefined","cannot","concat","isFinished","error","args","msg","states","Object","keys","sort","defer","doCallback","func","apply","beforeAnyEvent","afterAnyEvent","leaveAnyState","enterAnyState","changeState","beforeThisEvent","afterThisEvent","leaveThisState","enterThisState","beforeEvent","afterEvent","leaveState","specific","general","enterState","prototype","slice","call","arguments","cancel","leave","abs","max","Math","id","Rub","container","callback","bounds","Map","inputId","outputId","loopCallbacks","offset","t0","x0","y0","boundsContainer","querySelector","els","children","i","l","el","identifier","dataset","boundsType","targetEls","childElementCount","Handler","window","navigator","maxTouchPoints","msMaxTouchPoints","set","recorder","key","get","currentBoundsType","addListeners","media","addLoopCallback","output","frames","getFrames","requestAnimationFrame","input","ctime","velocity","targetIndex","isAttached","count","getEventTrackCount","track","getEventTrack","t","x","y","dt","dx","dy","getVelocity","getActiveTargetIndex","update","suspend","cancelAnimationFrame","resetBoundsType","removeEventHandler","setEventHandler","assign","bind","removeListeners","clearEventTracks","resetFrames","pointer","EventType","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave","Click","DoubleClick","ContextMenu","TouchStart","TouchEnd","TouchMove","TouchCancel","documentElement","document","MouseHandler","super","listener","start","end","move","activate","inactivate","attached","addEventListener","targets","removeEventListener","MouseEvent","performance","now","rect","getBoundingClientRect","clientX","left","clientY","top","coords","addTrack","index","findTargetIndex","isActive","initialize","predicate","result","getTrack","clearTracks","PER_FRAME","round","Recorder","started","elapsedTime","lastTime","targetNum","blockSize","record","createRecord","shiftedFrames","live","playback","external","template","fill","liveTracker","currentFrames","setTrack","tracker","writeFrames","shift","mode","shifted","subarray","size","tracks","data","Target","TouchHandler","TouchEvent","touch","changedTouches","cx","cy","trect","width","height","floor","Tracker","Float32Array","Uint8Array","Uint16Array","buffer","position","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","getter","__esModule","d","a","definition","o","defineProperty","enumerable","obj","prop","r","Symbol","toStringTag","value"],"mappings":";CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAa,IAAID,IAEjBD,EAAU,IAAIC,IARhB,CASGK,MAAM,WACT,O,2FCDC,IAEKC,IAAe,CAIjBC,QAAS,QAITC,OAAQ,CACNC,UAAc,EACdC,aAAc,EACdC,UAAc,EACdC,QAAc,GAGhBC,MAAO,CACLC,mBAAoB,IACpBC,mBAAoB,IACpBC,iBAAoB,KAGtBC,SAAU,IACVC,MAAO,QAIPC,OAAQ,SAASC,EAAKC,GAEpB,IAAIC,EAAsC,iBAAfF,EAAIE,QAAuB,CAAEC,MAAOH,EAAIE,SAAYF,EAAIE,QAC/EE,EAAeJ,EAAII,UAAYJ,EAAW,MAC1CK,EAAeJ,GAAUD,EAAIC,QAAW,GACxCK,EAAeN,EAAIM,QAAU,GAC7BC,EAAeP,EAAIO,WAAa,GAChCC,EAAe,GACfC,EAAe,GAEfC,EAAM,SAASC,GACjB,IAAIC,EAAOC,MAAMC,QAAQH,EAAEC,MAAQD,EAAEC,KAAQD,EAAEC,KAAO,CAACD,EAAEC,MAAQ,CAAC1B,EAAaW,UAC/EW,EAAIG,EAAEI,MAAQP,EAAIG,EAAEI,OAAS,GAC7B,IAAK,IAAIC,EAAI,EAAIA,EAAIJ,EAAKK,OAASD,IACjCP,EAAYG,EAAKI,IAAMP,EAAYG,EAAKI,KAAO,GAC/CP,EAAYG,EAAKI,IAAIE,KAAKP,EAAEI,MAE5BP,EAAIG,EAAEI,MAAMH,EAAKI,IAAML,EAAEQ,IAAMP,EAAKI,GAElCL,EAAEQ,KACJV,EAAYE,EAAEQ,IAAMV,EAAYE,EAAEQ,KAAO,KAGzCjB,IACFA,EAAQkB,MAAQlB,EAAQkB,OAAS,UACjCV,EAAI,CAAEK,KAAMb,EAAQkB,MAAOR,KAAM,OAAQO,GAAIjB,EAAQC,SAGvD,IAAI,IAAIa,EAAI,EAAIA,EAAIV,EAAOW,OAASD,IAClCN,EAAIJ,EAAOU,IAEb,IAAI,IAAID,KAAQP,EACVA,EAAIa,eAAeN,KACrBV,EAAIU,GAAQ7B,EAAaoC,WAAWP,EAAMP,EAAIO,KAGlD,IAAI,IAAIA,KAAQR,EACVA,EAAUc,eAAeN,KAC3BV,EAAIU,GAAQR,EAAUQ,IAe1B,OAZAV,EAAIkB,QAAc,OAClBlB,EAAImB,GAAc,SAASrB,GAAS,OAAOU,MAAMC,QAAQX,GAAUA,EAAMsB,QAAQC,KAAKH,UAAY,EAAMG,KAAKH,UAAYpB,GACzHE,EAAIsB,IAAc,SAASP,GAAS,OAAQM,KAAKE,iBAA8BC,IAAfrB,EAAIY,KAA0BZ,EAAIY,GAAOC,eAAeK,KAAKH,UAAYf,EAAIY,GAAOC,eAAenC,EAAaW,YAChLQ,EAAIyB,OAAc,SAASV,GAAS,OAAQM,KAAKC,IAAIP,IACrDf,EAAII,YAAc,WAAkB,OAAQA,EAAYiB,KAAKH,UAAY,IAAIQ,OAAOtB,EAAYvB,EAAaW,WAAa,KAC1HQ,EAAI2B,WAAc,WAAkB,OAAON,KAAKF,GAAGpB,IACnDC,EAAI4B,MAAcjC,EAAIiC,OAAS,SAASlB,EAAMH,EAAMO,EAAIe,EAAMD,EAAOE,EAAKxB,GAAK,MAAMA,GAAKwB,GAC1F9B,EAAI+B,OAAc,WAAa,OAAOC,OAAOC,KAAK7B,GAAa8B,QAE3DrC,IAAYA,EAAQsC,OACtBnC,EAAIH,EAAQkB,SAEPf,GAMToC,WAAY,SAASpC,EAAKqC,EAAM3B,EAAMH,EAAMO,EAAIe,GAC9C,GAAIQ,EACF,IACE,OAAOA,EAAKC,MAAMtC,EAAK,CAACU,EAAMH,EAAMO,GAAIY,OAAOG,IAEjD,MAAMvB,GACJ,OAAON,EAAI4B,MAAMlB,EAAMH,EAAMO,EAAIe,EAAMhD,EAAaO,MAAMG,iBAAkB,+DAAgEe,KAKlJiC,eAAiB,SAASvC,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAmB,cAAyBU,EAAMH,EAAMO,EAAIe,IACvJW,cAAiB,SAASxC,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAkB,cAAKA,EAAa,QAAQU,EAAMH,EAAMO,EAAIe,IACvJY,cAAiB,SAASzC,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAkB,aAA0BU,EAAMH,EAAMO,EAAIe,IACvJa,cAAiB,SAAS1C,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAkB,cAAKA,EAAa,QAAQU,EAAMH,EAAMO,EAAIe,IACvJc,YAAiB,SAAS3C,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAmB,cAAyBU,EAAMH,EAAMO,EAAIe,IAEvJe,gBAAiB,SAAS5C,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAI,WAAaU,GAA2BA,EAAMH,EAAMO,EAAIe,IACvJgB,eAAiB,SAAS7C,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAI,UAAaU,IAASV,EAAI,KAAOU,GAAOA,EAAMH,EAAMO,EAAIe,IACvJiB,eAAiB,SAAS9C,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAI,UAAaO,GAA2BG,EAAMH,EAAMO,EAAIe,IACvJkB,eAAiB,SAAS/C,EAAKU,EAAMH,EAAMO,EAAIe,GAAQ,OAAOhD,EAAauD,WAAWpC,EAAKA,EAAI,UAAac,IAASd,EAAI,KAAOc,GAAOJ,EAAMH,EAAMO,EAAIe,IAEvJmB,YAAa,SAAShD,EAAKU,EAAMH,EAAMO,EAAIe,GACzC,IAAK,IAAUhD,EAAa+D,gBAAgB5C,EAAKU,EAAMH,EAAMO,EAAIe,KAC5D,IAAUhD,EAAa0D,eAAgBvC,EAAKU,EAAMH,EAAMO,EAAIe,GAC/D,OAAO,GAGXoB,WAAY,SAASjD,EAAKU,EAAMH,EAAMO,EAAIe,GACxChD,EAAagE,eAAe7C,EAAKU,EAAMH,EAAMO,EAAIe,GACjDhD,EAAa2D,cAAexC,EAAKU,EAAMH,EAAMO,EAAIe,IAGnDqB,WAAY,SAASlD,EAAKU,EAAMH,EAAMO,EAAIe,GACxC,IAAIsB,EAAWtE,EAAaiE,eAAe9C,EAAKU,EAAMH,EAAMO,EAAIe,GAC5DuB,EAAWvE,EAAa4D,cAAezC,EAAKU,EAAMH,EAAMO,EAAIe,GAChE,OAAK,IAAUsB,IAAc,IAAUC,IAE7BvE,EAAaY,QAAU0D,GAActE,EAAaY,QAAU2D,EAC7DvE,EAAaY,WADjB,IAIP4D,WAAY,SAASrD,EAAKU,EAAMH,EAAMO,EAAIe,GACxChD,EAAakE,eAAe/C,EAAKU,EAAMH,EAAMO,EAAIe,GACjDhD,EAAa6D,cAAe1C,EAAKU,EAAMH,EAAMO,EAAIe,IAKnDZ,WAAY,SAASP,EAAMP,GACzB,OAAO,WAEL,IAAII,EAAQc,KAAKH,QACbJ,EAAQX,EAAII,KAAUJ,EAAItB,EAAaW,WAAaX,EAAaW,SAAWW,EAAItB,EAAaW,UAAYe,IAASA,EAClHsB,EAAQrB,MAAM8C,UAAUC,MAAMC,KAAKC,WAEvC,GAAIpC,KAAKE,WACP,OAAOF,KAAKO,MAAMlB,EAAMH,EAAMO,EAAIe,EAAMhD,EAAaO,MAAME,mBAAoB,SAAWoB,EAAO,+DAEnG,GAAIW,KAAKI,OAAOf,GACd,OAAOW,KAAKO,MAAMlB,EAAMH,EAAMO,EAAIe,EAAMhD,EAAaO,MAAMC,mBAAoB,SAAWqB,EAAO,mCAAqCW,KAAKH,SAE7I,IAAI,IAAUrC,EAAamE,YAAY3B,KAAMX,EAAMH,EAAMO,EAAIe,GAC3D,OAAOhD,EAAaE,OAAOG,UAE7B,GAAIqB,IAASO,EAEX,OADAjC,EAAaoE,WAAW5B,KAAMX,EAAMH,EAAMO,EAAIe,GACvChD,EAAaE,OAAOE,aAI7B,IAAIe,EAAMqB,KACVA,KAAKE,WAAa,WAMhB,OALAvB,EAAIuB,WAAa,KACjBvB,EAAIkB,QAAUJ,EACdjC,EAAawE,WAAYrD,EAAKU,EAAMH,EAAMO,EAAIe,GAC9ChD,EAAa8D,YAAY3C,EAAKU,EAAMH,EAAMO,EAAIe,GAC9ChD,EAAaoE,WAAYjD,EAAKU,EAAMH,EAAMO,EAAIe,GACvChD,EAAaE,OAAOC,WAE7BqC,KAAKE,WAAWmC,OAAS,WACvB1D,EAAIuB,WAAa,KACjB1C,EAAaoE,WAAWjD,EAAKU,EAAMH,EAAMO,EAAIe,IAG/C,IAAI8B,EAAQ9E,EAAaqE,WAAW7B,KAAMX,EAAMH,EAAMO,EAAIe,GAC1D,OAAI,IAAU8B,GACZtC,KAAKE,WAAa,KACX1C,EAAaE,OAAOG,WAEpBL,EAAaY,QAAUkE,EACvB9E,EAAaE,OAAOI,QAGvBkC,KAAKE,WACAF,KAAKE,kBADd,KAe+B9C,EAAOD,UAC1CA,EAAUC,EAAOD,QAAUK,GAE7BL,EAAQK,aAAeA,G,qTCrM3B,MAEM,IAAE+E,EAAG,IAAEC,GAAQC,KAiBrB,IAAIC,EAAK,EAOM,MAAMC,EA+BnB,YACUC,EACRC,GADQ,KAAAD,YA7BF,KAAAE,OAA4C,IAAIC,IAIhD,KAAAC,QAAU,EAEV,KAAAC,SAAW,EAEX,KAAAC,cAAqC,GAMrC,KAAAC,OAAS,EAET,KAAAC,GAAK,EAEL,KAAAC,GAAK,EAEL,KAAAC,GAAK,EAYXtD,KAAK0C,IAvCPA,GAAM,EACCA,GAwCL,MAAMa,EAAkBvD,KAAK4C,UAAUY,cACrC,cAEIC,EAAMtE,MAAMD,KAAKqE,EAAgBG,UAEvC,IAAK,IAAIC,EAAI,EAAGC,EAAIH,EAAIlE,OAAQoE,EAAIC,EAAGD,GAAK,EAAG,CAC7C,MAAME,EAAKJ,EAAIE,GACTG,EAAaD,EAAGE,QAAQC,WAE9B,GAAkB,MAAdF,EACF,MAAM,IAAI/F,MAAM,qCAGlB,MAAMkG,EACJJ,EAAGK,kBAAoB,EAAI/E,MAAMD,KAAK2E,EAAGH,UAAY,CAACG,GAElDM,EAzER,iBAAkBC,QAClBC,UAAUC,eAAiB,GAC3BD,UAAUE,iBAAmB,EAuEwB,UAAf,UAEpCvE,KAAK8C,OAAO0B,IAAIV,EAAY,CAC1BW,SAAU,IAAI,UAASR,GACvBvE,MAAO,IAAIyE,EAAQF,KAIvB,MAAOS,GAAOvF,MAAMD,KAAKc,KAAK8C,OAAOlC,QAC/BkC,EAAS9C,KAAK8C,OAAO6B,IAAID,GAC/B1E,KAAK4E,kBAAoBF,EACzB1E,KAAKyE,SAAW3B,EAAO2B,SACvBzE,KAAKN,MAAQoD,EAAOpD,MACpBM,KAAKN,MAAMmF,aAAa7E,KAAK4C,WAE7B5C,KAAK8E,MAAQ,WAAoB,iBAEjB,MAAZjC,GACF7C,KAAK+E,gBAAgBlC,GAGvB7C,KAAKgF,OAAS,KACZ,GAAIhF,KAAKkD,cAAc3D,OAAS,EAAG,CACjC,MAAM0F,EAASjF,KAAKyE,SAASS,YAE7B,IAAK,IAAIvB,EAAI,EAAGC,EAAI5D,KAAKkD,cAAc3D,OAAQoE,EAAIC,EAAGD,GAAK,EACzD3D,KAAKkD,cAAcS,GAAGsB,GAI1BjF,KAAKiD,SAAWkC,sBAAsBnF,KAAKgF,SAG7ChF,KAAKoF,MAASC,IACZ,IAAIC,EAAW,EACXC,GAAe,EAEnB,GAAIvF,KAAKN,MAAM8F,aAAc,CAC3B,MAAMC,EAAQzF,KAAKN,MAAMgG,qBACzB,GAAID,EAAQzF,KAAKmD,OAAQ,CACvB,MAAMwC,EAAQ3F,KAAKN,MAAMkG,iBAClBC,EAAGC,EAAGC,GAAK5G,MAAMD,KAAKyG,GAE7B,GAAI3F,KAAKoD,GAAK,EAAG,CACf,MAAM4C,EAAKH,EAAI7F,KAAKoD,GACd6C,EAAKH,EAAI9F,KAAKqD,GACd6C,EAAKH,EAAI/F,KAAKsD,GAEhB0C,EA/HK,IAgIPV,EApHd,SAAqBU,EAAYC,EAAYC,GAC3C,OAAIF,EAAK,EACAxD,EAAID,EAAI0D,EAAKD,GAAKzD,EAAI2D,EAAKF,IAE7B,EAgHgBG,CAAYH,EAAIC,EAAIC,IAInClG,KAAKoD,GAAKyC,EACV7F,KAAKqD,GAAKyC,EACV9F,KAAKsD,GAAKyC,EAEV/F,KAAKmD,OAASsC,EAGhBF,EAAcvF,KAAKN,MAAM0G,uBAG3BpG,KAAKyE,SAAS4B,OAAOhB,EAAOC,EAAUC,GAEtCvF,KAAKgD,QAAUmC,sBAAsBnF,KAAKoF,QAIvC,QACL,OAAOpF,KAAK0C,GAIP,YACL1C,KAAKgD,QAAUmC,sBAAsBnF,KAAKoF,OAC1CpF,KAAKiD,SAAWkC,sBAAsBnF,KAAKgF,QAItC,WACLhF,KAAKyE,SAAS6B,UAEdC,qBAAqBvG,KAAKgD,SAC1BuD,qBAAqBvG,KAAKiD,UAIrB,YACLjD,KAAKoD,GAAK,EACVpD,KAAKqD,GAAK,EACVrD,KAAKsD,GAAK,EACVtD,KAAKmD,OAAS,EAEdnD,KAAKwG,kBAGA,uBACL,OAAOxG,KAAK4E,kBAGP,cAAcF,GACnB,MAAM5B,EAAS9C,KAAK8C,OAAO6B,IAAID,GAE/B,GAAc,MAAV5B,EACF,MAAM,IAAI/E,MAAM,8BAGlBiC,KAAK4E,kBAAoBF,EAEzB1E,KAAKwG,kBACLxG,KAAKyG,qBAELzG,KAAKyE,SAAW3B,EAAO2B,SACvBzE,KAAKN,MAAQoD,EAAOpD,MACpBM,KAAK0G,kBAGA,iBAAiB7D,GACtBlC,OAAOgG,OAAO3G,KAAK8E,MAAOjC,GAGrB,gBACLA,GAEA,GAAK1D,MAAMC,QAAQyD,GAGjB,IAAK,IAAIc,EAAI,EAAGC,EAAIf,EAAStD,OAAQoE,EAAIC,EAAGD,GAAK,EAC/C3D,KAAKkD,cAAc1D,KAAKqD,EAASc,GAAGiD,KAAK5G,YAH3CA,KAAKkD,cAAc1D,KAAKqD,EAAS+D,KAAK5G,OAQnC,oBACLA,KAAKkD,cAAc3D,OAAS,EAGtB,kBACDS,KAAKN,MAAM8F,cACdxF,KAAKN,MAAMmF,aAAa7E,KAAK4C,WAIzB,qBACF5C,KAAKN,MAAM8F,cACbxF,KAAKN,MAAMmH,gBAAgB7G,KAAK4C,WAI5B,kBACN5C,KAAKN,MAAMoH,mBACX9G,KAAKyE,SAASsC,iB,+DC3MlB,UAnCyB,CACvBC,QAAS,CACPxI,QAAS,UACTI,OAAQ,CACN,CAAES,KAAM,aAAcH,KAAM,UAAWO,GAAI,UAC3C,CAAEJ,KAAM,QAASH,KAAM,SAAUO,GAAI,WACrC,CAAEJ,KAAM,MAAOH,KAAM,UAAWO,GAAI,YAIxClB,OAAQ,CACNC,QAAS,UACTI,OAAQ,CACN,CAAES,KAAM,aAAcH,KAAM,UAAWO,GAAI,YAC3C,CAAEJ,KAAM,WAAYH,KAAM,WAAYO,GAAI,UAC1C,CAAEJ,KAAM,aAAcH,KAAM,SAAUO,GAAI,cAI9CqF,MAAO,CACLtG,QAAS,UACTI,OAAQ,CACN,CAAES,KAAM,aAAcH,KAAM,UAAWO,GAAI,eAC3C,CAAEJ,KAAM,QAASH,KAAM,cAAeO,GAAI,UAC1C,CAAEJ,KAAM,QAASH,KAAM,CAAC,SAAU,SAAUO,GAAI,eAChD,CAAEJ,KAAM,QAASH,KAAM,SAAUO,GAAI,WACrC,CAAEJ,KAAM,OAAQH,KAAM,UAAWO,GAAI,UACrC,CAAEJ,KAAM,QAASH,KAAM,UAAWO,GAAI,WACtC,CAAEJ,KAAM,SAAUH,KAAM,UAAWO,GAAI,WACvC,CAAEJ,KAAM,OAAQH,KAAM,UAAWO,GAAI,UACrC,CAAEJ,KAAM,QAASH,KAAM,IAAKO,GAAI,a,wGClCvB,MAAMwH,GACH,EAAAC,UAAY,YAEZ,EAAAC,QAAU,UAEV,EAAAC,UAAY,YAEZ,EAAAC,WAAa,aAEb,EAAAC,WAAa,aAEb,EAAAC,MAAQ,QAER,EAAAC,YAAc,WAEd,EAAAC,YAAc,cAEd,EAAAC,WAAa,aAEb,EAAAC,SAAW,WAEX,EAAAC,UAAY,YAEZ,EAAAC,YAAc,e,0LCnBhC,MAAM,gBAAEC,GAAoBC,SAEb,MAAMC,UAAqB,UACxC,YAAmBvE,GACjBwE,MAAMxE,GAENzD,KAAKkI,SAAW,CACdC,MAAOH,EAAaG,MAAMvB,KAAK5G,KAAMA,KAAKvB,OAC1C2J,IAAKJ,EAAaI,IAAIxB,KAAK5G,KAAMA,KAAKvB,OACtC4J,KAAML,EAAaK,KAAKzB,KAAK5G,KAAMA,KAAKvB,OACxC6J,SAAUN,EAAaM,SAAS1B,KAAK5G,MACrCuI,WAAYP,EAAaO,WAAW3B,KAAK5G,OAItC,aAAa6D,GAClB,GAAqB,MAAjB7D,KAAKkI,SAAT,CAIAlI,KAAKwI,UAAW,EAEhB3E,EAAG4E,iBAAiB,oBAAqBzI,KAAKkI,SAASC,OAAO,GAC9DtE,EAAG4E,iBAAiB,oBAAqBzI,KAAKkI,SAASG,MAAM,GAC7DxE,EAAG4E,iBAAiB,kBAAmBzI,KAAKkI,SAASE,KAAK,GAE1D,IAAK,IAAIzE,EAAI,EAAGC,EAAI5D,KAAK0I,QAAQnJ,OAAQoE,EAAIC,EAAGD,GAAK,EAAG,CACtD,MAAMpF,EAASyB,KAAK0I,QAAQ/E,GAE5BpF,EAAOsF,GAAG4E,iBACR,qBACAzI,KAAKkI,SAASI,UACd,GAEF/J,EAAOsF,GAAG4E,iBACR,qBACAzI,KAAKkI,SAASK,YACd,KAKC,gBAAgB1E,GACrB,GAAqB,MAAjB7D,KAAKkI,SAAT,CAIAlI,KAAKwI,UAAW,EAEhB3E,EAAG8E,oBAAoB,oBAAqB3I,KAAKkI,SAASC,OAAO,GACjEtE,EAAG8E,oBAAoB,oBAAqB3I,KAAKkI,SAASG,MAAM,GAChExE,EAAG8E,oBAAoB,kBAAmB3I,KAAKkI,SAASE,KAAK,GAE7D,IAAK,IAAIzE,EAAI,EAAGC,EAAI5D,KAAK0I,QAAQnJ,OAAQoE,EAAIC,EAAGD,GAAK,EAAG,CACtD,MAAMpF,EAASyB,KAAK0I,QAAQ/E,GAE5BpF,EAAOsF,GAAG8E,oBACR,qBACA3I,KAAKkI,SAASI,UACd,GAEF/J,EAAOsF,GAAG8E,oBACR,qBACA3I,KAAKkI,SAASK,YACd,KAKN,aAEE9J,EACAiB,GAEA,KAAMA,aAAiBkJ,YACrB,OAGF,GAAsB,WAAlBnK,EAAMoB,QACR,OAGFpB,EAAM0J,QAEN,MAAMtC,EAAIgD,YAAYC,MAEhBC,EAAgBjB,EAAgBkB,wBAChClD,EAAIpG,EAAMuJ,QAAUF,EAAKG,KACzBnD,EAAIrG,EAAMyJ,QAAUJ,EAAKK,IAE/BpJ,KAAKqJ,OAAOC,SAAS,CAACzD,EAAGC,EAAGC,IAG9B,YAEEtH,EACAiB,GAEA,KAAMA,aAAiBkJ,YACrB,OAGF,GAAsB,YAAlBnK,EAAMoB,QACR,OAGF,MAAMgG,EAAIgD,YAAYC,MAEhBC,EAAgBjB,EAAgBkB,wBAChClD,EAAIpG,EAAMuJ,QAAUF,EAAKG,KACzBnD,EAAIrG,EAAMyJ,QAAUJ,EAAKK,IAE/BpJ,KAAKqJ,OAAOC,SAAS,CAACzD,EAAGC,EAAGC,IAG9B,WAEEtH,EACAiB,GAEA,KAAMA,aAAiBkJ,YACrB,OAGF,GAAsB,YAAlBnK,EAAMoB,QACR,OAGF,MAAMgG,EAAIgD,YAAYC,MAEhBC,EAAgBjB,EAAgBkB,wBAChClD,EAAIpG,EAAMuJ,QAAUF,EAAKG,KACzBnD,EAAIrG,EAAMyJ,QAAUJ,EAAKK,IAE/BpJ,KAAKqJ,OAAOC,SAAS,CAACzD,EAAGC,EAAGC,IAE5BtH,EAAM2J,MAGR,gBAAoC1I,GAClC,MAAM6J,EAAQvJ,KAAKwJ,iBAChB3D,GACCA,EAAEhC,KAAQnE,EAAMnB,SAEdA,EAASyB,KAAK0I,QAAQa,GAEd,MAAVhL,GAIyB,aAAzBA,EAAOE,MAAMoB,SAIjBtB,EAAOE,MAAM6J,WAGf,kBAAsC5I,GACpC,MAAM6J,EAAQvJ,KAAKwJ,iBAChB3D,GACCA,EAAEhC,KAAQnE,EAAMnB,SAEdA,EAASyB,KAAK0I,QAAQa,GAEd,MAAVhL,GAIyB,WAAzBA,EAAOE,MAAMoB,SAIjBtB,EAAOE,MAAM8J,gB,0OC1KjB,MAGMkB,EAAYlL,GAA0CA,EAAOkL,WAyEnE,UAvEA,MAWE,YAAmBhG,GAFT,KAAA+E,UAAW,EAGnBxI,KAAK0I,QAAUjF,EAAI3E,KAAK+E,IACtB,MAAMtF,EAAS,IAAI,UAAOsF,GAE1B,OADAtF,EAAOE,MAAMiL,aACNnL,KAGTyB,KAAKvB,MAAQ,EAAAjB,aAAA,OACX,mBAEFwC,KAAKvB,MAAMiL,aAEX1J,KAAKqJ,OAAS,IAAI,UA3BH,IADA,GA6BfrJ,KAAKkI,SAAW,GAGR,gBACRyB,GAEA,IAAIC,GAAU,EAEd,IAAK,IAAIjG,EAAI,EAAGC,EAAI5D,KAAK0I,QAAQnJ,OAAQoE,EAAIC,EAAGD,GAAK,EAAG,CAGtD,GAAIgG,EAFM3J,KAAK0I,QAAQ/E,IAEL,CAChBiG,EAASjG,EACT,OAIJ,OAAOiG,EAGF,uBAGL,OAFoB5J,KAAKwJ,gBAAgBC,GAKpC,qBACL,OAAOzJ,KAAKqJ,OAAO5D,MAGd,gBACL,OAAOzF,KAAKqJ,OAAOQ,WAGd,mBACL,OAAO7J,KAAKqJ,OAAOS,cAGd,aACL,OAAO9J,KAAKwI,Y,0ICvEhB,MAEMuB,EAAY,IADN,IAGN,MAAEC,GAAUvH,KAEH,MAAMwH,EAmBnB,YAAmBxG,GAdX,KAAAwB,OAAS,EAET,KAAAiF,SAAU,EAEV,KAAAC,YAAc,EAEd,KAAAC,SAAW,EASjB,MAAMC,EAAY5G,EAAIlE,OAEtBS,KAAKsK,UAAYD,EAAY,EAE7BrK,KAAKuK,OAAS,IAAIxH,IAAI,CACpB,CAAC,OAAQ/C,KAAKwK,gBACd,CAAC,WAAYxK,KAAKwK,gBAClB,CAAC,WAAYxK,KAAKwK,kBAGpBxK,KAAKyK,cAAgB,CACnBC,KAAM,EACNC,SAAU,EACVC,SAAU,GAGZ5K,KAAK6K,SAAW1L,MAAMkL,EAAY,GAAGS,KAAK,GAGrC,OAAOzF,EAAeC,EAAkBC,GAC7C,MAAMI,EAAQ3F,KAAK6K,SAAS3I,MAAM,GAC5B6I,EAAc/K,KAAKuK,OAAO5F,IAAI,QAEpC,GAAK3E,KAAKkK,QAMH,CACLlK,KAAKmK,aAAe9E,EAAQrF,KAAKoK,SACjCpK,KAAKoK,SAAW/E,EAEhB,MAAM2F,EAAgBhB,EAAMhK,KAAKmK,YAAcJ,GAE3CiB,EAAgBhL,KAAKiF,SACvBjF,KAAKiF,OAAS+F,EACdrF,EAAM,GAAK3F,KAAKiF,OAEZM,GAAe,IACjBI,EAAMJ,EAAc,GAAKD,GAG3ByF,EAAYE,SAAStF,EAAO3F,KAAKiF,cAnBnCjF,KAAKkK,SAAU,EACflK,KAAKoK,SAAW/E,EAEhBM,EAAM,GAAK3F,KAAKiF,OAChB8F,EAAYE,SAAStF,EAAO3F,KAAKiF,QAoB7B,eACN,MAAMiG,EAAU,IAAI,UA3EL,MA2EyBlL,KAAKsK,WAE7C,OADAY,EAAQC,cACDD,EAGF,iBACL,OAAOlL,KAAKmK,YAGP,YACL,OAAOnK,KAAKiF,OAGP,UAAUA,GACf,MAAMU,EAAQ3F,KAAK6K,SAAS3I,MAAM,GAClCyD,EAAM,GAAKV,EACVjF,KAAKuK,OAAO5F,IAAI,QAAoBsG,SAAStF,EAAOV,GAErD,MACMmG,GADOnG,EAASjF,KAAKiF,QACN8E,EACrB/J,KAAKmK,aAAeiB,EACpBpL,KAAKiF,OAASA,EAGT,UACLjF,KAAKkK,SAAU,EAGV,cACLlK,KAAKiF,OAAS,EACdjF,KAAKkK,SAAU,EACflK,KAAKoK,SAAW,EAChBpK,KAAKmK,YAAc,EAGd,YAAYkB,EAAwB,QACxCrL,KAAKuK,OAAO5F,IAAI0G,GAAkBF,cAG9B,eAAeE,EAAwB,QAC5C,OAAQrL,KAAKuK,OAAO5F,IAAI0G,GAAkB5F,MAGrC,cAActC,GAAS,EAAIkI,EAAwB,QACxD,MAAMC,EAAUnI,EAASnD,KAAKyK,cAAcY,GACtC1F,EAAS3F,KAAKuK,OAAO5F,IAAI0G,GAAkBxB,SAASyB,GAE1D,OADmBnM,MAAMD,KAAKyG,EAAM4F,SAAS,IAIxC,UAAUF,EAAwB,QACvC,MAAMH,EAAUlL,KAAKuK,OAAO5F,IAAI0G,GAChC,OAAOH,EAAQrB,SAAS,EAAGqB,EAAQM,MAG9B,UAAUC,EAAsBJ,EAAwB,QAC5DrL,KAAKuK,OAAO5F,IAAI0G,GAAkBJ,SAASQ,GAGvC,QAAQC,GACZ1L,KAAKuK,OAAO5F,IAAI,QAAoB2E,SAASoC,GAGzC,QACLvI,GAAS,EACTsC,EAAQ,EACR4F,EAAwB,QAExB,MAAMC,EAAUnI,EAASnD,KAAKyK,cAAcY,GAC5C,OAAQrL,KAAKuK,OAAO5F,IAAI0G,GAAkBxB,SAASyB,EAAS7F,GAGvD,QACLE,EACAxC,EAAS,EACTkI,EAAwB,QAEvBrL,KAAKuK,OAAO5F,IAAI0G,GAAkBJ,SAAStF,EAAOxC,GAG9C,iBACL8B,EACAoG,EAAwB,QAExBrL,KAAKyK,cAAcY,GAAQpG,K,wMC9JhB,MAAM0G,EAGnB,YAA0B9H,GAAA,KAAAA,KACxB7D,KAAKvB,MAAQ,EAAAjB,aAAA,OAAoB,kBAG5B,WACL,MAA8B,WAAvBwC,KAAKvB,MAAMoB,W,0LCRtB,MAAM,gBAAEiI,GAAoBC,SAEb,MAAM6D,UAAqB,UACxC,YAAmBnI,GACjBwE,MAAMxE,GAENzD,KAAKkI,SAAW,CACdC,MAAOyD,EAAazD,MAAMvB,KAAK5G,KAAMA,KAAKvB,OAC1C4J,KAAMuD,EAAavD,KAAKzB,KAAK5G,KAAMA,KAAKvB,OACxC2J,IAAKwD,EAAaxD,IAAIxB,KAAK5G,KAAMA,KAAKvB,QAInC,aAAaoF,GACG,MAAjB7D,KAAKkI,WAILlI,KAAKwI,WAGTxI,KAAKwI,UAAW,EAEhB3E,EAAG4E,iBAAiB,qBAAsBzI,KAAKkI,SAASC,OAAO,GAC/DtE,EAAG4E,iBAAiB,oBAAqBzI,KAAKkI,SAASG,MAAM,GAC7DxE,EAAG4E,iBAAiB,mBAAoBzI,KAAKkI,SAASE,KAAK,GAC3DvE,EAAG4E,iBAAiB,sBAAuBzI,KAAKkI,SAASE,KAAK,KAGzD,gBAAgBvE,GACA,MAAjB7D,KAAKkI,UAIJlI,KAAKwI,WAGVxI,KAAKwI,UAAW,EAEhB3E,EAAG8E,oBAAoB,qBAAsB3I,KAAKkI,SAASC,OAAO,GAClEtE,EAAG8E,oBAAoB,oBAAqB3I,KAAKkI,SAASG,MAAM,GAChExE,EAAG8E,oBAAoB,mBAAoB3I,KAAKkI,SAASE,KAAK,GAC9DvE,EAAG8E,oBAAoB,sBAAuB3I,KAAKkI,SAASE,KAAK,IAGnE,aAEE3J,EACAiB,GAEA,KAAMA,aAAiBmM,YACrB,OAGF,GAAsB,WAAlBpN,EAAMoB,QACR,OAGFpB,EAAM0J,QAEN,MAAMtC,EAAIgD,YAAYC,MAEhBC,EAAgBjB,EAAgBkB,wBAChC8C,EAAe3M,MAAMD,KAAKQ,EAAMqM,gBAAgB,GAChDjG,EAAIgG,EAAM7C,QAAUF,EAAKG,KACzBnD,EAAI+F,EAAM3C,QAAUJ,EAAKK,IAE/BpJ,KAAKqJ,OAAOC,SAAS,CAACzD,EAAGC,EAAGC,IAG9B,YAEEtH,EACAiB,GAEA,KAAMA,aAAiBmM,YACrB,OAGF,GAAsB,YAAlBpN,EAAMoB,QACR,OAGF,MAAMgG,EAAIgD,YAAYC,MAEhBC,EAAgBjB,EAAgBkB,wBAChC8C,EAAe3M,MAAMD,KAAKQ,EAAMqM,gBAAgB,GAChDC,EAAKF,EAAM7C,QACXgD,EAAKH,EAAM3C,QACXrD,EAAIkG,EAAKjD,EAAKG,KACdnD,EAAIkG,EAAKlD,EAAKK,IAEpB,IAAK,IAAIzF,EAAI,EAAGC,EAAI5D,KAAK0I,QAAQnJ,OAAQoE,EAAIC,EAAGD,GAAK,EAAG,CACtD,MAAMpF,EAASyB,KAAK0I,QAAQ/E,GACtBuI,EAAiB3N,EAAOsF,GAAGmF,wBAG/BgD,GAAME,EAAMhD,MACZ8C,GAAME,EAAMhD,KAAOgD,EAAMC,OACzBF,GAAMC,EAAM9C,KACZ6C,GAAMC,EAAM9C,IAAM8C,EAAME,OAGK,WAAzB7N,EAAOE,MAAMoB,SACftB,EAAOE,MAAM6J,WAEmB,aAAzB/J,EAAOE,MAAMoB,SACtBtB,EAAOE,MAAM8J,aAIjBvI,KAAKqJ,OAAOC,SAAS,CAACzD,EAAGC,EAAGC,IAG9B,WAEEtH,EACAiB,GAEA,KAAMA,aAAiBmM,YACrB,OAGF,GAAsB,YAAlBpN,EAAMoB,QACR,OAGF,MAAMgG,EAAIgD,YAAYC,MAEhBC,EAAgBjB,EAAgBkB,wBAChC8C,EAAe3M,MAAMD,KAAKQ,EAAMqM,gBAAgB,GAChDjG,EAAIgG,EAAM7C,QAAUF,EAAKG,KACzBnD,EAAI+F,EAAM3C,QAAUJ,EAAKK,IAE/BpJ,KAAKqJ,OAAOC,SAAS,CAACzD,EAAGC,EAAGC,IAE5BtH,EAAM2J,S,qGC1IV,MAAM,MAAEiE,GAAU5J,KASH,MAAM6J,EAOnB,YAAmB/M,EAAgB+K,GAFzB,KAAAlC,IAAM,EAGdpI,KAAKsK,UAAYA,EAEjB,IACEtK,KAAKyL,OAAS,IAAIc,aAAahN,EAASS,KAAKsK,WAC7C,MAAOrL,GACP,MAAM,IAAIlB,MAAM,0BAGlB,IAtBE,IAAIyO,WAAW,IAAIC,YAAY,CAAC,MAASC,QAAQ,GAuBjD,MAAM,IAAI3O,MAAM,iCAIpB,YACE,OAAOsO,EAAMrM,KAAKoI,IAAMpI,KAAKsK,WAG/B,WACE,OAAO+B,EAAMrM,KAAKyL,OAAOlM,OAASS,KAAKsK,WAGlC,SAAS3E,EAAgCxC,EAAS,GACvD,GAAIwC,EAAMpG,OAASS,KAAKsK,WAAc,EACpC,MAAM,IAAIvM,MAAM,0BAGlB,MAAM4O,EAAWxJ,EAASnD,KAAKsK,UAC/BtK,KAAKyL,OAAOjH,IAAImB,EAAOgH,GAEnBA,EAAWhH,EAAMpG,QAAUS,KAAKoI,MAClCpI,KAAKoI,IAAMuE,EAAWhH,EAAMpG,QAKzB,SAASoG,GACd,GAAIA,EAAMpG,OAASS,KAAKsK,WAAc,EACpC,MAAM,IAAIvM,MAAM,0BAGlBiC,KAAKyL,OAAOjH,IAAImB,EAAO3F,KAAKoI,KAC5BpI,KAAKoI,KAAOzC,EAAMpG,OAIb,SAAS4D,GAAS,EAAIsC,EAAQ,GACnC,MAAMkH,EACJxJ,EAAS,GACJnD,KAAKyF,MAAQtC,GAAUnD,KAAKsK,UAC7BnH,EAASnD,KAAKsK,UAEdlC,EAAMuE,EAAWlH,EAAQzF,KAAKsK,UAGpC,OAFctK,KAAKyL,OAAOF,SAASoB,EAAUvE,GAKxC,cACLpI,KAAKoI,IAAM,EACXpI,KAAKyL,OAAOX,KAAK,GAGZ,cACL9K,KAAK8J,cAEL,IAAK,IAAInG,EAAI,EAAGC,EAAI5D,KAAKyL,OAAOlM,OAAQkG,EAAQ,EAAG9B,EAAIC,EAAGD,GAAK,EACzDA,EAAI3D,KAAKsK,WAAc,IACzBtK,KAAKyL,OAAOjH,IAAI,CAACiB,GAAQ9B,GACzB8B,GAAS,GAKR,cAAclG,EAAgB+K,GACnC,OAAO,IAAIgC,EAAQ/M,EAAQ+K,OC5F3BsC,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,GAAGF,EAAyBE,GAC3B,OAAOF,EAAyBE,GAAU3P,QAG3C,IAAIC,EAASwP,EAAyBE,GAAY,CAGjD3P,QAAS,IAOV,OAHA4P,EAAoBD,GAAU1P,EAAQA,EAAOD,QAAS0P,GAG/CzP,EAAOD,QCjBf,OCFA0P,EAAoBvN,EAAI,SAASlC,GAChC,IAAI4P,EAAS5P,GAAUA,EAAO6P,WAC7B,WAAa,OAAO7P,EAAgB,SACpC,WAAa,OAAOA,GAErB,OADAyP,EAAoBK,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRH,EAAoBK,EAAI,SAAS/P,EAASiQ,GACzC,IAAI,IAAI1I,KAAO0I,EACXP,EAAoBQ,EAAED,EAAY1I,KAASmI,EAAoBQ,EAAElQ,EAASuH,IAC5E/D,OAAO2M,eAAenQ,EAASuH,EAAK,CAAE6I,YAAY,EAAM5I,IAAKyI,EAAW1I,MCJ3EmI,EAAoBQ,EAAI,SAASG,EAAKC,GAAQ,OAAO9M,OAAOsB,UAAUtC,eAAewC,KAAKqL,EAAKC,ICC/FZ,EAAoBa,EAAI,SAASvQ,GACX,oBAAXwQ,QAA0BA,OAAOC,aAC1CjN,OAAO2M,eAAenQ,EAASwQ,OAAOC,YAAa,CAAEC,MAAO,WAE7DlN,OAAO2M,eAAenQ,EAAS,aAAc,CAAE0Q,OAAO,KJFhDhB,EAAoB,kB","file":"rub.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Rub\"] = factory();\n\telse\n\t\troot[\"Rub\"] = factory();\n})(self, function() {\nreturn ","/*\n\n  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine\n\n  Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors\n  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE\n\n*/\n\n(function () {\n\n  var StateMachine = {\n\n    //---------------------------------------------------------------------------\n\n    VERSION: \"2.4.0\",\n\n    //---------------------------------------------------------------------------\n\n    Result: {\n      SUCCEEDED:    1, // the event transitioned successfully from one state to another\n      NOTRANSITION: 2, // the event was successfull but no state transition was necessary\n      CANCELLED:    3, // the event was cancelled by the caller in a beforeEvent callback\n      PENDING:      4  // the event is asynchronous and the caller is in control of when the transition occurs\n    },\n\n    Error: {\n      INVALID_TRANSITION: 100, // caller tried to fire an event that was innapropriate in the current state\n      PENDING_TRANSITION: 200, // caller tried to fire an event while an async transition was still pending\n      INVALID_CALLBACK:   300 // caller provided callback function threw an exception\n    },\n\n    WILDCARD: '*',\n    ASYNC: 'async',\n\n    //---------------------------------------------------------------------------\n\n    create: function(cfg, target) {\n\n      var initial      = (typeof cfg.initial == 'string') ? { state: cfg.initial } : cfg.initial; // allow for a simple string, or an object with { state: 'foo', event: 'setup', defer: true|false }\n      var terminal     = cfg.terminal || cfg['final'];\n      var fsm          = target || cfg.target  || {};\n      var events       = cfg.events || [];\n      var callbacks    = cfg.callbacks || {};\n      var map          = {}; // track state transitions allowed for an event { event: { from: [ to ] } }\n      var transitions  = {}; // track events allowed from a state            { state: [ event ] }\n\n      var add = function(e) {\n        var from = Array.isArray(e.from) ? e.from : (e.from ? [e.from] : [StateMachine.WILDCARD]); // allow 'wildcard' transition if 'from' is not specified\n        map[e.name] = map[e.name] || {};\n        for (var n = 0 ; n < from.length ; n++) {\n          transitions[from[n]] = transitions[from[n]] || [];\n          transitions[from[n]].push(e.name);\n\n          map[e.name][from[n]] = e.to || from[n]; // allow no-op transition if 'to' is not specified\n        }\n        if (e.to)\n          transitions[e.to] = transitions[e.to] || [];\n      };\n\n      if (initial) {\n        initial.event = initial.event || 'startup';\n        add({ name: initial.event, from: 'none', to: initial.state });\n      }\n\n      for(var n = 0 ; n < events.length ; n++)\n        add(events[n]);\n\n      for(var name in map) {\n        if (map.hasOwnProperty(name))\n          fsm[name] = StateMachine.buildEvent(name, map[name]);\n      }\n\n      for(var name in callbacks) {\n        if (callbacks.hasOwnProperty(name))\n          fsm[name] = callbacks[name]\n      }\n\n      fsm.current     = 'none';\n      fsm.is          = function(state) { return Array.isArray(state) ? (state.indexOf(this.current) >= 0) : (this.current === state); };\n      fsm.can         = function(event) { return !this.transition && (map[event] !== undefined) && (map[event].hasOwnProperty(this.current) || map[event].hasOwnProperty(StateMachine.WILDCARD)); }\n      fsm.cannot      = function(event) { return !this.can(event); };\n      fsm.transitions = function()      { return (transitions[this.current] || []).concat(transitions[StateMachine.WILDCARD] || []); };\n      fsm.isFinished  = function()      { return this.is(terminal); };\n      fsm.error       = cfg.error || function(name, from, to, args, error, msg, e) { throw e || msg; }; // default behavior when something unexpected happens is to throw an exception, but caller can override this behavior if desired (see github issue #3 and #17)\n      fsm.states      = function() { return Object.keys(transitions).sort() };\n\n      if (initial && !initial.defer)\n        fsm[initial.event]();\n\n      return fsm;\n\n    },\n\n    //===========================================================================\n\n    doCallback: function(fsm, func, name, from, to, args) {\n      if (func) {\n        try {\n          return func.apply(fsm, [name, from, to].concat(args));\n        }\n        catch(e) {\n          return fsm.error(name, from, to, args, StateMachine.Error.INVALID_CALLBACK, \"an exception occurred in a caller-provided callback function\", e);\n        }\n      }\n    },\n\n    beforeAnyEvent:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onbeforeevent'],                       name, from, to, args); },\n    afterAnyEvent:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onafterevent'] || fsm['onevent'],      name, from, to, args); },\n    leaveAnyState:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onleavestate'],                        name, from, to, args); },\n    enterAnyState:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onenterstate'] || fsm['onstate'],      name, from, to, args); },\n    changeState:     function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onchangestate'],                       name, from, to, args); },\n\n    beforeThisEvent: function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onbefore' + name],                     name, from, to, args); },\n    afterThisEvent:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onafter'  + name] || fsm['on' + name], name, from, to, args); },\n    leaveThisState:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onleave'  + from],                     name, from, to, args); },\n    enterThisState:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onenter'  + to]   || fsm['on' + to],   name, from, to, args); },\n\n    beforeEvent: function(fsm, name, from, to, args) {\n      if ((false === StateMachine.beforeThisEvent(fsm, name, from, to, args)) ||\n          (false === StateMachine.beforeAnyEvent( fsm, name, from, to, args)))\n        return false;\n    },\n\n    afterEvent: function(fsm, name, from, to, args) {\n      StateMachine.afterThisEvent(fsm, name, from, to, args);\n      StateMachine.afterAnyEvent( fsm, name, from, to, args);\n    },\n\n    leaveState: function(fsm, name, from, to, args) {\n      var specific = StateMachine.leaveThisState(fsm, name, from, to, args),\n          general  = StateMachine.leaveAnyState( fsm, name, from, to, args);\n      if ((false === specific) || (false === general))\n        return false;\n      else if ((StateMachine.ASYNC === specific) || (StateMachine.ASYNC === general))\n        return StateMachine.ASYNC;\n    },\n\n    enterState: function(fsm, name, from, to, args) {\n      StateMachine.enterThisState(fsm, name, from, to, args);\n      StateMachine.enterAnyState( fsm, name, from, to, args);\n    },\n\n    //===========================================================================\n\n    buildEvent: function(name, map) {\n      return function() {\n\n        var from  = this.current;\n        var to    = map[from] || (map[StateMachine.WILDCARD] != StateMachine.WILDCARD ? map[StateMachine.WILDCARD] : from) || from;\n        var args  = Array.prototype.slice.call(arguments); // turn arguments into pure array\n\n        if (this.transition)\n          return this.error(name, from, to, args, StateMachine.Error.PENDING_TRANSITION, \"event \" + name + \" inappropriate because previous transition did not complete\");\n\n        if (this.cannot(name))\n          return this.error(name, from, to, args, StateMachine.Error.INVALID_TRANSITION, \"event \" + name + \" inappropriate in current state \" + this.current);\n\n        if (false === StateMachine.beforeEvent(this, name, from, to, args))\n          return StateMachine.Result.CANCELLED;\n\n        if (from === to) {\n          StateMachine.afterEvent(this, name, from, to, args);\n          return StateMachine.Result.NOTRANSITION;\n        }\n\n        // prepare a transition method for use EITHER lower down, or by caller if they want an async transition (indicated by an ASYNC return value from leaveState)\n        var fsm = this;\n        this.transition = function() {\n          fsm.transition = null; // this method should only ever be called once\n          fsm.current = to;\n          StateMachine.enterState( fsm, name, from, to, args);\n          StateMachine.changeState(fsm, name, from, to, args);\n          StateMachine.afterEvent( fsm, name, from, to, args);\n          return StateMachine.Result.SUCCEEDED;\n        };\n        this.transition.cancel = function() { // provide a way for caller to cancel async transition if desired (issue #22)\n          fsm.transition = null;\n          StateMachine.afterEvent(fsm, name, from, to, args);\n        }\n\n        var leave = StateMachine.leaveState(this, name, from, to, args);\n        if (false === leave) {\n          this.transition = null;\n          return StateMachine.Result.CANCELLED;\n        }\n        else if (StateMachine.ASYNC === leave) {\n          return StateMachine.Result.PENDING;\n        }\n        else {\n          if (this.transition) // need to check in case user manually called transition() but forgot to return StateMachine.ASYNC\n            return this.transition();\n        }\n\n      };\n    }\n\n  }; // StateMachine\n\n  //===========================================================================\n\n  //======\n  // NODE\n  //======\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = StateMachine;\n    }\n    exports.StateMachine = StateMachine;\n  }\n  //============\n  // AMD/REQUIRE\n  //============\n  else if (typeof define === 'function' && define.amd) {\n    define(function(require) { return StateMachine; });\n  }\n  //========\n  // BROWSER\n  //========\n  else if (typeof window !== 'undefined') {\n    window.StateMachine = StateMachine;\n  }\n  //===========\n  // WEB WORKER\n  //===========\n  else if (typeof self !== 'undefined') {\n    self.StateMachine = StateMachine;\n  }\n\n}());\n","import StateMachine from 'javascript-state-machine';\nimport MouseHandler from './modules/mouse-handler';\nimport TouchHandler from './modules/touch-handler';\nimport Recorder from './modules/recorder';\nimport dataset from './modules/dataset';\nimport * as IRub from './modules/interface';\n\ninterface Loop {\n  (ctime: number): void;\n}\n\nconst MIN_INTERVAL = 4;\nconst BOUNDS_ID = 'rb-bounds';\nconst { abs, max } = Math;\n\nfunction isTouchEnabled(): boolean {\n  return (\n    'ontouchstart' in window ||\n    navigator.maxTouchPoints > 0 ||\n    navigator.msMaxTouchPoints > 0\n  );\n}\n\nfunction getVelocity(dt: number, dx: number, dy: number): number {\n  if (dt > 0) {\n    return max(abs(dx / dt), abs(dy / dt));\n  }\n  return 0;\n}\n\nlet id = 0;\n\nfunction genId(): number {\n  id += 1;\n  return id;\n}\n\nexport default class Rub implements IRub.MainInterface {\n  private id: number;\n\n  private bounds: Map<IRub.BoundsType, IRub.Bounds> = new Map();\n\n  private currentBoundsType: IRub.BoundsType;\n\n  private inputId = 0;\n\n  private outputId = 0;\n\n  private loopCallbacks: IRub.LoopCallback[] = [];\n\n  private input: Loop;\n\n  private output: Loop;\n\n  private offset = 0;\n\n  private t0 = 0;\n\n  private x0 = 0;\n\n  private y0 = 0;\n\n  public event: IRub.PointerHandlerInterface;\n\n  public recorder: IRub.RecorderInterface;\n\n  public media: IRub.MediaStateMachine;\n\n  public constructor(\n    private container: HTMLDivElement,\n    callback?: IRub.LoopCallback | IRub.LoopCallback[]\n  ) {\n    this.id = genId();\n\n    const boundsContainer = this.container.querySelector(\n      `.${BOUNDS_ID}`\n    ) as HTMLDivElement;\n    const els = Array.from(boundsContainer.children) as HTMLDivElement[];\n\n    for (let i = 0, l = els.length; i < l; i += 1) {\n      const el = els[i];\n      const identifier = el.dataset.boundsType as IRub.BoundsType;\n\n      if (identifier == null) {\n        throw new Error('cannot find identified class name');\n      }\n\n      const targetEls =\n        el.childElementCount > 0 ? Array.from(el.children) : [el];\n\n      const Handler = !isTouchEnabled() ? MouseHandler : TouchHandler;\n\n      this.bounds.set(identifier, {\n        recorder: new Recorder(targetEls as HTMLDivElement[]),\n        event: new Handler(targetEls as HTMLDivElement[]),\n      });\n    }\n\n    const [key] = Array.from(this.bounds.keys());\n    const bounds = this.bounds.get(key) as IRub.Bounds;\n    this.currentBoundsType = key;\n    this.recorder = bounds.recorder;\n    this.event = bounds.event;\n    this.event.addListeners(this.container);\n\n    this.media = StateMachine.create(dataset.media) as IRub.MediaStateMachine;\n\n    if (callback != null) {\n      this.addLoopCallback(callback);\n    }\n\n    this.output = (): void => {\n      if (this.loopCallbacks.length > 0) {\n        const frames = this.recorder.getFrames();\n\n        for (let i = 0, l = this.loopCallbacks.length; i < l; i += 1) {\n          this.loopCallbacks[i](frames);\n        }\n      }\n\n      this.outputId = requestAnimationFrame(this.output);\n    };\n\n    this.input = (ctime: number): void => {\n      let velocity = 0;\n      let targetIndex = -1;\n\n      if (this.event.isAttached()) {\n        const count = this.event.getEventTrackCount();\n        if (count > this.offset) {\n          const track = this.event.getEventTrack();\n          const [t, x, y] = Array.from(track);\n\n          if (this.t0 > 0) {\n            const dt = t - this.t0;\n            const dx = x - this.x0;\n            const dy = y - this.y0;\n\n            if (dt > MIN_INTERVAL) {\n              velocity = getVelocity(dt, dx, dy);\n            }\n          }\n\n          this.t0 = t;\n          this.x0 = x;\n          this.y0 = y;\n\n          this.offset = count;\n        }\n\n        targetIndex = this.event.getActiveTargetIndex();\n      }\n\n      this.recorder.update(ctime, velocity, targetIndex);\n\n      this.inputId = requestAnimationFrame(this.input);\n    };\n  }\n\n  public getId(): number {\n    return this.id;\n  }\n\n  /* ポインターイベントの速度計測とその出力を開始または再開する。 */\n  public startLoop(): void {\n    this.inputId = requestAnimationFrame(this.input);\n    this.outputId = requestAnimationFrame(this.output);\n  }\n\n  /* レコーディングを一時停止する。経過時間は停止した時点のまま */\n  public stopLoop(): void {\n    this.recorder.suspend();\n\n    cancelAnimationFrame(this.inputId);\n    cancelAnimationFrame(this.outputId);\n  }\n\n  /* レコーディングの状態を初期に戻す */\n  public clearLoop(): void {\n    this.t0 = 0;\n    this.x0 = 0;\n    this.y0 = 0;\n    this.offset = 0;\n\n    this.resetBoundsType();\n  }\n\n  public getCurrentBoundsType(): IRub.BoundsType {\n    return this.currentBoundsType;\n  }\n\n  public setBoundsType(key: IRub.BoundsType): void {\n    const bounds = this.bounds.get(key);\n\n    if (bounds == null) {\n      throw new Error('this is assigned undefined');\n    }\n\n    this.currentBoundsType = key;\n\n    this.resetBoundsType();\n    this.removeEventHandler();\n\n    this.recorder = bounds.recorder;\n    this.event = bounds.event;\n    this.setEventHandler();\n  }\n\n  public setMediaCallback(callback: IRub.MediaStateCallback): void {\n    Object.assign(this.media, callback);\n  }\n\n  public addLoopCallback(\n    callback: IRub.LoopCallback | IRub.LoopCallback[]\n  ): void {\n    if (!Array.isArray(callback)) {\n      this.loopCallbacks.push(callback.bind(this));\n    } else {\n      for (let i = 0, l = callback.length; i < l; i += 1) {\n        this.loopCallbacks.push(callback[i].bind(this));\n      }\n    }\n  }\n\n  public clearLoopCallback(): void {\n    this.loopCallbacks.length = 0;\n  }\n\n  private setEventHandler(): void {\n    if (!this.event.isAttached()) {\n      this.event.addListeners(this.container);\n    }\n  }\n\n  private removeEventHandler(): void {\n    if (this.event.isAttached()) {\n      this.event.removeListeners(this.container);\n    }\n  }\n\n  private resetBoundsType(): void {\n    this.event.clearEventTracks();\n    this.recorder.resetFrames();\n  }\n}\n","interface Dataset {\n  [index: string]: StateMachine.StateMachineConfig;\n}\n\nconst dataset: Dataset = {\n  pointer: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'idling' },\n      { name: 'start', from: 'idling', to: 'running' },\n      { name: 'end', from: 'running', to: 'idling' },\n    ],\n  },\n\n  target: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'inactive' },\n      { name: 'activate', from: 'inactive', to: 'active' },\n      { name: 'inactivate', from: 'active', to: 'inactive' },\n    ],\n  },\n\n  media: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'initialized' },\n      { name: 'ready', from: 'initialized', to: 'idling' },\n      { name: 'reset', from: ['idling', 'error'], to: 'initialized' },\n      { name: 'start', from: 'idling', to: 'running' },\n      { name: 'stop', from: 'running', to: 'idling' },\n      { name: 'pause', from: 'running', to: 'pending' },\n      { name: 'resume', from: 'pending', to: 'running' },\n      { name: 'quit', from: 'pending', to: 'idling' },\n      { name: 'abort', from: '*', to: 'error' },\n    ],\n  },\n};\n\nexport default dataset;\n","export default class EventType {\n  static readonly MouseDown = 'mousedown';\n\n  static readonly MouseUp = 'mouseup';\n\n  static readonly MouseMove = 'mousemove';\n\n  static readonly MouseEnter = 'mouseenter';\n\n  static readonly MouseLeave = 'mouseleave';\n\n  static readonly Click = 'click';\n\n  static readonly DoubleClick = 'dblclick';\n\n  static readonly ContextMenu = 'contextmenu';\n\n  static readonly TouchStart = 'touchstart';\n\n  static readonly TouchEnd = 'touchend';\n\n  static readonly TouchMove = 'touchmove';\n\n  static readonly TouchCancel = 'touchcancel';\n}\n","import PointerHandler from './pointer-handler';\nimport EventType from './event-type';\nimport * as IRub from './interface';\n\nconst { documentElement } = document;\n\nexport default class MouseHandler extends PointerHandler {\n  public constructor(els: HTMLDivElement[]) {\n    super(els);\n\n    this.listener = {\n      start: MouseHandler.start.bind(this, this.state),\n      end: MouseHandler.end.bind(this, this.state),\n      move: MouseHandler.move.bind(this, this.state),\n      activate: MouseHandler.activate.bind(this),\n      inactivate: MouseHandler.inactivate.bind(this),\n    };\n  }\n\n  public addListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    this.attached = true;\n\n    el.addEventListener(EventType.MouseDown, this.listener.start, false);\n    el.addEventListener(EventType.MouseMove, this.listener.move, false);\n    el.addEventListener(EventType.MouseUp, this.listener.end, false);\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n\n      target.el.addEventListener(\n        EventType.MouseEnter,\n        this.listener.activate,\n        false\n      );\n      target.el.addEventListener(\n        EventType.MouseLeave,\n        this.listener.inactivate,\n        false\n      );\n    }\n  }\n\n  public removeListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    this.attached = false;\n\n    el.removeEventListener(EventType.MouseDown, this.listener.start, false);\n    el.removeEventListener(EventType.MouseMove, this.listener.move, false);\n    el.removeEventListener(EventType.MouseUp, this.listener.end, false);\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n\n      target.el.removeEventListener(\n        EventType.MouseEnter,\n        this.listener.activate,\n        false\n      );\n      target.el.removeEventListener(\n        EventType.MouseLeave,\n        this.listener.inactivate,\n        false\n      );\n    }\n  }\n\n  static start(\n    this: MouseHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    if (state.current !== 'idling') {\n      return;\n    }\n\n    state.start();\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static move(\n    this: MouseHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static end(\n    this: MouseHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n\n    state.end();\n  }\n\n  static activate(this: MouseHandler, event: MouseEvent | TouchEvent): void {\n    const index = this.findTargetIndex(\n      (t: IRub.TargetInterface): boolean =>\n        t.el === (event.target as HTMLDivElement)\n    );\n    const target = this.targets[index];\n\n    if (target == null) {\n      return;\n    }\n\n    if (target.state.current !== 'inactive') {\n      return;\n    }\n\n    target.state.activate();\n  }\n\n  static inactivate(this: MouseHandler, event: MouseEvent | TouchEvent): void {\n    const index = this.findTargetIndex(\n      (t: IRub.TargetInterface): boolean =>\n        t.el === (event.target as HTMLDivElement)\n    );\n    const target = this.targets[index];\n\n    if (target == null) {\n      return;\n    }\n\n    if (target.state.current !== 'active') {\n      return;\n    }\n\n    target.state.inactivate();\n  }\n}\n","import { StateMachine } from 'javascript-state-machine';\nimport Target from './target';\nimport Tracker from './tracker';\nimport dataset from './dataset';\nimport * as IRub from './interface';\n\nconst BLOCK_SIZE = 3; // [t, x, y]\nconst TRACK_SIZE = 900000; // (bytes)\n\nconst isActive = (target: IRub.TargetInterface): boolean => target.isActive();\n\nabstract class PointerHandler implements IRub.PointerHandlerInterface {\n  protected state: IRub.PointerStateMachine;\n\n  protected listener: IRub.ListenerInterface;\n\n  protected targets: IRub.TargetInterface[];\n\n  protected coords: IRub.TrackerInterface;\n\n  protected attached = false;\n\n  public constructor(els: HTMLDivElement[]) {\n    this.targets = els.map((el) => {\n      const target = new Target(el);\n      target.state.initialize();\n      return target;\n    });\n\n    this.state = StateMachine.create(\n      dataset.pointer\n    ) as IRub.PointerStateMachine;\n    this.state.initialize();\n\n    this.coords = new Tracker(TRACK_SIZE, BLOCK_SIZE);\n    this.listener = {};\n  }\n\n  protected findTargetIndex(\n    predicate: (target: IRub.TargetInterface) => boolean\n  ): number {\n    let result = -1;\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const t = this.targets[i];\n\n      if (predicate(t)) {\n        result = i;\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  public getActiveTargetIndex(): number {\n    const targetIndex = this.findTargetIndex(isActive);\n\n    return targetIndex;\n  }\n\n  public getEventTrackCount(): number {\n    return this.coords.count;\n  }\n\n  public getEventTrack(): Float32Array {\n    return this.coords.getTrack();\n  }\n\n  public clearEventTracks(): void {\n    return this.coords.clearTracks();\n  }\n\n  public isAttached(): boolean {\n    return this.attached;\n  }\n\n  public abstract addListeners(el: HTMLDivElement): void;\n\n  public abstract removeListeners(el: HTMLDivElement): void;\n}\n\nexport default PointerHandler;\n","import Tracker from './tracker';\nimport * as IRub from './interface';\n\nconst TRACK_SIZE = 216000;\nconst FPS = 60;\nconst PER_FRAME = 1000 / FPS;\n\nconst { round } = Math;\n\nexport default class Recorder implements IRub.RecorderInterface {\n  public record: IRub.Record;\n\n  private blockSize: number;\n\n  private frames = 0;\n\n  private started = false;\n\n  private elapsedTime = 0;\n\n  private lastTime = 0;\n\n  private template: number[];\n\n  private shiftedFrames: {\n    [P in IRub.RecordMode]: number;\n  };\n\n  public constructor(els: HTMLDivElement[]) {\n    const targetNum = els.length;\n\n    this.blockSize = targetNum + 1;\n\n    this.record = new Map([\n      ['live', this.createRecord()],\n      ['playback', this.createRecord()],\n      ['external', this.createRecord()],\n    ]);\n\n    this.shiftedFrames = {\n      live: 0,\n      playback: 0,\n      external: 0,\n    };\n\n    this.template = Array(targetNum + 1).fill(0);\n  }\n\n  public update(ctime: number, velocity: number, targetIndex: number): void {\n    const track = this.template.slice(0);\n    const liveTracker = this.record.get('live') as Tracker;\n\n    if (!this.started) {\n      this.started = true;\n      this.lastTime = ctime;\n\n      track[0] = this.frames;\n      liveTracker.setTrack(track, this.frames);\n    } else {\n      this.elapsedTime += ctime - this.lastTime;\n      this.lastTime = ctime;\n\n      const currentFrames = round(this.elapsedTime / PER_FRAME);\n\n      if (currentFrames > this.frames) {\n        this.frames = currentFrames;\n        track[0] = this.frames;\n\n        if (targetIndex > -1) {\n          track[targetIndex + 1] = velocity;\n        }\n\n        liveTracker.setTrack(track, this.frames);\n      }\n    }\n  }\n\n  private createRecord(): Tracker {\n    const tracker = new Tracker(TRACK_SIZE, this.blockSize);\n    tracker.writeFrames();\n    return tracker;\n  }\n\n  public getElapsedTime(): number {\n    return this.elapsedTime;\n  }\n\n  public getFrames(): number {\n    return this.frames;\n  }\n\n  public setFrames(frames: number): void {\n    const track = this.template.slice(0);\n    track[0] = frames;\n    (this.record.get('live') as Tracker).setTrack(track, frames);\n\n    const diff = frames - this.frames;\n    const shift = diff * PER_FRAME;\n    this.elapsedTime += shift;\n    this.frames = frames;\n  }\n\n  public suspend(): void {\n    this.started = false;\n  }\n\n  public resetFrames(): void {\n    this.frames = 0;\n    this.started = false;\n    this.lastTime = 0;\n    this.elapsedTime = 0;\n  }\n\n  public clearRecord(mode: IRub.RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).writeFrames();\n  }\n\n  public getRecordCount(mode: IRub.RecordMode = 'live'): number {\n    return (this.record.get(mode) as Tracker).count;\n  }\n\n  public getVelocities(offset = -1, mode: IRub.RecordMode = 'live'): number[] {\n    const shifted = offset + this.shiftedFrames[mode];\n    const track = (this.record.get(mode) as Tracker).getTrack(shifted);\n    const velocities = Array.from(track.subarray(1));\n    return velocities;\n  }\n\n  public getRecord(mode: IRub.RecordMode = 'live'): Float32Array {\n    const tracker = this.record.get(mode) as Tracker;\n    return tracker.getTrack(0, tracker.size);\n  }\n\n  public setRecord(tracks: Float32Array, mode: IRub.RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).setTrack(tracks);\n  }\n\n  public addData(data: number[]): void {\n    (this.record.get('live') as Tracker).addTrack(data);\n  }\n\n  public getData(\n    offset = -1,\n    count = 1,\n    mode: IRub.RecordMode = 'live'\n  ): Float32Array {\n    const shifted = offset + this.shiftedFrames[mode];\n    return (this.record.get(mode) as Tracker).getTrack(shifted, count);\n  }\n\n  public setData(\n    track: number[],\n    offset = 0,\n    mode: IRub.RecordMode = 'live'\n  ): void {\n    (this.record.get(mode) as Tracker).setTrack(track, offset);\n  }\n\n  public setShiftedFrames(\n    frames: number,\n    mode: IRub.RecordMode = 'live'\n  ): void {\n    this.shiftedFrames[mode] = frames;\n  }\n}\n","import { StateMachine } from 'javascript-state-machine';\nimport dataset from './dataset';\nimport * as IRub from './interface';\n\nexport default class Target implements IRub.TargetInterface {\n  public state: IRub.TargetStateMachine;\n\n  public constructor(public el: HTMLDivElement) {\n    this.state = StateMachine.create(dataset.target) as IRub.TargetStateMachine;\n  }\n\n  public isActive(): boolean {\n    return this.state.current === 'active';\n  }\n}\n","import PointerHandler from './pointer-handler';\nimport EventType from './event-type';\nimport * as IRub from './interface';\n\nconst { documentElement } = document;\n\nexport default class TouchHandler extends PointerHandler {\n  public constructor(els: HTMLDivElement[]) {\n    super(els);\n\n    this.listener = {\n      start: TouchHandler.start.bind(this, this.state),\n      move: TouchHandler.move.bind(this, this.state),\n      end: TouchHandler.end.bind(this, this.state),\n    };\n  }\n\n  public addListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    if (this.attached) {\n      return;\n    }\n    this.attached = true;\n\n    el.addEventListener(EventType.TouchStart, this.listener.start, false);\n    el.addEventListener(EventType.TouchMove, this.listener.move, false);\n    el.addEventListener(EventType.TouchEnd, this.listener.end, false);\n    el.addEventListener(EventType.TouchCancel, this.listener.end, false);\n  }\n\n  public removeListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    if (!this.attached) {\n      return;\n    }\n    this.attached = false;\n\n    el.removeEventListener(EventType.TouchStart, this.listener.start, false);\n    el.removeEventListener(EventType.TouchMove, this.listener.move, false);\n    el.removeEventListener(EventType.TouchEnd, this.listener.end, false);\n    el.removeEventListener(EventType.TouchCancel, this.listener.end, false);\n  }\n\n  static start(\n    this: TouchHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof TouchEvent)) {\n      return;\n    }\n\n    if (state.current !== 'idling') {\n      return;\n    }\n\n    state.start();\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const touch: Touch = Array.from(event.changedTouches)[0];\n    const x = touch.clientX - rect.left;\n    const y = touch.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static move(\n    this: TouchHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof TouchEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const touch: Touch = Array.from(event.changedTouches)[0];\n    const cx = touch.clientX;\n    const cy = touch.clientY;\n    const x = cx - rect.left;\n    const y = cy - rect.top;\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n      const trect: DOMRect = target.el.getBoundingClientRect();\n\n      const isActive =\n        cx >= trect.left &&\n        cx <= trect.left + trect.width &&\n        cy >= trect.top &&\n        cy <= trect.top + trect.height;\n\n      if (isActive) {\n        if (target.state.current !== 'active') {\n          target.state.activate();\n        }\n      } else if (target.state.current !== 'inactive') {\n        target.state.inactivate();\n      }\n    }\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static end(\n    this: TouchHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof TouchEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const touch: Touch = Array.from(event.changedTouches)[0];\n    const x = touch.clientX - rect.left;\n    const y = touch.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n\n    state.end();\n  }\n}\n","import * as IRub from './interface';\n\nconst { floor } = Math;\n\nfunction SystemGetExecutedInLittleEndian(): boolean {\n  if (new Uint8Array(new Uint16Array([0x00ff]).buffer)[0]) {\n    return true;\n  }\n  return false;\n}\n\nexport default class Tracker implements IRub.TrackerInterface {\n  public readonly blockSize: number;\n\n  protected tracks: Float32Array;\n\n  protected end = 0;\n\n  public constructor(length: number, blockSize: number) {\n    this.blockSize = blockSize;\n\n    try {\n      this.tracks = new Float32Array(length * this.blockSize);\n    } catch (e) {\n      throw new Error('cannot allocate memory');\n    }\n\n    if (!SystemGetExecutedInLittleEndian()) {\n      throw new Error('required little endian system');\n    }\n  }\n\n  get count(): number {\n    return floor(this.end / this.blockSize);\n  }\n\n  get size(): number {\n    return floor(this.tracks.length / this.blockSize);\n  }\n\n  public setTrack(track: number[] | Float32Array, offset = 0): void {\n    if (track.length % this.blockSize !== 0) {\n      throw new Error('Track size not matched');\n    }\n\n    const position = offset * this.blockSize;\n    this.tracks.set(track, position);\n\n    if (position + track.length >= this.end) {\n      this.end = position + track.length;\n    }\n  }\n\n  /* addTrack(), getLastTrack()はRecorderクラスでの使用を想定 */\n  public addTrack(track: number[]): void {\n    if (track.length % this.blockSize !== 0) {\n      throw new Error('Track size not matched');\n    }\n\n    this.tracks.set(track, this.end);\n    this.end += track.length;\n  }\n\n  /* 任意の場所からトラックデータを取得する。引数に何も指定しない場合、最後のブロックを取得する */\n  public getTrack(offset = -1, count = 1): Float32Array {\n    const position =\n      offset < 0\n        ? (this.count + offset) * this.blockSize\n        : offset * this.blockSize;\n\n    const end = position + count * this.blockSize;\n    const track = this.tracks.subarray(position, end);\n\n    return track;\n  }\n\n  public clearTracks(): void {\n    this.end = 0;\n    this.tracks.fill(0);\n  }\n\n  public writeFrames(): void {\n    this.clearTracks();\n\n    for (let i = 0, l = this.tracks.length, count = 0; i < l; i += 1) {\n      if (i % this.blockSize === 0) {\n        this.tracks.set([count], i);\n        count += 1;\n      }\n    }\n  }\n\n  public static create(length: number, blockSize: number): Tracker {\n    return new Tracker(length, blockSize);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(\"./src/index.ts\");\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}