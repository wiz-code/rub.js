{"version":3,"sources":["webpack://Rub/webpack/universalModuleDefinition","webpack://Rub/./node_modules/javascript-state-machine/lib/state-machine.js","webpack://Rub/./src/dataset.ts","webpack://Rub/./src/event-type.ts","webpack://Rub/./src/index.ts","webpack://Rub/./src/mouse-handler.ts","webpack://Rub/./src/pointer-handler.ts","webpack://Rub/./src/recorder.ts","webpack://Rub/./src/target.ts","webpack://Rub/./src/touch-handler.ts","webpack://Rub/./src/tracker.ts","webpack://Rub/webpack/bootstrap","webpack://Rub/webpack/startup","webpack://Rub/webpack/runtime/compat get default export","webpack://Rub/webpack/runtime/define property getters","webpack://Rub/webpack/runtime/hasOwnProperty shorthand","webpack://Rub/webpack/runtime/make namespace object"],"names":["root","factory","exports","module","define","amd","self","modules","installedModules","moduleId","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","target","sources","source","key","arguments","length","mixin","build","config","max","plugin","plugins","methods","properties","defineProperties","hook","fsm","additional","method","args","context","concat","apply","camelize","label","result","words","split","toLowerCase","charAt","toUpperCase","substring","prepended","prepend","Config","options","StateMachine","this","defaults","states","transitions","map","lifecycle","configureLifecycle","init","configureInitTransition","data","configureData","configureMethods","wildcard","configureTransitions","configurePlugins","addState","push","addStateLifecycleNames","onEnter","onLeave","on","addTransition","indexOf","addTransitionLifecycleNames","onBefore","onAfter","mapTransition","transition","from","to","state","active","builtin","configure","Array","isArray","transitionFor","transitionsFor","keys","allStates","allTransitions","Exception","UNOBSERVED","JSM","observers","fire","is","isPending","pending","can","seek","cannot","entry","transit","changed","observeUnchangedState","onPendingTransition","beginTransit","unshift","observeEvents","observersForEvent","onInvalidTransition","endTransit","failTransit","doTransit","observe","observer","event","events","previousEvent","previousResult","undefined","pluggable","shift","then","bind","catch","PublicMethods","_fsm","t","PublicProperties","set","Error","instance","forEach","slice","version","cstor","message","current","pointer","initial","media","EventType","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave","Click","DoubleClick","ContextMenu","TouchStart","TouchEnd","TouchMove","TouchCancel","abs","Math","id","Rub","container","callback","bounds","Map","inputId","outputId","loopCallbacks","offset","t0","x0","y0","boundsContainer","querySelector","els","children","el","identifier","dataset","boundsType","targetEls","childElementCount","Handler","window","navigator","maxTouchPoints","msMaxTouchPoints","recorder","currentBoundsType","addListeners","addLoopCallback","output","frames","getFrames","requestAnimationFrame","input","ctime","velocity","targetIndex","isAttached","count","getEventTrackCount","track","getEventTrack","x","y","dt","dx","dy","getVelocity","getActiveTargetIndex","update","suspend","cancelAnimationFrame","resetBoundsType","removeEventHandler","setEventHandler","assign","removeListeners","clearEventTracks","resetFrames","documentElement","document","MouseHandler","super","listener","start","end","move","activate","inactivate","attached","addEventListener","targets","removeEventListener","MouseEvent","performance","now","rect","getBoundingClientRect","clientX","left","clientY","top","coords","addTrack","index","findTargetIndex","isActive","initialize","predicate","getTrack","clearTracks","PER_FRAME","round","Recorder","started","elapsedTime","lastTime","targetNum","blockSize","record","createRecord","shiftedFrames","live","playback","external","template","fill","liveTracker","currentFrames","setTrack","tracker","writeFrames","mode","shifted","subarray","size","tracks","Target","TouchHandler","TouchEvent","touch","changedTouches","cx","cy","trect","width","height","floor","Tracker","Float32Array","e","Uint8Array","Uint16Array","buffer","position","__webpack_module_cache__","__webpack_require__","__webpack_modules__","a","definition","obj","prop","r","Symbol","toStringTag"],"mappings":"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","file":"rub.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Rub\"] = factory();\n\telse\n\t\troot[\"Rub\"] = factory();\n})(self, function() {\nreturn ","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachine\"] = factory();\n\telse\n\t\troot[\"StateMachine\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(target, sources) {\n  var n, source, key;\n  for(n = 1 ; n < arguments.length ; n++) {\n    source = arguments[n];\n    for(key in source) {\n      if (source.hasOwnProperty(key))\n        target[key] = source[key];\n    }\n  }\n  return target;\n}\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin = __webpack_require__(0);\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = {\n\n  build: function(target, config) {\n    var n, max, plugin, plugins = config.plugins;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (plugin.methods)\n        mixin(target, plugin.methods);\n      if (plugin.properties)\n        Object.defineProperties(target, plugin.properties);\n    }\n  },\n\n  hook: function(fsm, name, additional) {\n    var n, max, method, plugin,\n        plugins = fsm.config.plugins,\n        args    = [fsm.context];\n\n    if (additional)\n      args = args.concat(additional)\n\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n]\n      method = plugins[n][name]\n      if (method)\n        method.apply(plugin, args);\n    }\n  }\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nfunction camelize(label) {\n\n  if (label.length === 0)\n    return label;\n\n  var n, result, word, words = label.split(/[_-]/);\n\n  // single word with first character already lowercase, return untouched\n  if ((words.length === 1) && (words[0][0].toLowerCase() === words[0][0]))\n    return label;\n\n  result = words[0].toLowerCase();\n  for(n = 1 ; n < words.length ; n++) {\n    result = result + words[n].charAt(0).toUpperCase() + words[n].substring(1).toLowerCase();\n  }\n\n  return result;\n}\n\n//-------------------------------------------------------------------------------------------------\n\ncamelize.prepended = function(prepend, label) {\n  label = camelize(label);\n  return prepend + label[0].toUpperCase() + label.substring(1);\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = camelize;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2);\n\n//-------------------------------------------------------------------------------------------------\n\nfunction Config(options, StateMachine) {\n\n  options = options || {};\n\n  this.options     = options; // preserving original options can be useful (e.g visualize plugin)\n  this.defaults    = StateMachine.defaults;\n  this.states      = [];\n  this.transitions = [];\n  this.map         = {};\n  this.lifecycle   = this.configureLifecycle();\n  this.init        = this.configureInitTransition(options.init);\n  this.data        = this.configureData(options.data);\n  this.methods     = this.configureMethods(options.methods);\n\n  this.map[this.defaults.wildcard] = {};\n\n  this.configureTransitions(options.transitions || []);\n\n  this.plugins = this.configurePlugins(options.plugins, StateMachine.plugin);\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(Config.prototype, {\n\n  addState: function(name) {\n    if (!this.map[name]) {\n      this.states.push(name);\n      this.addStateLifecycleNames(name);\n      this.map[name] = {};\n    }\n  },\n\n  addStateLifecycleNames: function(name) {\n    this.lifecycle.onEnter[name] = camelize.prepended('onEnter', name);\n    this.lifecycle.onLeave[name] = camelize.prepended('onLeave', name);\n    this.lifecycle.on[name]      = camelize.prepended('on',      name);\n  },\n\n  addTransition: function(name) {\n    if (this.transitions.indexOf(name) < 0) {\n      this.transitions.push(name);\n      this.addTransitionLifecycleNames(name);\n    }\n  },\n\n  addTransitionLifecycleNames: function(name) {\n    this.lifecycle.onBefore[name] = camelize.prepended('onBefore', name);\n    this.lifecycle.onAfter[name]  = camelize.prepended('onAfter',  name);\n    this.lifecycle.on[name]       = camelize.prepended('on',       name);\n  },\n\n  mapTransition: function(transition) {\n    var name = transition.name,\n        from = transition.from,\n        to   = transition.to;\n    this.addState(from);\n    if (typeof to !== 'function')\n      this.addState(to);\n    this.addTransition(name);\n    this.map[from][name] = transition;\n    return transition;\n  },\n\n  configureLifecycle: function() {\n    return {\n      onBefore: { transition: 'onBeforeTransition' },\n      onAfter:  { transition: 'onAfterTransition'  },\n      onEnter:  { state:      'onEnterState'       },\n      onLeave:  { state:      'onLeaveState'       },\n      on:       { transition: 'onTransition'       }\n    };\n  },\n\n  configureInitTransition: function(init) {\n    if (typeof init === 'string') {\n      return this.mapTransition(mixin({}, this.defaults.init, { to: init, active: true }));\n    }\n    else if (typeof init === 'object') {\n      return this.mapTransition(mixin({}, this.defaults.init, init, { active: true }));\n    }\n    else {\n      this.addState(this.defaults.init.from);\n      return this.defaults.init;\n    }\n  },\n\n  configureData: function(data) {\n    if (typeof data === 'function')\n      return data;\n    else if (typeof data === 'object')\n      return function() { return data; }\n    else\n      return function() { return {};  }\n  },\n\n  configureMethods: function(methods) {\n    return methods || {};\n  },\n\n  configurePlugins: function(plugins, builtin) {\n    plugins = plugins || [];\n    var n, max, plugin;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (typeof plugin === 'function')\n        plugins[n] = plugin = plugin()\n      if (plugin.configure)\n        plugin.configure(this);\n    }\n    return plugins\n  },\n\n  configureTransitions: function(transitions) {\n    var i, n, transition, from, to, wildcard = this.defaults.wildcard;\n    for(n = 0 ; n < transitions.length ; n++) {\n      transition = transitions[n];\n      from  = Array.isArray(transition.from) ? transition.from : [transition.from || wildcard]\n      to    = transition.to || wildcard;\n      for(i = 0 ; i < from.length ; i++) {\n        this.mapTransition({ name: transition.name, from: from[i], to: to });\n      }\n    }\n  },\n\n  transitionFor: function(state, transition) {\n    var wildcard = this.defaults.wildcard;\n    return this.map[state][transition] ||\n           this.map[wildcard][transition];\n  },\n\n  transitionsFor: function(state) {\n    var wildcard = this.defaults.wildcard;\n    return Object.keys(this.map[state]).concat(Object.keys(this.map[wildcard]));\n  },\n\n  allStates: function() {\n    return this.states;\n  },\n\n  allTransitions: function() {\n    return this.transitions;\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = Config;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\nvar mixin      = __webpack_require__(0),\n    Exception  = __webpack_require__(6),\n    plugin     = __webpack_require__(1),\n    UNOBSERVED = [ null, [] ];\n\n//-------------------------------------------------------------------------------------------------\n\nfunction JSM(context, config) {\n  this.context   = context;\n  this.config    = config;\n  this.state     = config.init.from;\n  this.observers = [context];\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(JSM.prototype, {\n\n  init: function(args) {\n    mixin(this.context, this.config.data.apply(this.context, args));\n    plugin.hook(this, 'init');\n    if (this.config.init.active)\n      return this.fire(this.config.init.name, []);\n  },\n\n  is: function(state) {\n    return Array.isArray(state) ? (state.indexOf(this.state) >= 0) : (this.state === state);\n  },\n\n  isPending: function() {\n    return this.pending;\n  },\n\n  can: function(transition) {\n    return !this.isPending() && !!this.seek(transition);\n  },\n\n  cannot: function(transition) {\n    return !this.can(transition);\n  },\n\n  allStates: function() {\n    return this.config.allStates();\n  },\n\n  allTransitions: function() {\n    return this.config.allTransitions();\n  },\n\n  transitions: function() {\n    return this.config.transitionsFor(this.state);\n  },\n\n  seek: function(transition, args) {\n    var wildcard = this.config.defaults.wildcard,\n        entry    = this.config.transitionFor(this.state, transition),\n        to       = entry && entry.to;\n    if (typeof to === 'function')\n      return to.apply(this.context, args);\n    else if (to === wildcard)\n      return this.state\n    else\n      return to\n  },\n\n  fire: function(transition, args) {\n    return this.transit(transition, this.state, this.seek(transition, args), args);\n  },\n\n  transit: function(transition, from, to, args) {\n\n    var lifecycle = this.config.lifecycle,\n        changed   = this.config.options.observeUnchangedState || (from !== to);\n\n    if (!to)\n      return this.context.onInvalidTransition(transition, from, to);\n\n    if (this.isPending())\n      return this.context.onPendingTransition(transition, from, to);\n\n    this.config.addState(to);  // might need to add this state if it's unknown (e.g. conditional transition or goto)\n\n    this.beginTransit();\n\n    args.unshift({             // this context will be passed to each lifecycle event observer\n      transition: transition,\n      from:       from,\n      to:         to,\n      fsm:        this.context\n    });\n\n    return this.observeEvents([\n                this.observersForEvent(lifecycle.onBefore.transition),\n                this.observersForEvent(lifecycle.onBefore[transition]),\n      changed ? this.observersForEvent(lifecycle.onLeave.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onLeave[from]) : UNOBSERVED,\n                this.observersForEvent(lifecycle.on.transition),\n      changed ? [ 'doTransit', [ this ] ]                       : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter[to])   : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.on[to])        : UNOBSERVED,\n                this.observersForEvent(lifecycle.onAfter.transition),\n                this.observersForEvent(lifecycle.onAfter[transition]),\n                this.observersForEvent(lifecycle.on[transition])\n    ], args);\n  },\n\n  beginTransit: function()          { this.pending = true;                 },\n  endTransit:   function(result)    { this.pending = false; return result; },\n  failTransit:  function(result)    { this.pending = false; throw result;  },\n  doTransit:    function(lifecycle) { this.state = lifecycle.to;           },\n\n  observe: function(args) {\n    if (args.length === 2) {\n      var observer = {};\n      observer[args[0]] = args[1];\n      this.observers.push(observer);\n    }\n    else {\n      this.observers.push(args[0]);\n    }\n  },\n\n  observersForEvent: function(event) { // TODO: this could be cached\n    var n = 0, max = this.observers.length, observer, result = [];\n    for( ; n < max ; n++) {\n      observer = this.observers[n];\n      if (observer[event])\n        result.push(observer);\n    }\n    return [ event, result, true ]\n  },\n\n  observeEvents: function(events, args, previousEvent, previousResult) {\n    if (events.length === 0) {\n      return this.endTransit(previousResult === undefined ? true : previousResult);\n    }\n\n    var event     = events[0][0],\n        observers = events[0][1],\n        pluggable = events[0][2];\n\n    args[0].event = event;\n    if (event && pluggable && event !== previousEvent)\n      plugin.hook(this, 'lifecycle', args);\n\n    if (observers.length === 0) {\n      events.shift();\n      return this.observeEvents(events, args, event, previousResult);\n    }\n    else {\n      var observer = observers.shift(),\n          result = observer[event].apply(observer, args);\n      if (result && typeof result.then === 'function') {\n        return result.then(this.observeEvents.bind(this, events, args, event))\n                     .catch(this.failTransit.bind(this))\n      }\n      else if (result === false) {\n        return this.endTransit(false);\n      }\n      else {\n        return this.observeEvents(events, args, event, result);\n      }\n    }\n  },\n\n  onInvalidTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid in current state\", transition, from, to, this.state);\n  },\n\n  onPendingTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid while previous transition is still in progress\", transition, from, to, this.state);\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = JSM;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-----------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2),\n    plugin   = __webpack_require__(1),\n    Config   = __webpack_require__(3),\n    JSM      = __webpack_require__(4);\n\n//-----------------------------------------------------------------------------------------------\n\nvar PublicMethods = {\n  is:                  function(state)       { return this._fsm.is(state)                                     },\n  can:                 function(transition)  { return this._fsm.can(transition)                               },\n  cannot:              function(transition)  { return this._fsm.cannot(transition)                            },\n  observe:             function()            { return this._fsm.observe(arguments)                            },\n  transitions:         function()            { return this._fsm.transitions()                                 },\n  allTransitions:      function()            { return this._fsm.allTransitions()                              },\n  allStates:           function()            { return this._fsm.allStates()                                   },\n  onInvalidTransition: function(t, from, to) { return this._fsm.onInvalidTransition(t, from, to)              },\n  onPendingTransition: function(t, from, to) { return this._fsm.onPendingTransition(t, from, to)              },\n}\n\nvar PublicProperties = {\n  state: {\n    configurable: false,\n    enumerable:   true,\n    get: function() {\n      return this._fsm.state;\n    },\n    set: function(state) {\n      throw Error('use transitions to change state')\n    }\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nfunction StateMachine(options) {\n  return apply(this || {}, options);\n}\n\nfunction factory() {\n  var cstor, options;\n  if (typeof arguments[0] === 'function') {\n    cstor   = arguments[0];\n    options = arguments[1] || {};\n  }\n  else {\n    cstor   = function() { this._fsm.apply(this, arguments) };\n    options = arguments[0] || {};\n  }\n  var config = new Config(options, StateMachine);\n  build(cstor.prototype, config);\n  cstor.prototype._fsm.config = config; // convenience access to shared config without needing an instance\n  return cstor;\n}\n\n//-------------------------------------------------------------------------------------------------\n\nfunction apply(instance, options) {\n  var config = new Config(options, StateMachine);\n  build(instance, config);\n  instance._fsm();\n  return instance;\n}\n\nfunction build(target, config) {\n  if ((typeof target !== 'object') || Array.isArray(target))\n    throw Error('StateMachine can only be applied to objects');\n  plugin.build(target, config);\n  Object.defineProperties(target, PublicProperties);\n  mixin(target, PublicMethods);\n  mixin(target, config.methods);\n  config.allTransitions().forEach(function(transition) {\n    target[camelize(transition)] = function() {\n      return this._fsm.fire(transition, [].slice.call(arguments))\n    }\n  });\n  target._fsm = function() {\n    this._fsm = new JSM(this, config);\n    this._fsm.init(arguments);\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nStateMachine.version  = '3.0.1';\nStateMachine.factory  = factory;\nStateMachine.apply    = apply;\nStateMachine.defaults = {\n  wildcard: '*',\n  init: {\n    name: 'init',\n    from: 'none'\n  }\n}\n\n//===============================================================================================\n\nmodule.exports = StateMachine;\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(message, transition, from, to, current) {\n  this.message    = message;\n  this.transition = transition;\n  this.from       = from;\n  this.to         = to;\n  this.current    = current;\n}\n\n\n/***/ })\n/******/ ]);\n});","interface Dataset {\n  [index: string]: StateMachine.StateMachineConfig;\n}\n\nconst dataset: Dataset = {\n  pointer: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'idling' },\n      { name: 'start', from: 'idling', to: 'running' },\n      { name: 'end', from: 'running', to: 'idling' },\n    ],\n  },\n\n  target: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'inactive' },\n      { name: 'activate', from: 'inactive', to: 'active' },\n      { name: 'inactivate', from: 'active', to: 'inactive' },\n    ],\n  },\n\n  media: {\n    initial: 'created',\n    events: [\n      { name: 'initialize', from: 'created', to: 'initialized' },\n      { name: 'ready', from: 'initialized', to: 'idling' },\n      { name: 'reset', from: ['idling', 'error'], to: 'initialized' },\n      { name: 'start', from: 'idling', to: 'running' },\n      { name: 'stop', from: 'running', to: 'idling' },\n      { name: 'pause', from: 'running', to: 'pending' },\n      { name: 'resume', from: 'pending', to: 'running' },\n      { name: 'quit', from: 'pending', to: 'idling' },\n      { name: 'abort', from: '*', to: 'error' },\n    ],\n  },\n};\n\nexport default dataset;\n","export default class EventType {\n  static readonly MouseDown = 'mousedown';\n\n  static readonly MouseUp = 'mouseup';\n\n  static readonly MouseMove = 'mousemove';\n\n  static readonly MouseEnter = 'mouseenter';\n\n  static readonly MouseLeave = 'mouseleave';\n\n  static readonly Click = 'click';\n\n  static readonly DoubleClick = 'dblclick';\n\n  static readonly ContextMenu = 'contextmenu';\n\n  static readonly TouchStart = 'touchstart';\n\n  static readonly TouchEnd = 'touchend';\n\n  static readonly TouchMove = 'touchmove';\n\n  static readonly TouchCancel = 'touchcancel';\n}\n","import * as JSM from 'javascript-state-machine';\nimport MouseHandler from './mouse-handler';\nimport TouchHandler from './touch-handler';\nimport Recorder from './recorder';\nimport dataset from './dataset';\nimport * as IRub from './interface';\n\ninterface Loop {\n  (ctime: number): void;\n}\n\nconst MIN_INTERVAL = 4;\nconst BOUNDS_ID = 'rb-bounds';\nconst { abs, max } = Math;\n\nfunction isTouchEnabled(): boolean {\n  return (\n    'ontouchstart' in window ||\n    navigator.maxTouchPoints > 0 ||\n    navigator.msMaxTouchPoints > 0\n  );\n}\n\nfunction getVelocity(dt: number, dx: number, dy: number): number {\n  if (dt > 0) {\n    return max(abs(dx / dt), abs(dy / dt));\n  }\n  return 0;\n}\n\nlet id = 0;\n\nfunction genId(): number {\n  id += 1;\n  return id;\n}\n\nexport default class Rub implements IRub.MainInterface {\n  private id: number;\n\n  private bounds: Map<IRub.BoundsType, IRub.Bounds> = new Map();\n\n  private currentBoundsType: IRub.BoundsType;\n\n  private inputId = 0;\n\n  private outputId = 0;\n\n  private loopCallbacks: IRub.LoopCallback[] = [];\n\n  private input: Loop;\n\n  private output: Loop;\n\n  private offset = 0;\n\n  private t0 = 0;\n\n  private x0 = 0;\n\n  private y0 = 0;\n\n  public event: IRub.PointerHandlerInterface;\n\n  public recorder: IRub.RecorderInterface;\n\n  public media: IRub.MediaStateMachine;\n\n  public constructor(\n    private container: HTMLDivElement,\n    callback?: IRub.LoopCallback | IRub.LoopCallback[]\n  ) {\n    this.id = genId();\n\n    const boundsContainer = this.container.querySelector(\n      `.${BOUNDS_ID}`\n    ) as HTMLDivElement;\n    const els = Array.from(boundsContainer.children) as HTMLDivElement[];\n\n    for (let i = 0, l = els.length; i < l; i += 1) {\n      const el = els[i];\n      const identifier = el.dataset.boundsType as IRub.BoundsType;\n\n      if (identifier == null) {\n        throw new Error('cannot find identified class name');\n      }\n\n      const targetEls =\n        el.childElementCount > 0 ? Array.from(el.children) : [el];\n\n      const Handler = !isTouchEnabled() ? MouseHandler : TouchHandler;\n\n      this.bounds.set(identifier, {\n        recorder: new Recorder(targetEls as HTMLDivElement[]),\n        event: new Handler(targetEls as HTMLDivElement[]),\n      });\n    }\n\n    const [key] = Array.from(this.bounds.keys());\n    const bounds = this.bounds.get(key) as IRub.Bounds;\n    this.currentBoundsType = key;\n    this.recorder = bounds.recorder;\n    this.event = bounds.event;\n    this.event.addListeners(this.container);\n\n    this.media = JSM.create(dataset.media) as IRub.MediaStateMachine;\n\n    if (callback != null) {\n      this.addLoopCallback(callback);\n    }\n\n    this.output = (): void => {\n      if (this.loopCallbacks.length > 0) {\n        const frames = this.recorder.getFrames();\n\n        for (let i = 0, l = this.loopCallbacks.length; i < l; i += 1) {\n          this.loopCallbacks[i](frames);\n        }\n      }\n\n      this.outputId = requestAnimationFrame(this.output);\n    };\n\n    this.input = (ctime: number): void => {\n      let velocity = 0;\n      let targetIndex = -1;\n\n      if (this.event.isAttached()) {\n        const count = this.event.getEventTrackCount();\n        if (count > this.offset) {\n          const track = this.event.getEventTrack();\n          const [t, x, y] = Array.from(track);\n\n          if (this.t0 > 0) {\n            const dt = t - this.t0;\n            const dx = x - this.x0;\n            const dy = y - this.y0;\n\n            if (dt > MIN_INTERVAL) {\n              velocity = getVelocity(dt, dx, dy);\n            }\n          }\n\n          this.t0 = t;\n          this.x0 = x;\n          this.y0 = y;\n\n          this.offset = count;\n        }\n\n        targetIndex = this.event.getActiveTargetIndex();\n      }\n\n      this.recorder.update(ctime, velocity, targetIndex);\n\n      this.inputId = requestAnimationFrame(this.input);\n    };\n  }\n\n  public getId(): number {\n    return this.id;\n  }\n\n  /* ポインターイベントの速度計測とその出力を開始または再開する。 */\n  public startLoop(): void {\n    this.inputId = requestAnimationFrame(this.input);\n    this.outputId = requestAnimationFrame(this.output);\n  }\n\n  /* レコーディングを一時停止する。経過時間は停止した時点のまま */\n  public stopLoop(): void {\n    this.recorder.suspend();\n\n    cancelAnimationFrame(this.inputId);\n    cancelAnimationFrame(this.outputId);\n  }\n\n  /* レコーディングの状態を初期に戻す */\n  public clearLoop(): void {\n    this.t0 = 0;\n    this.x0 = 0;\n    this.y0 = 0;\n    this.offset = 0;\n\n    this.resetBoundsType();\n  }\n\n  public getCurrentBoundsType(): IRub.BoundsType {\n    return this.currentBoundsType;\n  }\n\n  public setBoundsType(key: IRub.BoundsType): void {\n    const bounds = this.bounds.get(key);\n\n    if (bounds == null) {\n      throw new Error('this is assigned undefined');\n    }\n\n    this.currentBoundsType = key;\n\n    this.resetBoundsType();\n    this.removeEventHandler();\n\n    this.recorder = bounds.recorder;\n    this.event = bounds.event;\n    this.setEventHandler();\n  }\n\n  public setMediaCallback(callback: IRub.MediaStateCallback): void {\n    Object.assign(this.media, callback);\n  }\n\n  public addLoopCallback(\n    callback: IRub.LoopCallback | IRub.LoopCallback[]\n  ): void {\n    if (!Array.isArray(callback)) {\n      this.loopCallbacks.push(callback.bind(this));\n    } else {\n      for (let i = 0, l = callback.length; i < l; i += 1) {\n        this.loopCallbacks.push(callback[i].bind(this));\n      }\n    }\n  }\n\n  public clearLoopCallback(): void {\n    this.loopCallbacks.length = 0;\n  }\n\n  private setEventHandler(): void {\n    if (!this.event.isAttached()) {\n      this.event.addListeners(this.container);\n    }\n  }\n\n  private removeEventHandler(): void {\n    if (this.event.isAttached()) {\n      this.event.removeListeners(this.container);\n    }\n  }\n\n  private resetBoundsType(): void {\n    this.event.clearEventTracks();\n    this.recorder.resetFrames();\n  }\n}\n","import PointerHandler from './pointer-handler';\nimport EventType from './event-type';\nimport * as IRub from './interface';\n\nconst { documentElement } = document;\n\nexport default class MouseHandler extends PointerHandler {\n  public constructor(els: HTMLDivElement[]) {\n    super(els);\n\n    this.listener = {\n      start: MouseHandler.start.bind(this, this.state),\n      end: MouseHandler.end.bind(this, this.state),\n      move: MouseHandler.move.bind(this, this.state),\n      activate: MouseHandler.activate.bind(this),\n      inactivate: MouseHandler.inactivate.bind(this),\n    };\n  }\n\n  public addListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    this.attached = true;\n\n    el.addEventListener(EventType.MouseDown, this.listener.start, false);\n    el.addEventListener(EventType.MouseMove, this.listener.move, false);\n    el.addEventListener(EventType.MouseUp, this.listener.end, false);\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n\n      target.el.addEventListener(\n        EventType.MouseEnter,\n        this.listener.activate,\n        false\n      );\n      target.el.addEventListener(\n        EventType.MouseLeave,\n        this.listener.inactivate,\n        false\n      );\n    }\n  }\n\n  public removeListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    this.attached = false;\n\n    el.removeEventListener(EventType.MouseDown, this.listener.start, false);\n    el.removeEventListener(EventType.MouseMove, this.listener.move, false);\n    el.removeEventListener(EventType.MouseUp, this.listener.end, false);\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n\n      target.el.removeEventListener(\n        EventType.MouseEnter,\n        this.listener.activate,\n        false\n      );\n      target.el.removeEventListener(\n        EventType.MouseLeave,\n        this.listener.inactivate,\n        false\n      );\n    }\n  }\n\n  static start(\n    this: MouseHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    if (state.current !== 'idling') {\n      return;\n    }\n\n    state.start();\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static move(\n    this: MouseHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static end(\n    this: MouseHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n\n    state.end();\n  }\n\n  static activate(this: MouseHandler, event: MouseEvent | TouchEvent): void {\n    const index = this.findTargetIndex(\n      (t: IRub.TargetInterface): boolean =>\n        t.el === (event.target as HTMLDivElement)\n    );\n    const target = this.targets[index];\n\n    if (target == null) {\n      return;\n    }\n\n    if (target.state.current !== 'inactive') {\n      return;\n    }\n\n    target.state.activate();\n  }\n\n  static inactivate(this: MouseHandler, event: MouseEvent | TouchEvent): void {\n    const index = this.findTargetIndex(\n      (t: IRub.TargetInterface): boolean =>\n        t.el === (event.target as HTMLDivElement)\n    );\n    const target = this.targets[index];\n\n    if (target == null) {\n      return;\n    }\n\n    if (target.state.current !== 'active') {\n      return;\n    }\n\n    target.state.inactivate();\n  }\n}\n","import { StateMachine } from 'javascript-state-machine';\nimport Target from './target';\nimport Tracker from './tracker';\nimport dataset from './dataset';\nimport * as IRub from './interface';\n\nconst BLOCK_SIZE = 3; // [t, x, y]\nconst TRACK_SIZE = 900000; // (bytes)\n\nconst isActive = (target: IRub.TargetInterface): boolean => target.isActive();\n\nabstract class PointerHandler implements IRub.PointerHandlerInterface {\n  protected state: IRub.PointerStateMachine;\n\n  protected listener: IRub.ListenerInterface;\n\n  protected targets: IRub.TargetInterface[];\n\n  protected coords: IRub.TrackerInterface;\n\n  protected attached = false;\n\n  public constructor(els: HTMLDivElement[]) {\n    this.targets = els.map((el) => {\n      const target = new Target(el);\n      target.state.initialize();\n      return target;\n    });\n\n    this.state = StateMachine.create(\n      dataset.pointer\n    ) as IRub.PointerStateMachine;\n    this.state.initialize();\n\n    this.coords = new Tracker(TRACK_SIZE, BLOCK_SIZE);\n    this.listener = {};\n  }\n\n  protected findTargetIndex(\n    predicate: (target: IRub.TargetInterface) => boolean\n  ): number {\n    let result = -1;\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const t = this.targets[i];\n\n      if (predicate(t)) {\n        result = i;\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  public getActiveTargetIndex(): number {\n    const targetIndex = this.findTargetIndex(isActive);\n\n    return targetIndex;\n  }\n\n  public getEventTrackCount(): number {\n    return this.coords.count;\n  }\n\n  public getEventTrack(): Float32Array {\n    return this.coords.getTrack();\n  }\n\n  public clearEventTracks(): void {\n    return this.coords.clearTracks();\n  }\n\n  public isAttached(): boolean {\n    return this.attached;\n  }\n\n  public abstract addListeners(el: HTMLDivElement): void;\n\n  public abstract removeListeners(el: HTMLDivElement): void;\n}\n\nexport default PointerHandler;\n","import Tracker from './tracker';\nimport * as IRub from './interface';\n\nconst TRACK_SIZE = 216000;\nconst FPS = 60;\nconst PER_FRAME = 1000 / FPS;\n\nconst { round } = Math;\n\nexport default class Recorder implements IRub.RecorderInterface {\n  public record: IRub.Record;\n\n  private blockSize: number;\n\n  private frames = 0;\n\n  private started = false;\n\n  private elapsedTime = 0;\n\n  private lastTime = 0;\n\n  private template: number[];\n\n  private shiftedFrames: {\n    [P in IRub.RecordMode]: number;\n  };\n\n  public constructor(els: HTMLDivElement[]) {\n    const targetNum = els.length;\n\n    this.blockSize = targetNum + 1;\n\n    this.record = new Map([\n      ['live', this.createRecord()],\n      ['playback', this.createRecord()],\n      ['external', this.createRecord()],\n    ]);\n\n    this.shiftedFrames = {\n      live: 0,\n      playback: 0,\n      external: 0,\n    };\n\n    this.template = Array(targetNum + 1).fill(0);\n  }\n\n  public update(ctime: number, velocity: number, targetIndex: number): void {\n    const track = this.template.slice(0);\n    const liveTracker = this.record.get('live') as Tracker;\n\n    if (!this.started) {\n      this.started = true;\n      this.lastTime = ctime;\n\n      track[0] = this.frames;\n      liveTracker.setTrack(track, this.frames);\n    } else {\n      this.elapsedTime += ctime - this.lastTime;\n      this.lastTime = ctime;\n\n      const currentFrames = round(this.elapsedTime / PER_FRAME);\n\n      if (currentFrames > this.frames) {\n        this.frames = currentFrames;\n        track[0] = this.frames;\n\n        if (targetIndex > -1) {\n          track[targetIndex + 1] = velocity;\n        }\n\n        liveTracker.setTrack(track, this.frames);\n      }\n    }\n  }\n\n  private createRecord(): Tracker {\n    const tracker = new Tracker(TRACK_SIZE, this.blockSize);\n    tracker.writeFrames();\n    return tracker;\n  }\n\n  public getElapsedTime(): number {\n    return this.elapsedTime;\n  }\n\n  public getFrames(): number {\n    return this.frames;\n  }\n\n  public setFrames(frames: number): void {\n    const track = this.template.slice(0);\n    track[0] = frames;\n    (this.record.get('live') as Tracker).setTrack(track, frames);\n\n    const diff = frames - this.frames;\n    const shift = diff * PER_FRAME;\n    this.elapsedTime += shift;\n    this.frames = frames;\n  }\n\n  public suspend(): void {\n    this.started = false;\n  }\n\n  public resetFrames(): void {\n    this.frames = 0;\n    this.started = false;\n    this.lastTime = 0;\n    this.elapsedTime = 0;\n  }\n\n  public clearRecord(mode: IRub.RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).writeFrames();\n  }\n\n  public getRecordCount(mode: IRub.RecordMode = 'live'): number {\n    return (this.record.get(mode) as Tracker).count;\n  }\n\n  public getVelocities(offset = -1, mode: IRub.RecordMode = 'live'): number[] {\n    const shifted = offset + this.shiftedFrames[mode];\n    const track = (this.record.get(mode) as Tracker).getTrack(shifted);\n    const velocities = Array.from(track.subarray(1));\n    return velocities;\n  }\n\n  public getRecord(mode: IRub.RecordMode = 'live'): Float32Array {\n    const tracker = this.record.get(mode) as Tracker;\n    return tracker.getTrack(0, tracker.size);\n  }\n\n  public setRecord(tracks: Float32Array, mode: IRub.RecordMode = 'live'): void {\n    (this.record.get(mode) as Tracker).setTrack(tracks);\n  }\n\n  public addData(data: number[]): void {\n    (this.record.get('live') as Tracker).addTrack(data);\n  }\n\n  public getData(\n    offset = -1,\n    count = 1,\n    mode: IRub.RecordMode = 'live'\n  ): Float32Array {\n    const shifted = offset + this.shiftedFrames[mode];\n    return (this.record.get(mode) as Tracker).getTrack(shifted, count);\n  }\n\n  public setData(\n    track: number[],\n    offset = 0,\n    mode: IRub.RecordMode = 'live'\n  ): void {\n    (this.record.get(mode) as Tracker).setTrack(track, offset);\n  }\n\n  public setShiftedFrames(\n    frames: number,\n    mode: IRub.RecordMode = 'live'\n  ): void {\n    this.shiftedFrames[mode] = frames;\n  }\n}\n","import { StateMachine } from 'javascript-state-machine';\nimport dataset from './dataset';\nimport * as IRub from './interface';\n\nexport default class Target implements IRub.TargetInterface {\n  public state: IRub.TargetStateMachine;\n\n  public constructor(public el: HTMLDivElement) {\n    this.state = StateMachine.create(dataset.target) as IRub.TargetStateMachine;\n  }\n\n  public isActive(): boolean {\n    return this.state.current === 'active';\n  }\n}\n","import PointerHandler from './pointer-handler';\nimport EventType from './event-type';\nimport * as IRub from './interface';\n\nconst { documentElement } = document;\n\nexport default class TouchHandler extends PointerHandler {\n  public constructor(els: HTMLDivElement[]) {\n    super(els);\n\n    this.listener = {\n      start: TouchHandler.start.bind(this, this.state),\n      move: TouchHandler.move.bind(this, this.state),\n      end: TouchHandler.end.bind(this, this.state),\n    };\n  }\n\n  public addListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    if (this.attached) {\n      return;\n    }\n    this.attached = true;\n\n    el.addEventListener(EventType.TouchStart, this.listener.start, false);\n    el.addEventListener(EventType.TouchMove, this.listener.move, false);\n    el.addEventListener(EventType.TouchEnd, this.listener.end, false);\n    el.addEventListener(EventType.TouchCancel, this.listener.end, false);\n  }\n\n  public removeListeners(el: HTMLDivElement): void {\n    if (this.listener == null) {\n      return;\n    }\n\n    if (!this.attached) {\n      return;\n    }\n    this.attached = false;\n\n    el.removeEventListener(EventType.TouchStart, this.listener.start, false);\n    el.removeEventListener(EventType.TouchMove, this.listener.move, false);\n    el.removeEventListener(EventType.TouchEnd, this.listener.end, false);\n    el.removeEventListener(EventType.TouchCancel, this.listener.end, false);\n  }\n\n  static start(\n    this: TouchHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof TouchEvent)) {\n      return;\n    }\n\n    if (state.current !== 'idling') {\n      return;\n    }\n\n    state.start();\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const touch: Touch = Array.from(event.changedTouches)[0];\n    const x = touch.clientX - rect.left;\n    const y = touch.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static move(\n    this: TouchHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof TouchEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const touch: Touch = Array.from(event.changedTouches)[0];\n    const cx = touch.clientX;\n    const cy = touch.clientY;\n    const x = cx - rect.left;\n    const y = cy - rect.top;\n\n    for (let i = 0, l = this.targets.length; i < l; i += 1) {\n      const target = this.targets[i];\n      const trect: DOMRect = target.el.getBoundingClientRect();\n\n      const isActive =\n        cx >= trect.left &&\n        cx <= trect.left + trect.width &&\n        cy >= trect.top &&\n        cy <= trect.top + trect.height;\n\n      if (isActive) {\n        if (target.state.current !== 'active') {\n          target.state.activate();\n        }\n      } else if (target.state.current !== 'inactive') {\n        target.state.inactivate();\n      }\n    }\n\n    this.coords.addTrack([t, x, y]);\n  }\n\n  static end(\n    this: TouchHandler,\n    state: IRub.PointerStateMachine,\n    event: MouseEvent | TouchEvent\n  ): void {\n    if (!(event instanceof TouchEvent)) {\n      return;\n    }\n\n    if (state.current !== 'running') {\n      return;\n    }\n\n    const t = performance.now();\n\n    const rect: DOMRect = documentElement.getBoundingClientRect();\n    const touch: Touch = Array.from(event.changedTouches)[0];\n    const x = touch.clientX - rect.left;\n    const y = touch.clientY - rect.top;\n\n    this.coords.addTrack([t, x, y]);\n\n    state.end();\n  }\n}\n","import * as IRub from './interface';\n\nconst { floor } = Math;\n\nfunction SystemGetExecutedInLittleEndian(): boolean {\n  if (new Uint8Array(new Uint16Array([0x00ff]).buffer)[0]) {\n    return true;\n  }\n  return false;\n}\n\nexport default class Tracker implements IRub.TrackerInterface {\n  public readonly blockSize: number;\n\n  protected tracks: Float32Array;\n\n  protected end = 0;\n\n  public constructor(length: number, blockSize: number) {\n    this.blockSize = blockSize;\n\n    try {\n      this.tracks = new Float32Array(length * this.blockSize);\n    } catch (e) {\n      throw new Error('cannot allocate memory');\n    }\n\n    if (!SystemGetExecutedInLittleEndian()) {\n      throw new Error('required little endian system');\n    }\n  }\n\n  get count(): number {\n    return floor(this.end / this.blockSize);\n  }\n\n  get size(): number {\n    return floor(this.tracks.length / this.blockSize);\n  }\n\n  public setTrack(track: number[] | Float32Array, offset = 0): void {\n    if (track.length % this.blockSize !== 0) {\n      throw new Error('Track size not matched');\n    }\n\n    const position = offset * this.blockSize;\n    this.tracks.set(track, position);\n\n    if (position + track.length >= this.end) {\n      this.end = position + track.length;\n    }\n  }\n\n  /* addTrack(), getLastTrack()はRecorderクラスでの使用を想定 */\n  public addTrack(track: number[]): void {\n    if (track.length % this.blockSize !== 0) {\n      throw new Error('Track size not matched');\n    }\n\n    this.tracks.set(track, this.end);\n    this.end += track.length;\n  }\n\n  /* 任意の場所からトラックデータを取得する。引数に何も指定しない場合、最後のブロックを取得する */\n  public getTrack(offset = -1, count = 1): Float32Array {\n    const position =\n      offset < 0\n        ? (this.count + offset) * this.blockSize\n        : offset * this.blockSize;\n\n    const end = position + count * this.blockSize;\n    const track = this.tracks.subarray(position, end);\n\n    return track;\n  }\n\n  public clearTracks(): void {\n    this.end = 0;\n    this.tracks.fill(0);\n  }\n\n  public writeFrames(): void {\n    this.clearTracks();\n\n    for (let i = 0, l = this.tracks.length, count = 0; i < l; i += 1) {\n      if (i % this.blockSize === 0) {\n        this.tracks.set([count], i);\n        count += 1;\n      }\n    }\n  }\n\n  public static create(length: number, blockSize: number): Tracker {\n    return new Tracker(length, blockSize);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(\"./src/index.ts\");\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}