/*! For license information please see rub.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Rub=e():t.Rub=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="./src/index.ts")}({"./node_modules/javascript-state-machine/state-machine.js":function(t,e,n){var r;r={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var n="string"==typeof t.initial?{state:t.initial}:t.initial,i=t.terminal||t.final,o=e||t.target||{},a=t.events||[],s=t.callbacks||{},c={},u={},l=function(t){var e=Array.isArray(t.from)?t.from:t.from?[t.from]:[r.WILDCARD];c[t.name]=c[t.name]||{};for(var n=0;n<e.length;n++)u[e[n]]=u[e[n]]||[],u[e[n]].push(t.name),c[t.name][e[n]]=t.to||e[n];t.to&&(u[t.to]=u[t.to]||[])};n&&(n.event=n.event||"startup",l({name:n.event,from:"none",to:n.state}));for(var d=0;d<a.length;d++)l(a[d]);for(var f in c)c.hasOwnProperty(f)&&(o[f]=r.buildEvent(f,c[f]));for(var f in s)s.hasOwnProperty(f)&&(o[f]=s[f]);return o.current="none",o.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},o.can=function(t){return!this.transition&&void 0!==c[t]&&(c[t].hasOwnProperty(this.current)||c[t].hasOwnProperty(r.WILDCARD))},o.cannot=function(t){return!this.can(t)},o.transitions=function(){return(u[this.current]||[]).concat(u[r.WILDCARD]||[])},o.isFinished=function(){return this.is(i)},o.error=t.error||function(t,e,n,r,i,o,a){throw a||o},o.states=function(){return Object.keys(u).sort()},n&&!n.defer&&o[n.event](),o},doCallback:function(t,e,n,i,o,a){if(e)try{return e.apply(t,[n,i,o].concat(a))}catch(e){return t.error(n,i,o,a,r.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(t,e,n,i,o){return r.doCallback(t,t.onbeforeevent,e,n,i,o)},afterAnyEvent:function(t,e,n,i,o){return r.doCallback(t,t.onafterevent||t.onevent,e,n,i,o)},leaveAnyState:function(t,e,n,i,o){return r.doCallback(t,t.onleavestate,e,n,i,o)},enterAnyState:function(t,e,n,i,o){return r.doCallback(t,t.onenterstate||t.onstate,e,n,i,o)},changeState:function(t,e,n,i,o){return r.doCallback(t,t.onchangestate,e,n,i,o)},beforeThisEvent:function(t,e,n,i,o){return r.doCallback(t,t["onbefore"+e],e,n,i,o)},afterThisEvent:function(t,e,n,i,o){return r.doCallback(t,t["onafter"+e]||t["on"+e],e,n,i,o)},leaveThisState:function(t,e,n,i,o){return r.doCallback(t,t["onleave"+n],e,n,i,o)},enterThisState:function(t,e,n,i,o){return r.doCallback(t,t["onenter"+i]||t["on"+i],e,n,i,o)},beforeEvent:function(t,e,n,i,o){if(!1===r.beforeThisEvent(t,e,n,i,o)||!1===r.beforeAnyEvent(t,e,n,i,o))return!1},afterEvent:function(t,e,n,i,o){r.afterThisEvent(t,e,n,i,o),r.afterAnyEvent(t,e,n,i,o)},leaveState:function(t,e,n,i,o){var a=r.leaveThisState(t,e,n,i,o),s=r.leaveAnyState(t,e,n,i,o);return!1!==a&&!1!==s&&(r.ASYNC===a||r.ASYNC===s?r.ASYNC:void 0)},enterState:function(t,e,n,i,o){r.enterThisState(t,e,n,i,o),r.enterAnyState(t,e,n,i,o)},buildEvent:function(t,e){return function(){var n=this.current,i=e[n]||(e[r.WILDCARD]!=r.WILDCARD?e[r.WILDCARD]:n)||n,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,n,i,o,r.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,n,i,o,r.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===r.beforeEvent(this,t,n,i,o))return r.Result.CANCELLED;if(n===i)return r.afterEvent(this,t,n,i,o),r.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=i,r.enterState(a,t,n,i,o),r.changeState(a,t,n,i,o),r.afterEvent(a,t,n,i,o),r.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,r.afterEvent(a,t,n,i,o)};var s=r.leaveState(this,t,n,i,o);return!1===s?(this.transition=null,r.Result.CANCELLED):r.ASYNC===s?r.Result.PENDING:this.transition?this.transition():void 0}}},t.exports&&(e=t.exports=r),e.StateMachine=r},"./src/dataset.ts":function(t,e,n){"use strict";n.r(e);e.default={pointer:{initial:"created",events:[{name:"initialize",from:"created",to:"idling"},{name:"start",from:"idling",to:"running"},{name:"end",from:"running",to:"idling"}]},target:{initial:"created",events:[{name:"initialize",from:"created",to:"inactive"},{name:"activate",from:"inactive",to:"active"},{name:"inactivate",from:"active",to:"inactive"}]},media:{initial:"created",events:[{name:"initialize",from:"created",to:"initialized"},{name:"ready",from:"initialized",to:"idling"},{name:"reset",from:["idling","error"],to:"initialized"},{name:"start",from:"idling",to:"running"},{name:"stop",from:"running",to:"idling"},{name:"pause",from:"running",to:"pending"},{name:"resume",from:"pending",to:"running"},{name:"quit",from:"pending",to:"idling"},{name:"abort",from:"*",to:"error"}]}}},"./src/event-type.ts":function(t,e,n){"use strict";n.r(e);var r=function(){function t(){}return t.MouseDown="mousedown",t.MouseUp="mouseup",t.MouseMove="mousemove",t.MouseEnter="mouseenter",t.MouseLeave="mouseleave",t.Click="click",t.DoubleClick="dblclick",t.ContextMenu="contextmenu",t.TouchStart="touchstart",t.TouchEnd="touchend",t.TouchMove="touchmove",t.TouchCancel="touchcancel",t}();e.default=r},"./src/index.ts":function(t,e,n){"use strict";n.r(e);var r=n("./node_modules/javascript-state-machine/state-machine.js"),i=n("./src/mouse-handler.ts"),o=n("./src/touch-handler.ts"),a=n("./src/recorder.ts"),s=n("./src/dataset.ts"),c=Math.abs,u=Math.max;var l=0;var d=function(){function t(t,e){var n=this;this.container=t,this.bounds=new Map,this.inputId=0,this.outputId=0,this.loopCallbacks=[],this.offset=0,this.t0=0,this.x0=0,this.y0=0,this.id=l+=1;for(var d=this.container.querySelector(".rb-bounds"),f=Array.from(d.children),h=0,v=f.length;h<v;h+=1){var p=f[h],m=p.dataset.boundsType;if(null==m)throw new Error("cannot find identified class name");var y=p.childElementCount>0?Array.from(p.children):[p],g="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?o.default:i.default;this.bounds.set(m,{recorder:new a.default(y),event:new g(y)})}var b=Array.from(this.bounds.keys())[0],T=this.bounds.get(b);this.currentBoundsType=b,this.recorder=T.recorder,this.event=T.event,this.event.addListeners(this.container),this.media=r.create(s.default.media),null!=e&&this.addLoopCallback(e),this.output=function(){if(n.loopCallbacks.length>0)for(var t=n.recorder.getFrames(),e=0,r=n.loopCallbacks.length;e<r;e+=1)n.loopCallbacks[e](t);n.outputId=requestAnimationFrame(n.output)},this.input=function(t){var e=0,r=-1;if(n.event.isAttached()){var i=n.event.getEventTrackCount();if(i>n.offset){var o=n.event.getEventTrack(),a=Array.from(o),s=a[0],l=a[1],d=a[2];if(n.t0>0){var f=s-n.t0,h=l-n.x0,v=d-n.y0;f>4&&(e=function(t,e,n){return t>0?u(c(e/t),c(n/t)):0}(f,h,v))}n.t0=s,n.x0=l,n.y0=d,n.offset=i}r=n.event.getActiveTargetIndex()}n.recorder.update(t,e,r),n.inputId=requestAnimationFrame(n.input)}}return t.prototype.getId=function(){return this.id},t.prototype.startLoop=function(){this.inputId=requestAnimationFrame(this.input),this.outputId=requestAnimationFrame(this.output)},t.prototype.stopLoop=function(){this.recorder.suspend(),cancelAnimationFrame(this.inputId),cancelAnimationFrame(this.outputId)},t.prototype.clearLoop=function(){this.t0=0,this.x0=0,this.y0=0,this.offset=0,this.resetBoundsType()},t.prototype.getCurrentBoundsType=function(){return this.currentBoundsType},t.prototype.setBoundsType=function(t){var e=this.bounds.get(t);if(null==e)throw new Error("this is assigned undefined");this.currentBoundsType=t,this.resetBoundsType(),this.removeEventHandler(),this.recorder=e.recorder,this.event=e.event,this.setEventHandler()},t.prototype.setMediaCallback=function(t){Object.assign(this.media,t)},t.prototype.addLoopCallback=function(t){if(Array.isArray(t))for(var e=0,n=t.length;e<n;e+=1)this.loopCallbacks.push(t[e].bind(this));else this.loopCallbacks.push(t.bind(this))},t.prototype.clearLoopCallback=function(){this.loopCallbacks.length=0},t.prototype.setEventHandler=function(){this.event.isAttached()||this.event.addListeners(this.container)},t.prototype.removeEventHandler=function(){this.event.isAttached()&&this.event.removeListeners(this.container)},t.prototype.resetBoundsType=function(){this.event.clearEventTracks(),this.recorder.resetFrames()},t}();e.default=d},"./src/mouse-handler.ts":function(t,e,n){"use strict";n.r(e);var r,i=n("./src/pointer-handler.ts"),o=n("./src/event-type.ts"),a=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=document.documentElement;function c(t,e){if(e instanceof MouseEvent&&"idling"===t.current){t.start();var n=performance.now(),r=s.getBoundingClientRect(),i=e.clientX-r.left,o=e.clientY-r.top;this.coords.addTrack([n,i,o])}}function u(t,e){if(e instanceof MouseEvent&&"running"===t.current){var n=performance.now(),r=s.getBoundingClientRect(),i=e.clientX-r.left,o=e.clientY-r.top;this.coords.addTrack([n,i,o])}}function l(t,e){if(e instanceof MouseEvent&&"running"===t.current){var n=performance.now(),r=s.getBoundingClientRect(),i=e.clientX-r.left,o=e.clientY-r.top;this.coords.addTrack([n,i,o]),t.end()}}function d(t){var e=this.findTargetIndex((function(e){return e.el===t.target})),n=this.targets[e];null!=n&&"inactive"===n.state.current&&n.state.activate()}function f(t){var e=this.findTargetIndex((function(e){return e.el===t.target})),n=this.targets[e];null!=n&&"active"===n.state.current&&n.state.inactivate()}var h=function(t){function e(e){var n=t.call(this,e)||this;return n.listener={start:c.bind(n,n.state),end:l.bind(n,n.state),move:u.bind(n,n.state),activate:d.bind(n),inactivate:f.bind(n)},n}return a(e,t),e.prototype.addListeners=function(t){if(null!=this.listener){this.attached=!0,t.addEventListener(o.default.MouseDown,this.listener.start,!1),t.addEventListener(o.default.MouseMove,this.listener.move,!1),t.addEventListener(o.default.MouseUp,this.listener.end,!1);for(var e=0,n=this.targets.length;e<n;e+=1){var r=this.targets[e];r.el.addEventListener(o.default.MouseEnter,this.listener.activate,!1),r.el.addEventListener(o.default.MouseLeave,this.listener.inactivate,!1)}}},e.prototype.removeListeners=function(t){if(null!=this.listener){this.attached=!1,t.removeEventListener(o.default.MouseDown,this.listener.start,!1),t.removeEventListener(o.default.MouseMove,this.listener.move,!1),t.removeEventListener(o.default.MouseUp,this.listener.end,!1);for(var e=0,n=this.targets.length;e<n;e+=1){var r=this.targets[e];r.el.removeEventListener(o.default.MouseEnter,this.listener.activate,!1),r.el.removeEventListener(o.default.MouseLeave,this.listener.inactivate,!1)}}},e}(i.default);e.default=h},"./src/pointer-handler.ts":function(t,e,n){"use strict";n.r(e);var r=n("./node_modules/javascript-state-machine/state-machine.js"),i=n("./src/target.ts"),o=n("./src/tracker.ts"),a=n("./src/dataset.ts"),s=function(t){return t.isActive()},c=function(){function t(t){this.attached=!1,this.targets=t.map((function(t){var e=new i.default(t);return e.state.initialize(),e})),this.state=r.StateMachine.create(a.default.pointer),this.state.initialize(),this.coords=new o.default(9e5,3),this.listener={}}return t.prototype.findTargetIndex=function(t){for(var e=-1,n=0,r=this.targets.length;n<r;n+=1){if(t(this.targets[n])){e=n;break}}return e},t.prototype.getActiveTargetIndex=function(){return this.findTargetIndex(s)},t.prototype.getEventTrackCount=function(){return this.coords.count},t.prototype.getEventTrack=function(){return this.coords.getTrack()},t.prototype.clearEventTracks=function(){return this.coords.clearTracks()},t.prototype.isAttached=function(){return this.attached},t}();e.default=c},"./src/recorder.ts":function(t,e,n){"use strict";n.r(e);var r=n("./src/tracker.ts"),i=Math.round,o=function(){function t(t){this.frames=0,this.started=!1,this.elapsedTime=0,this.lastTime=0;var e=t.length;this.blockSize=e+1,this.record=new Map([["live",this.createRecord()],["playback",this.createRecord()],["external",this.createRecord()]]),this.shiftedFrames={live:0,playback:0,external:0},this.template=Array(e+1).fill(0)}return t.prototype.update=function(t,e,n){var r=this.template.slice(0),o=this.record.get("live");if(this.started){this.elapsedTime+=t-this.lastTime,this.lastTime=t;var a=i(this.elapsedTime/(1e3/60));a>this.frames&&(this.frames=a,r[0]=this.frames,n>-1&&(r[n+1]=e),o.setTrack(r,this.frames))}else this.started=!0,this.lastTime=t,r[0]=this.frames,o.setTrack(r,this.frames)},t.prototype.createRecord=function(){var t=new r.default(216e3,this.blockSize);return t.writeFrames(),t},t.prototype.getElapsedTime=function(){return this.elapsedTime},t.prototype.getFrames=function(){return this.frames},t.prototype.setFrames=function(t){var e=this.template.slice(0);e[0]=t,this.record.get("live").setTrack(e,t);var n=(t-this.frames)*(1e3/60);this.elapsedTime+=n,this.frames=t},t.prototype.suspend=function(){this.started=!1},t.prototype.resetFrames=function(){this.frames=0,this.started=!1,this.lastTime=0,this.elapsedTime=0},t.prototype.clearRecord=function(t){void 0===t&&(t="live"),this.record.get(t).writeFrames()},t.prototype.getRecordCount=function(t){return void 0===t&&(t="live"),this.record.get(t).count},t.prototype.getVelocities=function(t,e){void 0===t&&(t=-1),void 0===e&&(e="live");var n=t+this.shiftedFrames[e],r=this.record.get(e).getTrack(n);return Array.from(r.subarray(1))},t.prototype.getRecord=function(t){void 0===t&&(t="live");var e=this.record.get(t);return e.getTrack(0,e.size)},t.prototype.setRecord=function(t,e){void 0===e&&(e="live"),this.record.get(e).setTrack(t)},t.prototype.addData=function(t){this.record.get("live").addTrack(t)},t.prototype.getData=function(t,e,n){void 0===t&&(t=-1),void 0===e&&(e=1),void 0===n&&(n="live");var r=t+this.shiftedFrames[n];return this.record.get(n).getTrack(r,e)},t.prototype.setData=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n="live"),this.record.get(n).setTrack(t,e)},t.prototype.setShiftedFrames=function(t,e){void 0===e&&(e="live"),this.shiftedFrames[e]=t},t}();e.default=o},"./src/target.ts":function(t,e,n){"use strict";n.r(e);var r=n("./node_modules/javascript-state-machine/state-machine.js"),i=n("./src/dataset.ts"),o=function(){function t(t){this.el=t,this.state=r.StateMachine.create(i.default.target)}return t.prototype.isActive=function(){return"active"===this.state.current},t}();e.default=o},"./src/touch-handler.ts":function(t,e,n){"use strict";n.r(e);var r,i=n("./src/pointer-handler.ts"),o=n("./src/event-type.ts"),a=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=document.documentElement;function c(t,e){if(e instanceof TouchEvent&&"idling"===t.current){t.start();var n=performance.now(),r=s.getBoundingClientRect(),i=Array.from(e.changedTouches)[0],o=i.clientX-r.left,a=i.clientY-r.top;this.coords.addTrack([n,o,a])}}function u(t,e){if(e instanceof TouchEvent&&"running"===t.current){for(var n=performance.now(),r=s.getBoundingClientRect(),i=Array.from(e.changedTouches)[0],o=i.clientX,a=i.clientY,c=o-r.left,u=a-r.top,l=0,d=this.targets.length;l<d;l+=1){var f=this.targets[l],h=f.el.getBoundingClientRect();o>=h.left&&o<=h.left+h.width&&a>=h.top&&a<=h.top+h.height?"active"!==f.state.current&&f.state.activate():"inactive"!==f.state.current&&f.state.inactivate()}this.coords.addTrack([n,c,u])}}function l(t,e){if(e instanceof TouchEvent&&"running"===t.current){var n=performance.now(),r=s.getBoundingClientRect(),i=Array.from(e.changedTouches)[0],o=i.clientX-r.left,a=i.clientY-r.top;this.coords.addTrack([n,o,a]),t.end()}}var d=function(t){function e(e){var n=t.call(this,e)||this;return n.listener={start:c.bind(n,n.state),move:u.bind(n,n.state),end:l.bind(n,n.state)},n}return a(e,t),e.prototype.addListeners=function(t){null!=this.listener&&(this.attached||(this.attached=!0,t.addEventListener(o.default.TouchStart,this.listener.start,!1),t.addEventListener(o.default.TouchMove,this.listener.move,!1),t.addEventListener(o.default.TouchEnd,this.listener.end,!1),t.addEventListener(o.default.TouchCancel,this.listener.end,!1)))},e.prototype.removeListeners=function(t){null!=this.listener&&this.attached&&(this.attached=!1,t.removeEventListener(o.default.TouchStart,this.listener.start,!1),t.removeEventListener(o.default.TouchMove,this.listener.move,!1),t.removeEventListener(o.default.TouchEnd,this.listener.end,!1),t.removeEventListener(o.default.TouchCancel,this.listener.end,!1))},e}(i.default);e.default=d},"./src/tracker.ts":function(t,e,n){"use strict";n.r(e);var r=Math.floor;var i=function(){function t(t,e){this.end=0,this.blockSize=e;try{this.tracks=new Float32Array(t*this.blockSize)}catch(t){throw new Error("cannot allocate memory")}if(!new Uint8Array(new Uint16Array([255]).buffer)[0])throw new Error("required little endian system")}return Object.defineProperty(t.prototype,"count",{get:function(){return r(this.end/this.blockSize)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return r(this.tracks.length/this.blockSize)},enumerable:!0,configurable:!0}),t.prototype.setTrack=function(t,e){if(void 0===e&&(e=0),t.length%this.blockSize!=0)throw new Error("Track size not matched");var n=e*this.blockSize;this.tracks.set(t,n),n+t.length>=this.end&&(this.end=n+t.length)},t.prototype.addTrack=function(t){if(t.length%this.blockSize!=0)throw new Error("Track size not matched");this.tracks.set(t,this.end),this.end+=t.length},t.prototype.getTrack=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=1);var n=t<0?(this.count+t)*this.blockSize:t*this.blockSize,r=n+e*this.blockSize;return this.tracks.subarray(n,r)},t.prototype.clearTracks=function(){this.end=0,this.tracks.fill(0)},t.prototype.writeFrames=function(){this.clearTracks();for(var t=0,e=this.tracks.length,n=0;t<e;t+=1)t%this.blockSize==0&&(this.tracks.set([n],t),n+=1)},t.create=function(e,n){return new t(e,n)},t}();e.default=i}})}));
//# sourceMappingURL=rub.min.js.map